// Rabbit Ear https://rabbitear.org v0.1.1 Copyright 2018 Robby Kraft
// https://d3js.org/d3-voronoi/ v1.1.4 Copyright 2018 Mike Bostock
(function(E,C){'object'==typeof exports&&'undefined'!=typeof module?C(exports):'function'==typeof define&&define.amd?define(['exports'],C):C(E.RabbitEar={})})(this,function(E){'use strict';function C(bs){return bs!==void 0&&!isNaN(bs.x)&&!isNaN(bs.y)}function N(bs){return bs!==void 0&&!isNaN(bs)&&!isNaN(bs)}function P(bs,vs,Es){return void 0===Es&&(Es=He),Math.abs(bs-vs)<Es}function L(bs,vs){return Math.floor(bs)==bs||void 0==vs?bs:parseFloat(bs.toFixed(vs))}function w(bs,vs){for(;0>bs;)bs+=2*Math.PI;for(;0>vs;)vs+=2*Math.PI;var Es=vs-bs;return 0<=Es?Es:2*Math.PI-(bs-vs)}function A(bs,vs){var Es=vs.x*bs.x+vs.y*bs.y,Cs=vs.x*bs.y-vs.y*bs.x,Ns=Math.atan2(Cs,Es);return 0>Ns&&(Ns+=2*Math.PI),Ns}function B(bs,vs){var Es=bs.x*vs.x+bs.y*vs.y,Cs=bs.x*vs.y-bs.y*vs.x,Ns=Math.atan2(Cs,Es);return 0>Ns&&(Ns+=2*Math.PI),Ns}function S(bs,vs){return bs=bs.normalize(),vs=vs.normalize(),[bs.add(vs).normalize(),new $e(-bs.x+-vs.x,-bs.y+-vs.y).normalize()]}function T(bs,vs,Es,Cs,Ns,Ps){function Ls(_s,Ss){return _s.x*Ss.y-Ss.x*_s.y}var js=Ls(vs,Cs);if(!P(js,0,Ps)){var As=Ls(Es.subtract(bs),Cs),Bs=Ls(bs.subtract(Es),vs),qs=As/js;if(Ns(qs,Bs/-js))return bs.add(vs.scale(qs))}}function R(bs,vs,Es){return void 0===Es&&(Es=He),T(new $e(bs.point.x,bs.point.y),new $e(bs.direction.x,bs.direction.y),new $e(vs.point.x,vs.point.y),new $e(vs.direction.x,vs.direction.y),function(){return!0},Es)}function F(bs,vs,Es){return void 0===Es&&(Es=He),T(new $e(bs.point.x,bs.point.y),new $e(bs.direction.x,bs.direction.y),new $e(vs.origin.x,vs.origin.y),new $e(vs.direction.x,vs.direction.y),function(Cs,Ns){return Ns>=-Es},Es)}function V(bs,vs,Es){return void 0===Es&&(Es=He),T(new $e(bs.point.x,bs.point.y),new $e(bs.direction.x,bs.direction.y),new $e(vs.nodes[0].x,vs.nodes[0].y),new $e(vs.nodes[1].x-vs.nodes[0].x,vs.nodes[1].y-vs.nodes[0].y),function(Cs,Ns){return Ns>=-Es&&Ns<=1+Es},Es)}function X(bs,vs,Es){return void 0===Es&&(Es=He),T(new $e(bs.origin.x,bs.origin.y),new $e(bs.direction.x,bs.direction.y),new $e(vs.origin.x,vs.origin.y),new $e(vs.direction.x,vs.direction.y),function(Cs,Ns){return Cs>=-Es&&Ns>=-Es},Es)}function I(bs,vs,Es){return void 0===Es&&(Es=He),T(new $e(bs.origin.x,bs.origin.y),new $e(bs.direction.x,bs.direction.y),new $e(vs.nodes[0].x,vs.nodes[0].y),new $e(vs.nodes[1].x-vs.nodes[0].x,vs.nodes[1].y-vs.nodes[0].y),function(Cs,Ns){return Cs>=-Es&&Ns>=-Es&&Ns<=1+Es},Es)}function Y(bs,vs,Es){return void 0===Es&&(Es=He),T(new $e(bs.nodes[0].x,bs.nodes[0].y),new $e(bs.nodes[1].x-bs.nodes[0].x,bs.nodes[1].y-bs.nodes[0].y),new $e(vs.nodes[0].x,vs.nodes[0].y),new $e(vs.nodes[1].x-vs.nodes[0].x,vs.nodes[1].y-vs.nodes[0].y),function(Cs,Ns){return Cs>=-Es&&Cs<=1+Es&&Ns>=-Es&&Ns<=1+Es},Es)}function O(bs,vs,Es,Cs){function Ns(Ts){return 0>Ts?-1:1}var Ps=Math.pow(vs,2),Ls=Es.x-bs.x,js=Es.y-bs.y,ws=Cs.x-bs.x,As=Cs.y-bs.y,Bs=ws-Ls,qs=As-js,Ms=Bs*Bs+qs*qs,_s=Ls*As-ws*js,Ls=(_s*qs+Ns(qs)*Bs*Math.sqrt(Ps*Ms-_s*_s))/Ms,ws=(_s*qs-Ns(qs)*Bs*Math.sqrt(Ps*Ms-_s*_s))/Ms,js=(-_s*Bs+Math.abs(qs)*Math.sqrt(Ps*Ms-_s*_s))/Ms,As=(-_s*Bs-Math.abs(qs)*Math.sqrt(Ps*Ms-_s*_s))/Ms,Ss=[];return isNaN(Ls)||Ss.push(new $e(Ls+bs.x,js+bs.y)),isNaN(ws)||Ss.push(new $e(ws+bs.x,As+bs.y)),Ss}function U(bs){return bs!==void 0&&!isNaN(bs.x)&&!isNaN(bs.y)}function W(bs){return bs!==void 0&&!isNaN(bs)&&!isNaN(bs)}function G(bs,vs,Es){return void 0===Es&&(Es=He),Math.abs(bs-vs)<Es}function H(bs,vs){return U(bs)?new $e(bs.x,bs.y):W(vs)?new $e(bs,vs):bs.constructor===Array?new $e(bs[0],bs[1]):void 0}function Z(bs,vs,Es,Cs){return bs instanceof $e&&vs instanceof $e?[bs,vs]:U(vs)?[new $e(bs.x,bs.y),new $e(vs.x,vs.y)]:W(Cs)?[new $e(bs,vs),new $e(Es,Cs)]:void 0}function J(bs){return bs!==void 0&&!isNaN(bs)&&!isNaN(bs)}function K(){for(var vs=[],Es=0;Es<arguments.length;Es++)vs.push(arguments[Es]);var Cs=vs.filter(function(Rs){return Rs instanceof HTMLElement||Rs instanceof Document},this).shift();if(void 0==Cs){var Ns=vs.filter(function(Rs){return'string'==typeof Rs||Rs instanceof String},this).shift();void 0!=Ns&&(Cs=new window.DOMParser().parseFromString(Ns,'text/xml'))}if(void 0==Cs)throw'error, the svg parser was given some unrecognizable data.';var Ps,Ls=Cs.getElementsByTagName('style')[0];void 0!=Ls&&void 0!=Ls.childNodes&&0<Ls.childNodes.length&&(Ps=$(Ls.childNodes[0].nodeValue));var js=Cs.getElementsByTagName('svg');if(void 0==js||0==js.length)throw'error, the svg parser couldn\'t find an SVG element';var ws=js[0],Bs=['x','y','width','height'].map(function(Rs){return void 0==ws.attributes[Rs]?'':ws.attributes[Rs].nodeValue},this).map(function(Rs){return parseFloat(Rs)},this),qs=void 0==ws.attributes.viewBox?'':ws.attributes.viewBox.nodeValue,Ms=qs.split(' ').map(function(Rs){return parseFloat(Rs)},this),_s={origin:{x:Bs[0],y:Bs[1]},size:{width:Bs[2],height:Bs[3]}};isNaN(_s.size.width)&&(_s.size.width=Ms[2]),isNaN(_s.size.height)&&(_s.size.height=Ms[3]);var Ss={mountain:[],valley:[],mark:[]};ne(ws.children,Ss,Ps);var Ts=new Xn;Ts.nodes=[],Ts.edges=[],Ss.mark.forEach(function(Rs){Ts.newCrease(Rs[0],Rs[1],Rs[2],Rs[3]).mark()},this),Ss.valley.forEach(function(Rs){Ts.newCrease(Rs[0],Rs[1],Rs[2],Rs[3]).valley()},this),Ss.mountain.forEach(function(Rs){Ts.newCrease(Rs[0],Rs[1],Rs[2],Rs[3]).mountain()},this),Ts.edges.forEach(function(Rs){0<Ts.boundary.edges.filter(function(Fs){return Fs.parallel(Rs)},this).filter(function(Fs){return Fs.collinear(Rs.nodes[0])},this).length&&Rs.boundary()},this),Ts.scaleToUnitHeight();var Ds=Ts.nodes.map(function(Rs){return{x:Rs.x,y:Rs.y}},this);return Ts.boundary.convexHull(Ds),Ts.clean(),Ts}function $(bs){var vs=document.createElement('style');vs.textContent=bs,document.body.appendChild(vs);var Es=vs.sheet.cssRules;return document.body.removeChild(vs),Es}function Q(bs){if('#'==bs.substr(0,1)){var vs=(bs.length-1)/3,Es=[17,1,0.062272][vs-1];return[Math.round(parseInt(bs.substr(1,vs),16)*Es),Math.round(parseInt(bs.substr(1+vs,vs),16)*Es),Math.round(parseInt(bs.substr(1+2*vs,vs),16)*Es)]}return bs.split('(')[1].split(')')[0].split(',').map(Math.round)}function ee(bs,vs){var Es;if(bs.attributes.stroke!=void 0)Es=bs.attributes.stroke.nodeValue;else if(bs.attributes.class!=void 0&&vs!=void 0){for(var Cs=void 0,Ns=0;Ns<vs.length;Ns++)vs[Ns].selectorText=='.'+bs.attributes.class.nodeValue&&(Cs=vs[Ns].style);Cs!=void 0&&(Es=Cs.stroke)}if(void 0!=Es){var Ps=Q(Es);if(10>Math.abs(Ps[2]-Ps[1])&&10>Math.abs(Ps[1]-Ps[0]))return'mark';if(Ps[0]>Ps[2])return'mountain';if(Ps[2]>Ps[0])return'valley'}return'mark'}function ne(bs,vs,Es){for(var Cs=[],Ns=0;Ns<bs.length;Ns++)Cs.push(bs[Ns]);Cs.forEach(function(Ps){switch(Ps.nodeName){case'#text':break;case'line':var Ls=['x1','y1','x2','y2'].map(function(Xs){return parseFloat(Ps.attributes[Xs].nodeValue)},this);vs[ee(Ps,Es)].push([Ls[0],Ls[1],Ls[2],Ls[3]]);break;case'rect':var js=parseFloat(Ps.attributes.x.nodeValue),ws=parseFloat(Ps.attributes.y.nodeValue),As=parseFloat(Ps.attributes.width.nodeValue),Bs=parseFloat(Ps.attributes.height.nodeValue),qs=[[js,ws],[js+As,ws],[js+As,ws+Bs],[js,ws+Bs]],Ms=ee(Ps,Es);qs.forEach(function(Xs,Is){var Ys=qs[(Is+1)%qs.length];vs[Ms].push([Xs[0],Xs[1],Ys[0],Ys[1]])},this);break;case'path':for(var _s=64,Ss=Ps.getTotalLength(),Ts=-1!=Ps.attributes.d.nodeValue.lastIndexOf('z')||-1!=Ps.attributes.d.nodeValue.lastIndexOf('Z'),Ds=[],Rs=0;Rs<_s;Rs++)Ds.push(Ps.getPointAtLength(Rs*Ss/_s));var Ms=ee(Ps,Es);Ds.forEach(function(Xs,Is){if(Is!=Ds.length-1||Ts){var Ys=Ds[(Is+1)%Ds.length];vs[Ms].push([Xs.x,Xs.y,Ys.x,Ys.y])}},this);break;case'circle':for(var Fs=64,js=parseFloat(Ps.attributes.cx.nodeValue),ws=parseFloat(Ps.attributes.cy.nodeValue),zs=parseFloat(Ps.attributes.r.nodeValue),Vs=[],Ms=ee(Ps,Es),Rs=0;Rs<Fs;Rs++)Vs.push([js+zs*Math.cos(2*Rs*Math.PI/Fs),ws+zs*Math.sin(2*Rs*Math.PI/Fs)]);Vs.forEach(function(Xs,Is){var Ys=Vs[(Is+1)%Vs.length];vs[Ms].push([Xs[0],Xs[1],Ys[0],Ys[1]])},this);break;case'polygon':case'polyline':var Ts=!('polygon'!=Ps.nodeName),ks=Ps.attributes.points.nodeValue.split(' ').filter(function(Xs){return''!=Xs},this).map(function(Xs){return Xs.split(',').map(function(Is){return parseFloat(Is)},this)},this),Ms=ee(Ps,Es);ks.forEach(function(Xs,Is){if(Is!=ks.length-1||Ts){var Ys=ks[(Is+1)%ks.length];vs[Ms].push([Xs[0],Xs[1],Ys[0],Ys[1]])}},this);break;default:Ps.childNodes!==void 0&&0<Ps.childNodes.length&&ne(Ps.childNodes,vs,Es);}},this)}function se(bs){return bs!==void 0&&!isNaN(bs.x)&&!isNaN(bs.y)}function oe(bs){return bs!==void 0&&!isNaN(bs)&&!isNaN(bs)}function ie(bs,vs){return Math.floor(bs)==bs||void 0==vs?bs:parseFloat(bs.toFixed(vs))}function te(bs,vs){return se(bs)?new $e(bs.x,bs.y):oe(vs)?new $e(bs,vs):bs.constructor===Array?new $e(bs[0],bs[1]):void 0}function de(bs,vs,Es,Cs){return bs instanceof $e&&vs instanceof $e?[bs,vs]:se(vs)?[new $e(bs.x,bs.y),new $e(vs.x,vs.y)]:oe(Cs)?[new $e(bs,vs),new $e(Es,Cs)]:void 0}function ae(bs,vs,Es,Cs){return bs instanceof nn?bs:void 0===bs.nodes?se(vs)?new nn(bs,vs):oe(Cs)?new nn(bs,vs,Es,Cs):void 0:new nn(bs.nodes[0],bs.nodes[1])}function re(bs,vs,Es,Cs){return bs instanceof en?bs:se(vs)?new en(bs,vs):oe(Cs)?new en(new $e(bs,vs),new $e(Es,Cs)):void 0}function le(bs,vs,Es,Cs){return bs instanceof Qe?bs:se(vs)?new Qe(bs,vs):oe(Cs)?new Qe(bs,vs,Es,Cs):bs instanceof nn&&bs.nodes instanceof Array&&0<bs.nodes.length&&se(bs.nodes[1])?new Qe(bs.nodes[0].x,bs.nodes[0].y,bs.nodes[1].x,bs.nodes[1].y):void 0}function ge(bs){return function(){return bs}}function ce(bs){return bs[0]}function he(bs){return bs[1]}function pe(){this._=null}function ue(bs){bs.U=bs.C=bs.L=bs.R=bs.P=bs.N=null}function ye(bs,vs){var Es=vs,Cs=vs.R,Ns=Es.U;Ns?Ns.L===Es?Ns.L=Cs:Ns.R=Cs:bs._=Cs,Cs.U=Ns,Es.U=Cs,Es.R=Cs.L,Es.R&&(Es.R.U=Es),Cs.L=Es}function xe(bs,vs){var Es=vs,Cs=vs.L,Ns=Es.U;Ns?Ns.L===Es?Ns.L=Cs:Ns.R=Cs:bs._=Cs,Cs.U=Ns,Es.U=Cs,Es.L=Cs.R,Es.L&&(Es.L.U=Es),Cs.R=Es}function me(bs){for(;bs.L;)bs=bs.L;return bs}function be(bs,vs,Es,Cs){var Ns=[null,null],Ps=Jn.push(Ns)-1;return Ns.left=bs,Ns.right=vs,Es&&Ee(Ns,bs,vs,Es),Cs&&Ee(Ns,vs,bs,Cs),Hn[bs.index].halfedges.push(Ps),Hn[vs.index].halfedges.push(Ps),Ns}function ve(bs,vs,Es){var Cs=[vs,Es];return Cs.left=bs,Cs}function Ee(bs,vs,Es,Cs){bs[0]||bs[1]?bs.left===Es?bs[1]=Cs:bs[0]=Cs:(bs[0]=Cs,bs.left=vs,bs.right=Es)}function Ce(bs,vs,Es,Cs,Ns){var Ts,Ps=bs[0],Ls=bs[1],js=Ps[0],ws=Ps[1],As=Ls[0],Bs=Ls[1],qs=0,Ms=1,_s=As-js,Ss=Bs-ws;if(Ts=vs-js,_s||!(0<Ts)){if(Ts/=_s,0>_s){if(Ts<qs)return;Ts<Ms&&(Ms=Ts)}else if(0<_s){if(Ts>Ms)return;Ts>qs&&(qs=Ts)}if(Ts=Cs-js,_s||!(0>Ts)){if(Ts/=_s,0>_s){if(Ts>Ms)return;Ts>qs&&(qs=Ts)}else if(0<_s){if(Ts<qs)return;Ts<Ms&&(Ms=Ts)}if(Ts=Es-ws,Ss||!(0<Ts)){if(Ts/=Ss,0>Ss){if(Ts<qs)return;Ts<Ms&&(Ms=Ts)}else if(0<Ss){if(Ts>Ms)return;Ts>qs&&(qs=Ts)}if(Ts=Ns-ws,Ss||!(0>Ts)){if(Ts/=Ss,0>Ss){if(Ts>Ms)return;Ts>qs&&(qs=Ts)}else if(0<Ss){if(Ts<qs)return;Ts<Ms&&(Ms=Ts)}return 0<qs||1>Ms?(0<qs&&(bs[0]=[js+qs*_s,ws+qs*Ss]),1>Ms&&(bs[1]=[js+Ms*_s,ws+Ms*Ss]),!0):!0}}}}}function Ne(bs,vs,Es,Cs,Ns){var Ps=bs[1];if(Ps)return!0;var Ts,Ds,Ls=bs[0],js=bs.left,ws=bs.right,As=js[0],Bs=js[1],qs=ws[0],Ms=ws[1],_s=(As+qs)/2;if(Ms===Bs){if(_s<vs||_s>=Cs)return;if(As>qs){if(!Ls)Ls=[_s,Es];else if(Ls[1]>=Ns)return;Ps=[_s,Ns]}else{if(!Ls)Ls=[_s,Ns];else if(Ls[1]<Es)return;Ps=[_s,Es]}}else if(Ts=(As-qs)/(Ms-Bs),Ds=(Bs+Ms)/2-Ts*_s,-1>Ts||1<Ts){if(As>qs){if(!Ls)Ls=[(Es-Ds)/Ts,Es];else if(Ls[1]>=Ns)return;Ps=[(Ns-Ds)/Ts,Ns]}else{if(!Ls)Ls=[(Ns-Ds)/Ts,Ns];else if(Ls[1]<Es)return;Ps=[(Es-Ds)/Ts,Es]}}else if(Bs<Ms){if(!Ls)Ls=[vs,Ts*vs+Ds];else if(Ls[0]>=Cs)return;Ps=[Cs,Ts*Cs+Ds]}else{if(!Ls)Ls=[Cs,Ts*Cs+Ds];else if(Ls[0]<vs)return;Ps=[vs,Ts*vs+Ds]}return bs[0]=Ls,bs[1]=Ps,!0}function Pe(bs,vs,Es,Cs){for(var Ps,Ns=Jn.length;Ns--;)Ne(Ps=Jn[Ns],bs,vs,Es,Cs)&&Ce(Ps,bs,vs,Es,Cs)&&(Math.abs(Ps[0][0]-Ps[1][0])>Un||Math.abs(Ps[0][1]-Ps[1][1])>Un)||delete Jn[Ns]}function Le(bs){return Hn[bs.index]={site:bs,halfedges:[]}}function je(bs,vs){var Es=bs.site,Cs=vs.left,Ns=vs.right;return(Es===Ns&&(Ns=Cs,Cs=Es),Ns)?Math.atan2(Ns[1]-Cs[1],Ns[0]-Cs[0]):(Es===Cs?(Cs=vs[1],Ns=vs[0]):(Cs=vs[0],Ns=vs[1]),Math.atan2(Cs[0]-Ns[0],Ns[1]-Cs[1]))}function we(bs,vs){return vs[+(vs.left!==bs.site)]}function Ae(bs,vs){return vs[+(vs.left===bs.site)]}function Be(){for(var Es,Cs,Ns,Ps,bs=0,vs=Hn.length;bs<vs;++bs)if((Es=Hn[bs])&&(Ps=(Cs=Es.halfedges).length)){var Ls=Array(Ps),js=Array(Ps);for(Ns=0;Ns<Ps;++Ns)Ls[Ns]=Ns,js[Ns]=je(Es,Jn[Cs[Ns]]);for(Ls.sort(function(ws,As){return js[As]-js[ws]}),Ns=0;Ns<Ps;++Ns)js[Ns]=Cs[Ls[Ns]];for(Ns=0;Ns<Ps;++Ns)Cs[Ns]=js[Ns]}}function qe(bs,vs,Es,Cs){var Ps,Ls,js,ws,As,Bs,qs,Ms,_s,Ss,Ts,Ds,Ns=Hn.length,Rs=!0;for(Ps=0;Ps<Ns;++Ps)if(Ls=Hn[Ps]){for(js=Ls.site,As=Ls.halfedges,ws=As.length;ws--;)Jn[As[ws]]||As.splice(ws,1);for(ws=0,Bs=As.length;ws<Bs;)Ss=Ae(Ls,Jn[As[ws]]),Ts=Ss[0],Ds=Ss[1],qs=we(Ls,Jn[As[++ws%Bs]]),Ms=qs[0],_s=qs[1],(Math.abs(Ts-Ms)>Un||Math.abs(Ds-_s)>Un)&&(As.splice(ws,0,Jn.push(ve(js,Ss,Math.abs(Ts-bs)<Un&&Cs-Ds>Un?[bs,Math.abs(Ms-bs)<Un?_s:Cs]:Math.abs(Ds-Cs)<Un&&Es-Ts>Un?[Math.abs(_s-Cs)<Un?Ms:Es,Cs]:Math.abs(Ts-Es)<Un&&Ds-vs>Un?[Es,Math.abs(Ms-Es)<Un?_s:vs]:Math.abs(Ds-vs)<Un&&Ts-bs>Un?[Math.abs(_s-vs)<Un?Ms:bs,vs]:null))-1),++Bs);Bs&&(Rs=!1)}if(Rs){var Fs,zs,Vs,ks=Infinity;for(Ps=0,Rs=null;Ps<Ns;++Ps)(Ls=Hn[Ps])&&(js=Ls.site,Fs=js[0]-bs,zs=js[1]-vs,Vs=Fs*Fs+zs*zs,Vs<ks&&(ks=Vs,Rs=Ls));if(Rs){var Xs=[bs,vs],Is=[bs,Cs],Ys=[Es,Cs],Os=[Es,vs];Rs.halfedges.push(Jn.push(ve(js=Rs.site,Xs,Is))-1,Jn.push(ve(js,Is,Ys))-1,Jn.push(ve(js,Ys,Os))-1,Jn.push(ve(js,Os,Xs))-1)}}for(Ps=0;Ps<Ns;++Ps)(Ls=Hn[Ps])&&(Ls.halfedges.length||delete Hn[Ps])}function Me(){ue(this),this.x=this.y=this.arc=this.site=this.cy=null}function _e(bs){var vs=bs.P,Es=bs.N;if(vs&&Es){var Cs=vs.site,Ns=bs.site,Ps=Es.site;if(Cs!==Ps){var Ls=Ns[0],js=Ns[1],ws=Cs[0]-Ls,As=Cs[1]-js,Bs=Ps[0]-Ls,qs=Ps[1]-js,Ms=2*(ws*qs-As*Bs);if(!(Ms>=-1e-12)){var _s=ws*ws+As*As,Ss=Bs*Bs+qs*qs,Ts=(qs*_s-As*Ss)/Ms,Ds=(ws*Ss-Bs*_s)/Ms,Rs=In.pop()||new Me;Rs.arc=bs,Rs.site=Ns,Rs.x=Ts+Ls,Rs.y=(Rs.cy=Ds+js)+Math.sqrt(Ts*Ts+Ds*Ds),bs.circle=Rs;for(var Fs=null,zs=Zn._;zs;)if(Rs.y<zs.y||Rs.y===zs.y&&Rs.x<=zs.x){if(zs.L)zs=zs.L;else{Fs=zs.P;break}}else if(zs.R)zs=zs.R;else{Fs=zs;break}Zn.insert(Fs,Rs),Fs||(Yn=Rs)}}}}function Se(bs){var vs=bs.circle;vs&&(!vs.P&&(Yn=vs.N),Zn.remove(vs),In.push(vs),ue(vs),bs.circle=null)}function Te(){ue(this),this.edge=this.site=this.circle=null}function De(bs){var vs=On.pop()||new Te;return vs.site=bs,vs}function Re(bs){Se(bs),Gn.remove(bs),On.push(bs),ue(bs)}function Fe(bs){var vs=bs.circle,Es=vs.x,Cs=vs.cy,Ns=[Es,Cs],Ps=bs.P,Ls=bs.N,js=[bs];Re(bs);for(var ws=Ps;ws.circle&&Math.abs(Es-ws.circle.x)<Un&&Math.abs(Cs-ws.circle.cy)<Un;)Ps=ws.P,js.unshift(ws),Re(ws),ws=Ps;js.unshift(ws),Se(ws);for(var As=Ls;As.circle&&Math.abs(Es-As.circle.x)<Un&&Math.abs(Cs-As.circle.cy)<Un;)Ls=As.N,js.push(As),Re(As),As=Ls;js.push(As),Se(As);var qs,Bs=js.length;for(qs=1;qs<Bs;++qs)As=js[qs],ws=js[qs-1],Ee(As.edge,ws.site,As.site,Ns);ws=js[0],As=js[Bs-1],As.edge=be(ws.site,As.site,null,Ns),_e(ws),_e(As)}function ze(bs){for(var Cs,Ns,Ps,Ls,vs=bs[0],Es=bs[1],js=Gn._;js;)if(Ps=Ve(js,Es)-vs,Ps>Un)js=js.L;else if(Ls=vs-ke(js,Es),Ls>Un){if(!js.R){Cs=js;break}js=js.R}else{Ps>-Un?(Cs=js.P,Ns=js):Ls>-Un?(Cs=js,Ns=js.N):Cs=Ns=js;break}Le(bs);var ws=De(bs);if(Gn.insert(Cs,ws),Cs||Ns){if(Cs===Ns)return Se(Cs),Ns=De(Cs.site),Gn.insert(ws,Ns),ws.edge=Ns.edge=be(Cs.site,ws.site),_e(Cs),void _e(Ns);if(!Ns)return void(ws.edge=be(Cs.site,ws.site));Se(Cs),Se(Ns);var As=Cs.site,Bs=As[0],qs=As[1],Ms=bs[0]-Bs,_s=bs[1]-qs,Ss=Ns.site,Ts=Ss[0]-Bs,Ds=Ss[1]-qs,Rs=2*(Ms*Ds-_s*Ts),Fs=Ms*Ms+_s*_s,zs=Ts*Ts+Ds*Ds,Vs=[(Ds*Fs-_s*zs)/Rs+Bs,(Ms*zs-Ts*Fs)/Rs+qs];Ee(Ns.edge,As,Ss,Vs),ws.edge=be(As,bs,null,Vs),Ns.edge=be(bs,Ss,null,Vs),_e(Cs),_e(Ns)}}function Ve(bs,vs){var Es=bs.site,Cs=Es[0],Ns=Es[1],Ps=Ns-vs;if(!Ps)return Cs;var Ls=bs.P;if(!Ls)return-Infinity;Es=Ls.site;var js=Es[0],ws=Es[1],As=ws-vs;if(!As)return js;var Bs=js-Cs,qs=1/Ps-1/As,Ms=Bs/As;return qs?(-Ms+Math.sqrt(Ms*Ms-2*qs*(Bs*Bs/(-2*As)-ws+As/2+Ns-Ps/2)))/qs+Cs:(Cs+js)/2}function ke(bs,vs){var Es=bs.N;if(Es)return Ve(Es,vs);var Cs=bs.site;return Cs[1]===vs?Cs[0]:Infinity}function Xe(bs,vs,Es){return(bs[0]-Es[0])*(vs[1]-bs[1])-(bs[0]-vs[0])*(Es[1]-bs[1])}function Ie(bs,vs){return vs[1]-bs[1]||vs[0]-bs[0]}function Ye(bs,vs){var Cs,Ns,Ps,Es=bs.sort(Ie).pop();for(Jn=[],Hn=Array(bs.length),Gn=new pe,Zn=new pe;;)if(Ps=Yn,Es&&(!Ps||Es[1]<Ps.y||Es[1]===Ps.y&&Es[0]<Ps.x))(Es[0]!==Cs||Es[1]!==Ns)&&(ze(Es),Cs=Es[0],Ns=Es[1]),Es=bs.pop();else if(Ps)Fe(Ps.arc);else break;if(Be(),vs){var Ls=+vs[0][0],js=+vs[0][1],ws=+vs[1][0],As=+vs[1][1];Pe(Ls,js,ws,As),qe(Ls,js,ws,As)}this.edges=Jn,this.cells=Hn,Gn=Zn=Jn=Hn=null}function Oe(){function bs(Ns){return new Ye(Ns.map(function(Ps,Ls){var js=[Math.round(vs(Ps,Ls,Ns)/Un)*Un,Math.round(Es(Ps,Ls,Ns)/Un)*Un];return js.index=Ls,js.data=Ps,js}),Cs)}var vs=ce,Es=he,Cs=null;return bs.polygons=function(Ns){return bs(Ns).polygons()},bs.links=function(Ns){return bs(Ns).links()},bs.triangles=function(Ns){return bs(Ns).triangles()},bs.x=function(Ns){return arguments.length?(vs='function'==typeof Ns?Ns:ge(+Ns),bs):vs},bs.y=function(Ns){return arguments.length?(Es='function'==typeof Ns?Ns:ge(+Ns),bs):Es},bs.extent=function(Ns){return arguments.length?(Cs=null==Ns?null:[[+Ns[0][0],+Ns[0][1]],[+Ns[1][0],+Ns[1][1]]],bs):Cs&&[[Cs[0][0],Cs[0][1]],[Cs[1][0],Cs[1][1]]]},bs.size=function(Ns){return arguments.length?(Cs=null==Ns?null:[[0,0],[+Ns[0],+Ns[1]]],bs):Cs&&[Cs[1][0]-Cs[0][0],Cs[1][1]-Cs[0][1]]},bs}var We=3e-3,He=1e-8;class Je{constructor(bs){this.obj=bs,this.parent=void 0,this.children=[]}}class Ke{constructor(bs,vs,Es,Cs,Ns,Ps){this.a=bs===void 0?1:bs,this.b=vs===void 0?0:vs,this.c=Es===void 0?0:Es,this.d=Cs===void 0?1:Cs,this.tx=Ns===void 0?0:Ns,this.ty=Ps===void 0?0:Ps}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}mult(bs){var vs=new Ke;return vs.a=this.a*bs.a+this.c*bs.b,vs.c=this.a*bs.c+this.c*bs.d,vs.tx=this.a*bs.tx+this.c*bs.ty+this.tx,vs.b=this.b*bs.a+this.d*bs.b,vs.d=this.b*bs.c+this.d*bs.d,vs.ty=this.b*bs.tx+this.d*bs.ty+this.ty,vs}reflection(bs,vs){var Es=Math.atan2(bs.y,bs.x),Cs=Math.cos(Es),Ns=Math.sin(Es),Ps=Math.cos(-Es),Ls=Math.sin(-Es);return this.a=Cs*Ps+Ns*Ls,this.b=Cs*-Ls+Ns*Ps,this.c=Ns*Ps+-Cs*Ls,this.d=Ns*-Ls+-Cs*Ps,void 0!==vs&&(this.tx=vs.x+this.a*-vs.x+-vs.y*this.c,this.ty=vs.y+this.b*-vs.x+-vs.y*this.d),this}rotation(bs,vs){return this.a=Math.cos(bs),this.c=-Math.sin(bs),this.b=Math.sin(bs),this.d=Math.cos(bs),void 0!==vs&&(this.tx=vs.x,this.ty=vs.y),this}copy(){var bs=new Ke;return bs.a=this.a,bs.c=this.c,bs.tx=this.tx,bs.b=this.b,bs.d=this.d,bs.ty=this.ty,bs}}class $e{constructor(bs,vs){this.x=bs,this.y=vs}equivalent(bs,vs){return void 0==vs&&(vs=He),P(this.x,bs.x,vs)&&P(this.y,bs.y,vs)}normalize(){var bs=this.magnitude();return new $e(this.x/bs,this.y/bs)}dot(bs){return this.x*bs.x+this.y*bs.y}cross(bs){return this.x*bs.y-this.y*bs.x}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}distanceTo(bs){return Math.sqrt(Math.pow(this.x-bs.x,2)+Math.pow(this.y-bs.y,2))}transform(bs){return new $e(this.x*bs.a+this.y*bs.c+bs.tx,this.x*bs.b+this.y*bs.d+bs.ty)}translate(bs,vs){return new $e(this.x+bs,this.y+vs)}rotate90(){return new $e(-this.y,this.x)}rotate180(){return new $e(-this.x,-this.y)}rotate270(){return new $e(this.y,-this.x)}rotate(bs,vs){return this.transform(new Ke().rotation(bs,vs))}lerp(bs,vs){var Es=1-vs;return new $e(this.x*vs+bs.x*Es,this.y*vs+bs.y*Es)}midpoint(bs){return new $e(0.5*(this.x+bs.x),0.5*(this.y+bs.y))}reflect(bs){var vs=bs.direction==void 0?new $e(bs.nodes[0].x,bs.nodes[0].y):bs.point||bs.origin,Es=bs.direction==void 0?new $e(bs.nodes[1].x,bs.nodes[1].y).subtract(vs):bs.direction;return this.transform(new Ke().reflection(Es,vs))}scale(bs){return new $e(this.x*bs,this.y*bs)}add(bs,vs){if(C(bs))return new $e(this.x+bs.x,this.y+bs.y);return N(vs)?new $e(this.x+bs,this.y+vs):void 0}subtract(bs){return new $e(this.x-bs.x,this.y-bs.y)}multiply(bs){return new $e(this.x*bs.x,this.y*bs.y)}abs(){return new $e(Math.abs(this.x),Math.abs(this.y))}commonX(bs,vs){return P(this.x,bs.x,vs)}commonY(bs,vs){return P(this.y,bs.y,vs)}}class Qe{constructor(bs,vs,Es,Cs){bs.x===void 0?(this.point=new $e(bs,vs),this.direction=new $e(Es,Cs)):(this.point=new $e(bs.x,bs.y),this.direction=new $e(vs.x,vs.y))}rays(){var bs=new en(this.point,this.direction);return[bs,bs.flip()]}length(){return Infinity}vector(){return this.direction}parallel(bs,vs){vs===void 0&&(vs=He);var Es=bs.nodes===void 0?bs.direction:new $e(bs.nodes[1].x-bs.nodes[0].x,bs.nodes[1].y-bs.nodes[0].y);return Es===void 0?void 0:P(this.direction.cross(Es),0,vs)}collinear(bs,vs){vs===void 0&&(vs=He);var Es=[this.point.x,this.point.x+this.direction.x,bs.x],Cs=[this.point.y,this.point.y+this.direction.y,bs.y];return P(Es[0]*(Cs[1]-Cs[2])+Es[1]*(Cs[2]-Cs[0])+Es[2]*(Cs[0]-Cs[1]),0,vs)}equivalent(bs,vs){return this.collinear(bs.point,vs)&&this.parallel(bs,vs)}degenrate(bs){return void 0===bs&&(bs=He),P(this.direction.magnitude(),0,bs)}intersection(bs,vs){return bs instanceof Qe?R(this,bs,vs):bs instanceof en?F(this,bs,vs):bs instanceof nn?V(this,bs,vs):void 0}reflectionMatrix(){return new Ke().reflection(this.direction,this.point)}nearestPoint(bs){return this.nearestPointNormalTo(bs)}nearestPointNormalTo(bs){var vs=this.direction.normalize(),Es=(bs.x-this.point.x)*vs.x+(bs.y-this.point.y)*vs.y;return new $e(this.point.x+Es*vs.x,this.point.y+Es*vs.y)}transform(bs){return new Qe(this.point.transform(bs),this.direction.transform(bs))}bisect(bs){if(this.parallel(bs))return[new Qe(this.point.midpoint(bs.point),this.direction)];var vs=R(this,bs),Es=S(this.direction,bs.direction);if(Es[1]=Es[1].rotate90(),Math.abs(this.direction.cross(Es[1]))<Math.abs(this.direction.cross(Es[0]))){var Cs=Es[0];Es[0]=Es[1],Es[1]=Cs}return Es.map(function(Ns){return new Qe(vs,Ns)},this)}subsect(bs,vs){var Es=Array.apply(null,Array(vs)).map(function(Ns,Ps){return Ps/vs});if(Es.shift(),this.parallel(bs))return Es.map(function(Ns){return new Qe(this.point.lerp(bs.point,Ns),this.direction)},this);var Cs=R(this,bs);return[[new ln(Cs,[Cs.add(this.direction),Cs.add(bs.direction)]),new ln(Cs,[Cs.add(this.direction),Cs.add(bs.direction.rotate180())])].sort(function(Ns,Ps){return Ns.angle()-Ps.angle()}).shift(),[new ln(Cs,[Cs.add(bs.direction),Cs.add(this.direction)]),new ln(Cs,[Cs.add(bs.direction),Cs.add(this.direction.rotate180())])].sort(function(Ns,Ps){return Ns.angle()-Ps.angle()}).shift()].map(function(Ns){return Ns.subsect(vs)},this).reduce(function(Ns,Ps){return Ns.concat(Ps)},[]).map(function(Ns){return new Qe(Ns.origin,Ns.direction)},this)}}class en{constructor(bs,vs,Es,Cs){bs.x===void 0?(this.origin=new $e(bs,vs),this.direction=new $e(Es,Cs)):(this.origin=new $e(bs.x,bs.y),this.direction=new $e(vs.x,vs.y))}length(){return Infinity}vector(){return this.direction}parallel(bs,vs){vs===void 0&&(vs=He);var Es=bs.nodes===void 0?bs.direction:new $e(bs.nodes[1].x-bs.nodes[0].x,bs.nodes[1].y-bs.nodes[0].y);return void 0===Es?void 0:P(this.direction.cross(Es),0,vs)}collinear(bs,vs){vs===void 0&&(vs=He);var Es=new $e(bs.x-this.origin.x,bs.y-this.origin.y),Cs=Es.dot(this.direction);if(Cs<-vs)return!1;var Ns=Es.cross(this.direction);return P(Ns,0,vs)}equivalent(bs,vs){return void 0===vs&&(vs=He),this.origin.equivalent(bs.origin,vs)&&this.direction.normalize().equivalent(bs.direction.normalize(),vs)}degenrate(bs){return void 0===bs&&(bs=He),P(this.direction.magnitude(),0,bs)}intersection(bs,vs){return bs instanceof en?X(this,bs,vs):bs instanceof Qe?F(bs,this,vs):bs instanceof nn?I(this,bs,vs):void 0}reflectionMatrix(){return new Ke().reflection(this.direction,this.origin)}nearestPoint(bs){var vs=this.nearestPointNormalTo(bs);return void 0===vs?this.origin:vs}nearestPointNormalTo(bs){var vs=this.direction.normalize(),Es=(bs.x-this.origin.x)*vs.x+(bs.y-this.origin.y)*vs.y;return 0>Es?void 0:new $e(this.origin.x+Es*vs.x,this.origin.y+Es*vs.y)}transform(bs){return new en(this.origin.transform(bs),this.direction.transform(bs))}flip(){return new en(this.origin,new $e(-this.direction.x,-this.direction.y))}clipWithEdge(bs,vs){var Es=I(this,bs,vs);return void 0===Es?void 0:new nn(this.origin,Es)}clipWithEdges(bs,vs){return void 0===vs&&(vs=He),bs.map(function(Es){return this.clipWithEdge(Es)},this).filter(function(Es){return void 0!==Es}).map(function(Es){return{edge:Es,length:Es.length()}}).filter(function(Es){return Es.length>vs}).sort(function(Es,Cs){return Es.length-Cs.length}).map(function(Es){return Es.edge})}intersectionsWithEdges(bs,vs){return void 0===vs&&(vs=He),bs.map(function(Es){return I(this,Es,vs)},this).filter(function(Es){return void 0!==Es},this).map(function(Es){return{point:Es,length:Es.distanceTo(this.origin)}},this).sort(function(Es,Cs){return Es.length-Cs.length}).map(function(Es){return Es.point},this)}clipWithEdgesDetails(bs,vs){return void 0===vs&&(vs=He),bs.map(function(Es){return{edge:this.clipWithEdge(Es),intersection:Es}},this).filter(function(Es){return void 0!==Es.edge}).map(function(Es){return{edge:Es.edge,intersection:Es.intersection,length:Es.edge.length()}}).filter(function(Es){return Es.length>vs}).sort(function(Es,Cs){return Es.length-Cs.length}).map(function(Es){return{edge:Es.edge,intersection:Es.intersection}})}}class nn{constructor(bs,vs,Es,Cs){bs.x===void 0?N(Cs)?this.nodes=[new $e(bs,vs),new $e(Es,Cs)]:bs.nodes!==void 0&&(this.nodes=[new $e(bs.nodes[0].x,bs.nodes[0].y),new $e(bs.nodes[1].x,bs.nodes[1].y)]):this.nodes=[new $e(bs.x,bs.y),new $e(vs.x,vs.y)]}length(){return Math.sqrt(Math.pow(this.nodes[0].x-this.nodes[1].x,2)+Math.pow(this.nodes[0].y-this.nodes[1].y,2))}vector(bs){return void 0===bs?this.nodes[1].subtract(this.nodes[0]):this.nodes[0].equivalent(bs)?this.nodes[1].subtract(this.nodes[0]):this.nodes[0].subtract(this.nodes[1])}parallel(bs,vs){vs===void 0&&(vs=He);var Es=bs.nodes===void 0?bs.direction:new $e(bs.nodes[1].x-bs.nodes[0].x,bs.nodes[1].y-bs.nodes[0].y);if(void 0!==Es){var Cs=this.nodes[1].subtract(this.nodes[0]);return P(Cs.cross(Es),0,vs)}}collinear(bs,vs){vs===void 0&&(vs=He);var Es=new nn(bs,this.nodes[0]).length(),Cs=new nn(bs,this.nodes[1]).length();return P(this.length()-Es-Cs,0,vs)}equivalent(bs,vs){return void 0===vs&&(vs=He),this.nodes[0].equivalent(bs.nodes[0],vs)&&this.nodes[1].equivalent(bs.nodes[1],vs)||this.nodes[0].equivalent(bs.nodes[1],vs)&&this.nodes[1].equivalent(bs.nodes[0],vs)}degenrate(bs){return void 0===bs&&(bs=He),this.nodes[0].equivalent(this.nodes[1],bs)}intersection(bs,vs){return bs instanceof nn?Y(this,bs,vs):bs instanceof Qe?V(bs,this,vs):bs instanceof en?I(bs,this,vs):void 0}reflectionMatrix(){return new Ke().reflection(this.nodes[1].subtract(this.nodes[0]),this.nodes[0])}nearestPoint(bs){var vs=this.nearestPointNormalTo(bs);return void 0===vs?this.nodes.map(function(Es){return{point:Es,distance:Es.distanceTo(bs)}},this).sort(function(Es,Cs){return Es.distance-Cs.distance}).shift().point:vs}nearestPointNormalTo(bs){var vs=this.nodes[0].distanceTo(this.nodes[1]),Es=((bs.x-this.nodes[0].x)*(this.nodes[1].x-this.nodes[0].x)+(bs.y-this.nodes[0].y)*(this.nodes[1].y-this.nodes[0].y))/Math.pow(vs,2);return 0>Es||1<Es?void 0:new $e(this.nodes[0].x+Es*(this.nodes[1].x-this.nodes[0].x),this.nodes[0].y+Es*(this.nodes[1].y-this.nodes[0].y))}transform(bs){return new nn(this.nodes[0].transform(bs),this.nodes[1].transform(bs))}midpoint(){return new $e(0.5*(this.nodes[0].x+this.nodes[1].x),0.5*(this.nodes[0].y+this.nodes[1].y))}perpendicularBisector(){return new Qe(this.midpoint(),this.vector().rotate90())}infiniteLine(){return new Qe(this.nodes[0],this.nodes[1].subtract(this.nodes[0]))}}class sn{constructor(){this.nodes=[]}edges(){for(var bs=[],vs=0;vs<this.nodes.length-1;vs++)bs.push(new nn(this.nodes[vs],this.nodes[vs+1]));return bs}rayReflectRepeat(bs,vs,Es){var Ns=[],Ps=bs.clipWithEdgesDetails(vs);if(0==Ps.length)return this;if(void 0!==Es&&P(bs.direction.cross(Es.subtract(bs.origin)),0,He)&&(0===Ps.length||bs.origin.distanceTo(Es)<Ps[0].edge.length()))return this.nodes=[bs.origin,Es],this;Ns.push(Ps[0]);for(var Ls=0;Ls<666;){var js=Ns[Ns.length-1],ws=new $e(js.intersection.nodes[0].x,js.intersection.nodes[0].y),As=new $e(js.intersection.nodes[1].x,js.intersection.nodes[1].y),Bs=new Ke().reflection(As.subtract(ws),ws),qs=new en(js.edge.nodes[1],js.edge.nodes[0].transform(Bs).subtract(js.edge.nodes[1])),Ms=qs.clipWithEdgesDetails(vs);if(void 0!==Es&&P(qs.direction.cross(Es.subtract(qs.origin)),0,He)){Ns.push({edge:new nn(qs.origin,Es),intersection:void 0});break}if(0===Ms.length||void 0===Ms[0])break;Ns.push(Ms[0]),Ls++}return this.nodes=Ns.map(function(_s){return _s.edge.nodes[0]}),this.nodes.push(Ns[Ns.length-1].edge.nodes[1]),this}}class on{constructor(bs,vs,Es,Cs){this.origin={x:bs,y:vs},this.size={width:Es,height:Cs}}contains(bs,vs){return void 0==vs&&(vs=0),bs.x>this.origin.x-vs&&bs.y>this.origin.y-vs&&bs.x<this.origin.x+this.size.width+vs&&bs.y<this.origin.y+this.size.height+vs}}class tn{constructor(bs,vs){this.points=bs,this.edges=this.points.map(function(Es,Cs){var Ns=this.points[(Cs+1)%this.points.length];return new nn(Es,Ns)},this),this.sectors=this.points.map(function(Es,Cs){var Ns=(Cs+this.points.length-1)%this.points.length,Ps=(Cs+1)%this.points.length;return new ln(Es,[this.points[Ns],this.points[Ps]])},this),this.circumcenter=vs}angles(){return this.points.map(function(bs,vs){var Es=this.points[(vs+this.points.length-1)%this.points.length],Cs=this.points[(vs+1)%this.points.length];return A(Cs.subtract(bs),Es.subtract(bs))},this)}incenter(){var bs=this.edges.map(function(Es){return Es.length()},this);bs.push(bs.shift());var vs=bs.reduce(function(Es,Cs){return Es+Cs},0);return bs.reduce(function(Es,Cs,Ns){return Es.add(this.points[Ns].scale(Cs))}.bind(this),new $e(0,0)).scale(1/vs)}isAcute(){for(var bs=this.angles(),vs=0;vs<bs.length;vs++)if(bs[vs]>0.5*Math.PI)return!1;return!0}isObtuse(){for(var bs=this.angles(),vs=0;vs<bs.length;vs++)if(bs[vs]>0.5*Math.PI)return!0;return!1}isRight(){for(var bs=this.angles(),vs=0;vs<bs.length;vs++)if(P(bs[vs],0.5*Math.PI))return!0;return!1}pointInside(bs){for(var vs=0;vs<this.points.length;vs++){var Es=this.points[vs],Cs=this.points[(vs+1)%this.points.length],Ns=(bs.y-Es.y)*(Cs.x-Es.x)-(bs.x-Es.x)*(Cs.y-Es.y);if(0>Ns)return!1}return!0}}class dn{constructor(bs,vs,Es){Es===void 0?(this.center=bs,this.radius=vs):(this.center=new $e(bs,vs),this.radius=Es)}intersection(bs){return bs instanceof Qe?O(this.center,this.radius,bs.point,bs.point.add(bs.direction)):bs instanceof nn?O(this.center,this.radius,bs.nodes[0],bs.nodes[1]):bs instanceof en?O(this.center,this.radius,bs.origin,bs.origin.add(bs.direction)):void 0}}class an{constructor(){this.nodes=[]}equivalent(bs){if(bs.nodes.length!=this.nodes.length)return!1;var vs;if(bs.nodes.forEach(function(Ns,Ps){if(Ns===this.nodes[0])return void(vs=Ps)},this),void 0==vs)return!1;for(var Cs,Es=0;Es<this.nodes.length;Es++)if(Cs=(vs+Es)%this.nodes.length,this.nodes[Es]!==bs.nodes[Cs])return!1;return!0}contains(bs){for(var vs=!1,Es=0,Cs=this.nodes.length-1;Es<this.nodes.length;Cs=Es++)this.nodes[Es].y>bs.y!=this.nodes[Cs].y>bs.y&&bs.x<(this.nodes[Cs].x-this.nodes[Es].x)*(bs.y-this.nodes[Es].y)/(this.nodes[Cs].y-this.nodes[Es].y)+this.nodes[Es].x&&(vs=!vs);return vs}signedArea(){return 0.5*this.nodes.map(function(bs,vs){var Es=this.nodes[(vs+1)%this.nodes.length];return bs.x*Es.y-Es.x*bs.y},this).reduce(function(bs,vs){return bs+vs},0)}centroid(){return this.nodes.map(function(bs,vs){var Es=this.nodes[(vs+1)%this.nodes.length],Cs=bs.x*Es.y-Es.x*bs.y;return new $e((bs.x+Es.x)*Cs,(bs.y+Es.y)*Cs)},this).reduce(function(bs,vs){return bs.add(vs)},new $e(0,0)).scale(1/(6*this.signedArea()))}center(){for(var bs=Infinity,vs=0,Es=Infinity,Cs=0,Ns=0;Ns<this.nodes.length;Ns++)this.nodes[Ns].x>vs&&(vs=this.nodes[Ns].x),this.nodes[Ns].x<bs&&(bs=this.nodes[Ns].x),this.nodes[Ns].y>Cs&&(Cs=this.nodes[Ns].y),this.nodes[Ns].y<Es&&(Es=this.nodes[Ns].y);return new $e(bs+0.5*(vs-bs),Es+0.5*(Cs-Es))}transform(bs){this.nodes.forEach(function(vs){vs.transform(bs)},this)}}class rn{constructor(){this.edges=[]}nodes(){return this.edges.map(function(bs,vs){var Es=this.edges[(vs+1)%this.edges.length];return bs.nodes[0].equivalent(Es.nodes[0])||bs.nodes[0].equivalent(Es.nodes[1])?bs.nodes[1]:bs.nodes[0]},this)}signedArea(bs){return void 0===bs&&(bs=this.nodes()),0.5*bs.map(function(vs,Es){var Cs=bs[(Es+1)%bs.length];return vs.x*Cs.y-Cs.x*vs.y},this).reduce(function(vs,Es){return vs+Es},0)}centroid(){var bs=this.nodes();return bs.map(function(vs,Es){var Cs=bs[(Es+1)%bs.length],Ns=vs.x*Cs.y-Cs.x*vs.y;return new $e((vs.x+Cs.x)*Ns,(vs.y+Cs.y)*Ns)},this).reduce(function(vs,Es){return vs.add(Es)},new $e(0,0)).scale(1/(6*this.signedArea(bs)))}center(){for(var bs=Infinity,vs=0,Es=Infinity,Cs=0,Ns=this.edges.map(function(Ls){return Ls.nodes[0]}),Ps=0;Ps<Ns.length;Ps++)Ns[Ps].x>vs&&(vs=Ns[Ps].x),Ns[Ps].x<bs&&(bs=Ns[Ps].x),Ns[Ps].y>Cs&&(Cs=Ns[Ps].y),Ns[Ps].y<Es&&(Es=Ns[Ps].y);return new $e(bs+0.5*(vs-bs),Es+0.5*(Cs-Es))}contains(bs){for(var vs=0;vs<this.edges.length;vs++){var Es=this.edges[vs].nodes[1].subtract(this.edges[vs].nodes[0]),Cs=new $e(bs.x-this.edges[vs].nodes[0].x,bs.y-this.edges[vs].nodes[0].y);if(0>Es.cross(Cs))return!1}return!0}liesOnEdge(bs){for(var vs=0;vs<this.edges.length;vs++)if(this.edges[vs].collinear(bs))return!0;return!1}clipEdge(bs){var vs=this.edges.map(function(Cs){return Y(bs,Cs)}).filter(function(Cs){return Cs!==void 0}).filter(function(Cs){return!Cs.equivalent(bs.nodes[0])&&!Cs.equivalent(bs.nodes[1])});switch(vs.length){case 0:return this.contains(bs.nodes[0])?bs:void 0;case 1:return this.contains(bs.nodes[0])?new nn(bs.nodes[0],vs[0]):new nn(bs.nodes[1],vs[0]);default:for(var Es=1;Es<vs.length;Es++)if(!vs[0].equivalent(vs[Es]))return new nn(vs[0],vs[Es]);}}clipLine(bs){var vs=this.edges.map(function(Cs){return V(bs,Cs)}).filter(function(Cs){return Cs!==void 0});switch(vs.length){case 0:return;case 1:return new nn(vs[0],vs[0]);default:for(var Es=1;Es<vs.length;Es++)if(!vs[0].equivalent(vs[Es]))return new nn(vs[0],vs[Es]);}}clipRay(bs){var vs=this.edges.map(function(Cs){return I(bs,Cs)}).filter(function(Cs){return Cs!==void 0});switch(vs.length){case 0:return;case 1:return new nn(bs.origin,vs[0]);default:for(var Es=1;Es<vs.length;Es++)if(!vs[0].equivalent(vs[Es]))return new nn(vs[0],vs[Es]);}}setEdgesFromPoints(bs){return this.edges=bs.map(function(vs,Es){var Cs=bs[(Es+1)%bs.length];return new nn(vs,Cs)},this),this}regularPolygon(bs){for(var vs=0.5*(2*Math.PI/bs),Es=Math.cos(vs),Cs=[],Ns=0;Ns<bs;Ns++){var Ps=-2*Math.PI*Ns/bs+vs,Ls=L(Es*Math.sin(Ps),14),js=L(Es*Math.cos(Ps),14);Cs.push(new $e(Ls,js))}return this.setEdgesFromPoints(Cs),this}convexHull(bs){if(void 0===bs||0===bs.length)return this.edges=[],void 0;var Es=bs.slice().sort(function(As,Bs){return P(As.y,Bs.y,He)?As.x-Bs.x:As.y-Bs.y}),Cs=[];Cs.push(Es[0]);var Ns=0,Ps=0;do{Ps++;var Ls=Cs.length-1,js=Es.filter(function(As){return!(P(As.x,Cs[Ls].x,He)&&P(As.y,Cs[Ls].y,He))}).map(function(As){for(var Bs=Math.atan2(Cs[Ls].y-As.y,Cs[Ls].x-As.x);Bs<Ns;)Bs+=2*Math.PI;return{node:As,angle:Bs,distance:void 0}}).sort(function(As,Bs){return As.angle<Bs.angle?-1:As.angle>Bs.angle?1:0});if(0===js.length)return this.edges=[],void 0;var ws=js[0];if(js=js.filter(function(As){return P(ws.angle,As.angle,We)}).map(function(As){var Bs=Math.sqrt(Math.pow(Cs[Ls].x-As.node.x,2)+Math.pow(Cs[Ls].y-As.node.y,2));return As.distance=Bs,As}).sort(function(As,Bs){return As.distance<Bs.distance?1:As.distance>Bs.distance?-1:0}),0<Cs.filter(function(As){return As===js[0].node}).length)return this.setEdgesFromPoints(Cs);Cs.push(js[0].node),Ns=Math.atan2(Cs[Ls].y-js[0].node.y,Cs[Ls].x-js[0].node.x)}while(Ps<1e4);return this.edges=[],void 0}minimumRect(){var bs=Infinity,vs=-Infinity,Es=Infinity,Cs=-Infinity;return this.nodes().forEach(function(Ns){Ns.x>vs&&(vs=Ns.x),Ns.x<bs&&(bs=Ns.x),Ns.y>Cs&&(Cs=Ns.y),Ns.y<Es&&(Es=Ns.y)}),new on(bs,Es,vs-bs,Cs-Es)}copy(){var bs=new rn;return bs.edges=this.edges.map(function(vs){return new nn(vs.nodes[0].x,vs.nodes[0].y,vs.nodes[1].x,vs.nodes[1].y)}),bs}}class ln{constructor(bs,vs){this.origin=bs,this.endPoints=vs}vectors(){return this.endPoints.map(function(bs){return new $e(bs.x-this.origin.x,bs.y-this.origin.y)},this)}angle(){var bs=this.vectors();return B(bs[0],bs[1])}bisect(){for(var bs=this.vectors(),vs=bs.map(function(Ns){return Math.atan2(Ns.y,Ns.x)});0>vs[0];)vs[0]+=2*Math.PI;for(;0>vs[1];)vs[1]+=2*Math.PI;var Es=w(vs[0],vs[1]),Cs=vs[0]+0.5*Es;return new en(new $e(this.origin.x,this.origin.y),new $e(Math.cos(Cs),Math.sin(Cs)))}subsect(bs){if(bs==void 0||2>bs)throw'subset() requires number parameter > 1';for(var vs=this.vectors().map(function(Ls){return Math.atan2(Ls.y,Ls.x)});0>vs[0];)vs[0]+=2*Math.PI;for(;0>vs[1];)vs[1]+=2*Math.PI;for(var Ps,Es=w(vs[0],vs[1]),Cs=[],Ns=1;Ns<bs;Ns++)Ps=vs[0]+Es*(Ns/bs),Cs.push(new en(new $e(this.origin.x,this.origin.y),new $e(Math.cos(Ps),Math.sin(Ps))));return Cs}equivalent(bs){return bs.origin.equivalent(this.origin)&&bs.endPoints[0].equivalent(this.endPoints[0])&&bs.endPoints[1].equivalent(this.endPoints[1])}contains(bs){var vs=(bs.y-this.endPoints[0].y)*(this.origin.x-this.endPoints[0].x)-(bs.x-this.endPoints[0].x)*(this.origin.y-this.endPoints[0].y),Es=(bs.y-this.origin.y)*(this.endPoints[1].x-this.origin.x)-(bs.x-this.origin.x)*(this.endPoints[1].y-this.origin.y);return 0>vs&&0>Es}sortByClockwise(){}}var gn=Object.freeze({EPSILON_LOW:We,EPSILON:1e-5,EPSILON_HIGH:He,EPSILON_UI:0.05,Tree:Je,counterClockwiseInteriorAngleRadians:w,clockwiseInteriorAngle:A,intersectionRayEdge:I,Matrix:Ke,XY:$e,Line:Qe,Ray:en,Edge:nn,Polyline:sn,Rect:on,Triangle:tn,Circle:dn,Polygon:an,ConvexPolygon:rn,Sector:ln});class cn{constructor(bs,vs){this.nodes={total:0,isolated:0},this.edges={total:0,duplicate:0,circular:0},bs!=void 0&&(this.nodes.total=bs),vs!=void 0&&(this.edges.total=vs)}join(bs){return this.nodes.total+=bs.nodes.total,this.edges.total+=bs.edges.total,this.nodes.isolated+=bs.nodes.isolated,this.edges.duplicate+=bs.edges.duplicate,this.edges.circular+=bs.edges.circular,this}isolatedNodes(bs){return this.nodes.isolated=bs,this.nodes.total+=bs,this}duplicateEdges(bs){return this.edges.duplicate=bs,this.edges.total+=bs,this}circularEdges(bs){return this.edges.circular=bs,this.edges.total+=bs,this}}class hn{constructor(bs){this.graph=bs,this.cache={}}adjacentEdges(){return this.graph.edges.filter(function(bs){return bs.nodes[0]===this||bs.nodes[1]===this},this)}adjacentNodes(){var bs=[];return this.adjacentEdges().filter(function(vs){return!vs.isCircular()}).map(function(vs){return vs.nodes[0]===this?vs.nodes[1]:vs.nodes[0]},this).filter(function(vs){return!(0<=bs.indexOf(vs))&&bs.push(vs)},this)}isAdjacentToNode(bs){return this.graph.getEdgeConnectingNodes(this,bs)!==void 0}degree(){return this.graph.edges.map(function(bs){var vs=0;return bs.nodes[0]===this&&(vs+=1),bs.nodes[1]===this&&(vs+=1),vs},this).reduce(function(bs,vs){return bs+vs})}}class pn{constructor(bs,vs,Es){this.graph=bs,this.nodes=[vs,Es],this.cache={}}adjacentEdges(){return this.graph.edges.filter(function(bs){return bs!==this&&(bs.nodes[0]===this.nodes[0]||bs.nodes[0]===this.nodes[1]||bs.nodes[1]===this.nodes[0]||bs.nodes[1]===this.nodes[1])},this)}adjacentNodes(){return[this.nodes[0],this.nodes[1]]}isAdjacentToEdge(bs){return this.nodes[0]===bs.nodes[0]||this.nodes[1]===bs.nodes[1]||this.nodes[0]===bs.nodes[1]||this.nodes[1]===bs.nodes[0]}isSimilarToEdge(bs){return this.nodes[0]===bs.nodes[0]&&this.nodes[1]===bs.nodes[1]||this.nodes[0]===bs.nodes[1]&&this.nodes[1]===bs.nodes[0]}otherNode(bs){return this.nodes[0]===bs?this.nodes[1]:this.nodes[1]===bs?this.nodes[0]:void 0}isCircular(){return this.nodes[0]===this.nodes[1]}duplicateEdges(){return this.graph.edges.filter(function(bs){return this.isSimilarToEdge(bs)},this)}commonNodeWithEdge(bs){return this===bs?void 0:this.nodes[0]===bs.nodes[0]||this.nodes[0]===bs.nodes[1]?this.nodes[0]:this.nodes[1]===bs.nodes[0]||this.nodes[1]===bs.nodes[1]?this.nodes[1]:void 0}uncommonNodeWithEdge(bs){return this===bs?void 0:this.nodes[0]===bs.nodes[0]||this.nodes[0]===bs.nodes[1]?this.nodes[1]:this.nodes[1]===bs.nodes[0]||this.nodes[1]===bs.nodes[1]?this.nodes[0]:void 0}}class un{constructor(){this.nodes=[],this.edges=[],this.nodeType=hn,this.edgeType=pn}newNode(){return this.addNode(new this.nodeType(this))}newEdge(bs,vs){return this.addEdge(new this.edgeType(this,bs,vs))}addNode(bs){if(void 0==bs)throw'addNode() requires an argument: 1 GraphNode';return bs.graph=this,bs.index=this.nodes.length,this.nodes.push(bs),bs}addEdge(bs){if(void 0!==bs.nodes[0]&&void 0!==bs.nodes[1]&&bs.nodes[0].graph===this&&bs.nodes[1].graph===this)return bs.graph=this,bs.index=this.edges.length,this.edges.push(bs),bs}addNodes(bs){if(bs===void 0||0>=bs.length)throw'addNodes() must contain array of GraphNodes';var vs=this.nodes.length,Es=bs.filter(function(Ns){return Ns instanceof hn});this.nodes=this.nodes.concat(Es);for(var Cs=vs;Cs<this.nodes.length;Cs++)this.nodes[Cs].graph=this,this.nodes[Cs].index=Cs;return this.nodes.length-vs}addEdges(bs){if(void 0==bs||0>=bs.length)throw'addEdges() must contain array of GraphEdges';var vs=this.edges.length,Es=bs.filter(function(Ns){return Ns instanceof pn});this.edges=this.edges.concat(Es);for(var Cs=vs;Cs<this.edges.length;Cs++)this.edges[Cs].graph=this;return this.cleanGraph(),this.edges.length-vs}copyNode(bs){return Object.assign(this.newNode(),bs)}copyEdge(bs){return Object.assign(this.newEdge(bs.nodes[0],bs.nodes[1]),bs)}clear(){return this.nodes=[],this.edges=[],this}removeEdge(bs){var vs=this.edges.length;return this.edges=this.edges.filter(function(Es){return Es!==bs}),this.edgeArrayDidChange(),new cn(void 0,vs-this.edges.length)}removeEdgeBetween(bs,vs){var Es=this.edges.length;return this.edges=this.edges.filter(function(Cs){return(Cs.nodes[0]!==bs||Cs.nodes[1]!==vs)&&(Cs.nodes[0]!==vs||Cs.nodes[1]!==bs)}),this.edgeArrayDidChange(),new cn(void 0,Es-this.edges.length)}removeNode(bs){var vs=this.nodes.length,Es=this.edges.length;return this.nodes=this.nodes.filter(function(Cs){return Cs!==bs}),this.edges=this.edges.filter(function(Cs){return Cs.nodes[0]!==bs&&Cs.nodes[1]!==bs}),this.edges.length!=Es&&this.edgeArrayDidChange(),this.nodes.length!=vs&&this.nodeArrayDidChange(),new cn(vs-this.nodes.length,Es-this.edges.length)}mergeNodes(bs,vs){if(bs!==vs){this.edges.forEach(function(Cs){Cs.nodes[0]===vs&&(Cs.nodes[0]=bs),Cs.nodes[1]===vs&&(Cs.nodes[1]=bs)},this);var Es=this.nodes.length;return this.nodes=this.nodes.filter(function(Cs){return Cs!==vs}),new cn(Es-this.nodes.length).join(this.cleanGraph())}}removeNodeIfIsolated(bs){return 0===this.edges.filter(function(vs){return vs.nodes[0]===bs||vs.nodes[1]===bs},this).length?new cn:(this.nodes=this.nodes.filter(function(vs){return vs!==bs}),this.nodeArrayDidChange(),new cn(1,0))}removeIsolatedNodes(){this.nodeArrayDidChange();for(var bs=[],vs=0;vs<this.nodes.length;vs++)bs[vs]=!1;for(var vs=0;vs<this.edges.length;vs++)bs[this.edges[vs].nodes[0].index]=!0,bs[this.edges[vs].nodes[1].index]=!0;var Es=this.nodes.length;this.nodes=this.nodes.filter(function(Ns,Ps){return bs[Ps]});var Cs=Es-this.nodes.length;return 0<Cs&&this.nodeArrayDidChange(),new cn().isolatedNodes(Cs)}removeCircularEdges(){var bs=this.edges.length;return this.edges=this.edges.filter(function(vs){return vs.nodes[0]!==vs.nodes[1]}),this.edges.length!=bs&&this.edgeArrayDidChange(),new cn().circularEdges(bs-this.edges.length)}removeDuplicateEdges(){for(var bs=0,vs=0;vs<this.edges.length-1;vs++)for(var Es=this.edges.length-1;Es>vs;Es--)this.edges[vs].isSimilarToEdge(this.edges[Es])&&(this.edges.splice(Es,1),bs+=1);return 0<bs&&this.edgeArrayDidChange(),new cn().duplicateEdges(bs)}cleanGraph(){this.edgeArrayDidChange(),this.nodeArrayDidChange();var bs=this.removeDuplicateEdges(),vs=this.removeCircularEdges();return bs.join(vs)}clean(){return this.cleanGraph()}getEdgeConnectingNodes(bs,vs){for(var Es=0;Es<this.edges.length;Es++)if(this.edges[Es].nodes[0]===bs&&this.edges[Es].nodes[1]===vs||this.edges[Es].nodes[0]===vs&&this.edges[Es].nodes[1]===bs)return this.edges[Es]}getEdgesConnectingNodes(bs,vs){return this.edges.filter(function(Es){return Es.nodes[0]===bs&&Es.nodes[1]===vs||Es.nodes[0]===vs&&Es.nodes[1]===bs})}copy(){this.nodeArrayDidChange(),this.edgeArrayDidChange();for(var Es,bs=new un,vs=0;vs<this.nodes.length;vs++)Es=bs.addNode(new hn(bs)),Object.assign(Es,this.nodes[vs]),Es.graph=bs,Es.index=vs;for(var vs=0;vs<this.edges.length;vs++){var Cs=[this.edges[vs].nodes[0].index,this.edges[vs].nodes[1].index],Ns=bs.addEdge(new pn(bs,bs.nodes[Cs[0]],bs.nodes[Cs[1]]));Object.assign(Ns,this.edges[vs]),Ns.graph=bs,Ns.index=vs,Ns.nodes=[bs.nodes[Cs[0]],bs.nodes[Cs[1]]]}return bs}connectedGraphs(){var bs=this.copy();bs.clean(),bs.removeIsolatedNodes(),bs.nodes.forEach(function(As){As.cache.adj=As.adjacentEdges().length},this);for(var Es,vs=[];0<bs.edges.length;){Es=new un,bs.nodes.forEach(function(As){Es.addNode(Object.assign(new bs.nodeType(Es),As))},this);for(var Ps,Cs=bs.nodes.slice().sort(function(As,Bs){return Bs.cache.adj-As.cache.adj})[0],Ns=Cs.adjacentEdges();0<Ns.length;){Ps=Ns.filter(function(As){return 0==As.otherNode(Cs).cache.adj%2},this),0==Ps.length&&(Ps=Ns);var Ls=Ps.sort(function(As,Bs){return Bs.otherNode(Cs).cache.adj-As.otherNode(Cs).cache.adj})[0],js=Ls.otherNode(Cs),ws=Object.assign(new bs.edgeType(Es,void 0,void 0),Ls);ws.nodes=[Es.nodes[Cs.index],Es.nodes[js.index]],Es.addEdge(ws),Cs.cache.adj-=1,js.cache.adj-=1,bs.edges=bs.edges.filter(function(As){return As!==Ls}),Cs=js,Ns=Cs.adjacentEdges()}Es.removeIsolatedNodes(),vs.push(Es)}return vs}nodeArrayDidChange(){for(var bs=0;bs<this.nodes.length;bs++)this.nodes[bs].index=bs}edgeArrayDidChange(){for(var bs=0;bs<this.edges.length;bs++)this.edges[bs].index=bs}}!function(bs){if('object'==typeof E&&'undefined'!=typeof module)module.exports=bs();else if('function'==typeof define&&define.amd)define([],bs);else{var vs;vs='undefined'==typeof window?'undefined'==typeof global?'undefined'==typeof self?this:self:global:window,vs.rbush=bs()}}(function(){return function bs(vs,Es,Cs){function Ns(js,ws){if(!Es[js]){if(!vs[js]){var As='function'==typeof require&&require;if(!ws&&As)return As(js,!0);if(Ps)return Ps(js,!0);var Bs=new Error('Cannot find module \''+js+'\'');throw Bs.code='MODULE_NOT_FOUND',Bs}var qs=Es[js]={exports:{}};vs[js][0].call(qs.exports,function(Ms){var _s=vs[js][1][Ms];return Ns(_s?_s:Ms)},qs,qs.exports,bs,vs,Es,Cs)}return Es[js].exports}for(var Ps='function'==typeof require&&require,Ls=0;Ls<Cs.length;Ls++)Ns(Cs[Ls]);return Ns}({1:[function(bs,vs){function Cs(zs,Vs){return this instanceof Cs?(this._maxEntries=Math.max(4,zs||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),Vs&&this._initFormat(Vs),void this.clear()):new Cs(zs,Vs)}function Ns(zs,Vs,ks){if(!ks)return Vs.indexOf(zs);for(var Xs=0;Xs<Vs.length;Xs++)if(ks(zs,Vs[Xs]))return Xs;return-1}function Ps(zs,Vs){Ls(zs,0,zs.children.length,Vs,zs)}function Ls(zs,Vs,ks,Xs,Is){Is||(Is=Ds(null)),Is.minX=1/0,Is.minY=1/0,Is.maxX=-(1/0),Is.maxY=-(1/0);for(var Ys,Os=Vs;Os<ks;Os++)Ys=zs.children[Os],js(Is,zs.leaf?Xs(Ys):Ys);return Is}function js(zs,Vs){return zs.minX=Math.min(zs.minX,Vs.minX),zs.minY=Math.min(zs.minY,Vs.minY),zs.maxX=Math.max(zs.maxX,Vs.maxX),zs.maxY=Math.max(zs.maxY,Vs.maxY),zs}function ws(zs,Vs){return zs.minX-Vs.minX}function As(zs,Vs){return zs.minY-Vs.minY}function Bs(zs){return(zs.maxX-zs.minX)*(zs.maxY-zs.minY)}function qs(zs){return zs.maxX-zs.minX+(zs.maxY-zs.minY)}function Ms(zs,Vs){return(Math.max(Vs.maxX,zs.maxX)-Math.min(Vs.minX,zs.minX))*(Math.max(Vs.maxY,zs.maxY)-Math.min(Vs.minY,zs.minY))}function _s(zs,Vs){var ks=Math.max(zs.minX,Vs.minX),Xs=Math.max(zs.minY,Vs.minY),Is=Math.min(zs.maxX,Vs.maxX),Ys=Math.min(zs.maxY,Vs.maxY);return Math.max(0,Is-ks)*Math.max(0,Ys-Xs)}function Ss(zs,Vs){return zs.minX<=Vs.minX&&zs.minY<=Vs.minY&&Vs.maxX<=zs.maxX&&Vs.maxY<=zs.maxY}function Ts(zs,Vs){return Vs.minX<=zs.maxX&&Vs.minY<=zs.maxY&&Vs.maxX>=zs.minX&&Vs.maxY>=zs.minY}function Ds(zs){return{children:zs,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-(1/0),maxY:-(1/0)}}function Rs(zs,Vs,ks,Xs,Is){for(var Ys,Os=[Vs,ks];Os.length;)ks=Os.pop(),Vs=Os.pop(),ks-Vs<=Xs||(Ys=Vs+Math.ceil((ks-Vs)/Xs/2)*Xs,Fs(zs,Ys,Vs,ks,Is),Os.push(Vs,Ys,Ys,ks))}vs.exports=Cs;var Fs=bs('quickselect');Cs.prototype={all:function(){return this._all(this.data,[])},search:function(zs){var Vs=this.data,ks=[],Xs=this.toBBox;if(!Ts(zs,Vs))return ks;for(var Is,Ys,Os,Us,Ws=[];Vs;){for(Is=0,Ys=Vs.children.length;Is<Ys;Is++)Os=Vs.children[Is],Us=Vs.leaf?Xs(Os):Os,Ts(zs,Us)&&(Vs.leaf?ks.push(Os):Ss(zs,Us)?this._all(Os,ks):Ws.push(Os));Vs=Ws.pop()}return ks},collides:function(zs){var Vs=this.data,ks=this.toBBox;if(!Ts(zs,Vs))return!1;for(var Xs,Is,Ys,Os,Us=[];Vs;){for(Xs=0,Is=Vs.children.length;Xs<Is;Xs++)if(Ys=Vs.children[Xs],Os=Vs.leaf?ks(Ys):Ys,Ts(zs,Os)){if(Vs.leaf||Ss(zs,Os))return!0;Us.push(Ys)}Vs=Us.pop()}return!1},load:function(zs){if(!zs||!zs.length)return this;if(zs.length<this._minEntries){for(var Vs=0,ks=zs.length;Vs<ks;Vs++)this.insert(zs[Vs]);return this}var Xs=this._build(zs.slice(),0,zs.length-1,0);if(!this.data.children.length)this.data=Xs;else if(this.data.height===Xs.height)this._splitRoot(this.data,Xs);else{if(this.data.height<Xs.height){var Is=this.data;this.data=Xs,Xs=Is}this._insert(Xs,this.data.height-Xs.height-1,!0)}return this},insert:function(zs){return zs&&this._insert(zs,this.data.height-1),this},clear:function(){return this.data=Ds([]),this},remove:function(zs,Vs){if(!zs)return this;for(var ks,Xs,Is,Ys,Os=this.data,Us=this.toBBox(zs),Ws=[],Gs=[];Os||Ws.length;){if(Os||(Os=Ws.pop(),Xs=Ws[Ws.length-1],ks=Gs.pop(),Ys=!0),Os.leaf&&(Is=Ns(zs,Os.children,Vs),-1!==Is))return Os.children.splice(Is,1),Ws.push(Os),this._condense(Ws),this;Ys||Os.leaf||!Ss(Os,Us)?Xs?(ks++,Os=Xs.children[ks],Ys=!1):Os=null:(Ws.push(Os),Gs.push(ks),ks=0,Xs=Os,Os=Os.children[0])}return this},toBBox:function(zs){return zs},compareMinX:ws,compareMinY:As,toJSON:function(){return this.data},fromJSON:function(zs){return this.data=zs,this},_all:function(zs,Vs){for(var ks=[];zs;)zs.leaf?Vs.push.apply(Vs,zs.children):ks.push.apply(ks,zs.children),zs=ks.pop();return Vs},_build:function(zs,Vs,ks,Xs){var Is,Ys=ks-Vs+1,Os=this._maxEntries;if(Ys<=Os)return Is=Ds(zs.slice(Vs,ks+1)),Ps(Is,this.toBBox),Is;Xs||(Xs=Math.ceil(Math.log(Ys)/Math.log(Os)),Os=Math.ceil(Ys/Math.pow(Os,Xs-1))),Is=Ds([]),Is.leaf=!1,Is.height=Xs;var Us,Ws,Gs,Hs,Zs=Math.ceil(Ys/Os),Js=Zs*Math.ceil(Math.sqrt(Os));for(Rs(zs,Vs,ks,Js,this.compareMinX),Us=Vs;Us<=ks;Us+=Js)for(Gs=Math.min(Us+Js-1,ks),Rs(zs,Us,Gs,Zs,this.compareMinY),Ws=Us;Ws<=Gs;Ws+=Zs)Hs=Math.min(Ws+Zs-1,Gs),Is.children.push(this._build(zs,Ws,Hs,Xs-1));return Ps(Is,this.toBBox),Is},_chooseSubtree:function(zs,Vs,ks,Xs){for(var Is,Ys,Os,Us,Ws,Gs,Hs,Zs;;){if(Xs.push(Vs),Vs.leaf||Xs.length-1===ks)break;for(Hs=Zs=1/0,Is=0,Ys=Vs.children.length;Is<Ys;Is++)Os=Vs.children[Is],Ws=Bs(Os),Gs=Ms(zs,Os)-Ws,Gs<Zs?(Zs=Gs,Hs=Ws<Hs?Ws:Hs,Us=Os):Gs==Zs&&Ws<Hs&&(Hs=Ws,Us=Os);Vs=Us||Vs.children[0]}return Vs},_insert:function(zs,Vs,ks){var Xs=this.toBBox,Is=ks?zs:Xs(zs),Ys=[],Os=this._chooseSubtree(Is,this.data,Vs,Ys);for(Os.children.push(zs),js(Os,Is);0<=Vs&&Ys[Vs].children.length>this._maxEntries;)this._split(Ys,Vs),Vs--;this._adjustParentBBoxes(Is,Ys,Vs)},_split:function(zs,Vs){var ks=zs[Vs],Xs=ks.children.length,Is=this._minEntries;this._chooseSplitAxis(ks,Is,Xs);var Ys=this._chooseSplitIndex(ks,Is,Xs),Os=Ds(ks.children.splice(Ys,ks.children.length-Ys));Os.height=ks.height,Os.leaf=ks.leaf,Ps(ks,this.toBBox),Ps(Os,this.toBBox),Vs?zs[Vs-1].children.push(Os):this._splitRoot(ks,Os)},_splitRoot:function(zs,Vs){this.data=Ds([zs,Vs]),this.data.height=zs.height+1,this.data.leaf=!1,Ps(this.data,this.toBBox)},_chooseSplitIndex:function(zs,Vs,ks){var Xs,Is,Ys,Os,Us,Ws,Gs,Hs;for(Ws=Gs=1/0,Xs=Vs;Xs<=ks-Vs;Xs++)Is=Ls(zs,0,Xs,this.toBBox),Ys=Ls(zs,Xs,ks,this.toBBox),Os=_s(Is,Ys),Us=Bs(Is)+Bs(Ys),Os<Ws?(Ws=Os,Hs=Xs,Gs=Us<Gs?Us:Gs):Os==Ws&&Us<Gs&&(Gs=Us,Hs=Xs);return Hs},_chooseSplitAxis:function(zs,Vs,ks){var Xs=zs.leaf?this.compareMinX:ws,Is=zs.leaf?this.compareMinY:As,Ys=this._allDistMargin(zs,Vs,ks,Xs),Os=this._allDistMargin(zs,Vs,ks,Is);Ys<Os&&zs.children.sort(Xs)},_allDistMargin:function(zs,Vs,ks,Xs){zs.children.sort(Xs);var Is,Ys,Os=this.toBBox,Us=Ls(zs,0,Vs,Os),Ws=Ls(zs,ks-Vs,ks,Os),Gs=qs(Us)+qs(Ws);for(Is=Vs;Is<ks-Vs;Is++)Ys=zs.children[Is],js(Us,zs.leaf?Os(Ys):Ys),Gs+=qs(Us);for(Is=ks-Vs-1;Is>=Vs;Is--)Ys=zs.children[Is],js(Ws,zs.leaf?Os(Ys):Ys),Gs+=qs(Ws);return Gs},_adjustParentBBoxes:function(zs,Vs,ks){for(var Xs=ks;0<=Xs;Xs--)js(Vs[Xs],zs)},_condense:function(zs){for(var Vs,ks=zs.length-1;0<=ks;ks--)0===zs[ks].children.length?0<ks?(Vs=zs[ks-1].children,Vs.splice(Vs.indexOf(zs[ks]),1)):this.clear():Ps(zs[ks],this.toBBox)},_initFormat:function(zs){var Vs=['return a',' - b',';'];this.compareMinX=new Function('a','b',Vs.join(zs[0])),this.compareMinY=new Function('a','b',Vs.join(zs[1])),this.toBBox=new Function('a','return {minX: a'+zs[0]+', minY: a'+zs[1]+', maxX: a'+zs[2]+', maxY: a'+zs[3]+'};')}}},{quickselect:2}],2:[function(bs,vs){function Cs(Ps,Ls,js,ws,As){for(;ws>js;){if(600<ws-js){var Bs=ws-js+1,qs=Ls-js+1,Ms=Math.log(Bs),_s=.5*Math.exp(2*Ms/3),Ss=.5*Math.sqrt(Ms*_s*(Bs-_s)/Bs)*(0>qs-Bs/2?-1:1),Ts=Math.max(js,Math.floor(Ls-qs*_s/Bs+Ss)),Ds=Math.min(ws,Math.floor(Ls+(Bs-qs)*_s/Bs+Ss));Cs(Ps,Ls,Ts,Ds,As)}var Rs=Ps[Ls],Fs=js,zs=ws;for(Ns(Ps,js,Ls),0<As(Ps[ws],Rs)&&Ns(Ps,js,ws);Fs<zs;){for(Ns(Ps,Fs,zs),Fs++,zs--;0>As(Ps[Fs],Rs);)Fs++;for(;0<As(Ps[zs],Rs);)zs--}0===As(Ps[js],Rs)?Ns(Ps,js,zs):(zs++,Ns(Ps,zs,ws)),zs<=Ls&&(js=zs+1),Ls<=zs&&(ws=zs-1)}}function Ns(Ps,Ls,js){var ws=Ps[Ls];Ps[Ls]=Ps[js],Ps[js]=ws}vs.exports=Cs},{}]},{},[1])(1)});class yn extends cn{constructor(bs,vs){super(bs,vs),this.edges={total:0,duplicate:0,circular:0},this.nodes={total:0,isolated:0,fragment:[],collinear:[],duplicate:[]},bs!=void 0&&(this.nodes.total+=bs),vs!=void 0&&(this.edges.total+=vs)}fragmentedNodes(bs){return this.nodes.fragment=bs,this.nodes.total+=bs.length,this}collinearNodes(bs){return this.nodes.collinear=bs,this.nodes.total+=bs.length,this}duplicateNodes(bs){return this.nodes.duplicate=bs,this.nodes.total+=bs.length,this}join(bs){this.nodes.total+=bs.nodes.total,this.edges.total+=bs.edges.total,this.nodes.isolated+=bs.nodes.isolated,this.edges.duplicate+=bs.edges.duplicate,this.edges.circular+=bs.edges.circular;var vs=bs;return void 0!=vs.nodes.fragment&&(this.nodes.fragment=this.nodes.fragment.concat(vs.nodes.fragment)),void 0!=vs.nodes.collinear&&(this.nodes.collinear=this.nodes.collinear.concat(vs.nodes.collinear)),void 0!=vs.nodes.duplicate&&(this.nodes.duplicate=this.nodes.duplicate.concat(vs.nodes.duplicate)),this}}class xn extends hn{copy(){return new $e(this.x,this.y)}junction(){return this.graph.unclean&&this.graph.clean(),this.graph.junctions.slice().filter(function(bs){return bs.origin===this},this).shift()}sectors(){return this.graph.unclean&&this.graph.clean(),this.graph.sectors.filter(function(bs){return bs.origin===this},this)}interiorAngles(){return this.junction().interiorAngles()}adjacentFaces(){return this.graph.unclean&&this.graph.clean(),this.graph.faces.filter(function(bs){return 0<bs.nodes.filter(function(vs){return vs===this},this).length},this)}adjacentEdges(){return this.graph.edges.filter(function(bs){return bs.nodes[0]===this||bs.nodes[1]===this},this).map(function(bs){var vs=bs.otherNode(this);return{edge:bs,angle:Math.atan2(vs.y-this.y,vs.x-this.x)}},this).map(function(bs){return 0>bs.angle&&(bs.angle+=2*Math.PI),bs}).sort(function(bs,vs){return bs.angle-vs.angle}).map(function(bs){return bs.edge})}setPosition(bs,vs){return this.x=bs,this.y=vs,this}transform(bs){var vs=new $e(this.x*bs.a+this.y*bs.c+bs.tx,this.x*bs.b+this.y*bs.d+bs.ty);return this.x=vs.x,this.y=vs.y,this}translate(bs,vs){return this.x+=bs,this.y+=vs,this}rotate(bs,vs){return this.transform(new Ke().rotation(bs,vs))}reflect(bs){var vs=bs.direction==void 0?new $e(bs.nodes[0].x,bs.nodes[0].y):bs.point||bs.origin,Es=bs.direction==void 0?new $e(bs.nodes[1].x,bs.nodes[1].y).subtract(vs):bs.direction;return this.transform(new Ke().reflection(Es,vs))}equivalent(bs,vs){return new $e(this.x,this.y).equivalent(bs,vs)}normalize(){var bs=this.magnitude();return new $e(this.x/bs,this.y/bs)}dot(bs){return this.x*bs.x+this.y*bs.y}cross(bs){return this.x*bs.y-this.y*bs.x}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}distanceTo(bs){return Math.sqrt(Math.pow(this.x-bs.x,2)+Math.pow(this.y-bs.y,2))}rotate90(){return new $e(-this.y,this.x)}rotate180(){return new $e(-this.x,-this.y)}rotate270(){return new $e(this.y,-this.x)}lerp(bs,vs){var Es=1-vs;return new $e(this.x*vs+bs.x*Es,this.y*vs+bs.y*Es)}midpoint(bs){return new $e(0.5*(this.x+bs.x),0.5*(this.y+bs.y))}scale(bs){return new $e(this.x*bs,this.y*bs)}add(bs,vs){if(U(bs))return new $e(this.x+bs.x,this.y+bs.y);return W(vs)?new $e(this.x+bs,this.y+vs):void 0}subtract(bs){return new $e(this.x-bs.x,this.y-bs.y)}multiply(bs){return new $e(this.x*bs.x,this.y*bs.y)}abs(){return new $e(Math.abs(this.x),Math.abs(this.y))}commonX(bs,vs){return G(this.x,bs.x,vs)}commonY(bs,vs){return G(this.y,bs.y,vs)}}class mn extends pn{copy(){return new nn(this.nodes[0].copy(),this.nodes[1].copy())}adjacentFaces(){return this.graph.unclean&&this.graph.clean(),this.graph.faces.filter(function(bs){return 0<bs.edges.filter(function(vs){return vs===this},this).length},this)}boundingBox(bs){bs==void 0&&(bs=0);var vs=this.nodes[0].x<this.nodes[1].x?[this.nodes[0].x,this.nodes[1].x]:[this.nodes[1].x,this.nodes[0].x],Es=this.nodes[0].y<this.nodes[1].y?[this.nodes[0].y,this.nodes[1].y]:[this.nodes[1].y,this.nodes[0].y],Cs=2*bs;return new on(vs[0]-bs,Es[0]-bs,vs[1]-vs[0]+Cs,Es[1]-Es[0]+Cs)}intersection(bs,vs){if(!('function'==typeof bs.isAdjacentToEdge&&this.isAdjacentToEdge(bs))){var Es=this.copy().intersection(bs.copy(),vs);if(void 0!=Es&&!(Es.equivalent(this.nodes[0],vs)||Es.equivalent(this.nodes[1],vs)))return Es}}transform(bs){return new nn(this.nodes[0].transform(bs),this.nodes[1].transform(bs))}parallel(bs,vs){return new nn(this).parallel(new nn(bs),vs)}collinear(bs,vs){return new nn(this).collinear(bs,vs)}equivalent(bs,vs){return this.nodes[0].equivalent(bs.nodes[0],vs)&&this.nodes[1].equivalent(bs.nodes[1],vs)||this.nodes[0].equivalent(bs.nodes[1],vs)&&this.nodes[1].equivalent(bs.nodes[0],vs)}degenrate(bs){return this.nodes[0].equivalent(this.nodes[1],bs)}length(){return Math.sqrt(Math.pow(this.nodes[0].x-this.nodes[1].x,2)+Math.pow(this.nodes[0].y-this.nodes[1].y,2))}vector(bs){return void 0==bs?this.nodes[1].subtract(this.nodes[0]):this.nodes[0].equivalent(bs)?this.nodes[1].subtract(this.nodes[0]):this.nodes[0].subtract(this.nodes[1])}reflectionMatrix(){return new Ke().reflection(this.nodes[1].subtract(this.nodes[0]),this.nodes[0])}nearestPoint(bs){var vs=this.nearestPointNormalTo(bs);return void 0===vs?this.nodes.map(function(Es){return{point:Es,distance:Es.distanceTo(bs)}},this).sort(function(Es,Cs){return Es.distance-Cs.distance}).shift().point:vs}nearestPointNormalTo(bs){var vs=this.nodes[0].distanceTo(this.nodes[1]),Es=((bs.x-this.nodes[0].x)*(this.nodes[1].x-this.nodes[0].x)+(bs.y-this.nodes[0].y)*(this.nodes[1].y-this.nodes[0].y))/Math.pow(vs,2);return 0>Es||1<Es?void 0:new $e(this.nodes[0].x+Es*(this.nodes[1].x-this.nodes[0].x),this.nodes[0].y+Es*(this.nodes[1].y-this.nodes[0].y))}midpoint(){return new $e(0.5*(this.nodes[0].x+this.nodes[1].x),0.5*(this.nodes[0].y+this.nodes[1].y))}perpendicularBisector(){return new Qe(this.midpoint(),this.vector().rotate90())}infiniteLine(){return new Qe(this.nodes[0],this.nodes[1].subtract(this.nodes[0]))}}class fn extends an{constructor(bs){super(),this.graph=bs,this.nodes=[],this.edges=[]}sectors(){if(this.graph.unclean);var bs=this.graph.sectors.filter(function(vs){return 0<this.nodes.filter(function(Es){return Es===vs.origin},this).length},this);return this.edges.map(function(vs,Es){var Cs=this.edges[(Es+1)%this.edges.length];return bs.filter(function(Ns){return Ns.edges[1]===vs&&Ns.edges[0]===Cs},this).shift()},this)}commonEdges(bs){return this.edges.filter(function(vs){return 0<bs.edges.filter(function(Es){return Es===vs},this).length},this)}uncommonEdges(bs){return this.edges.filter(function(vs){return 0==bs.edges.filter(function(Es){return Es===vs},this).length},this)}edgeAdjacentFaces(){var bs=this.graph.faces.filter(function(vs){return!this.equivalent(vs)},this);return this.edges.map(function(vs){for(var Cs,Es=0;Es<bs.length;Es++)if(Cs=bs[Es].edges.filter(function(Ns){return vs===Ns}),0<Cs.length)return bs[Es]},this).filter(function(vs){return vs!==void 0})}nodeAdjacentFaces(){var bs=this.graph.faces.filter(function(vs){return!this.equivalent(vs)},this);return this.nodes.map(function(vs){for(var Cs,Es=0;Es<bs.length;Es++)if(Cs=bs[Es].nodes.filter(function(Ns){return vs===Ns}),0<Cs.length)return bs[Es]},this).filter(function(vs){return vs!==void 0})}adjacentFaceArray(){this.graph.unclean?this.graph.clean():this.graph.faceArrayDidChange();var bs=this,vs=[bs],Es=[[{face:bs,parent:void 0}]];do{var Cs=[];Es[Es.length-1].forEach(function(Ns){Cs=Cs.concat(Ns.face.edgeAdjacentFaces().filter(function(Ps){return 0==vs.filter(function(Ls){return Ls===Ps},this).length},this).map(function(Ps){return vs.push(Ps),{face:Ps,parent:Ns}},this))}),Es[Es.length]=Cs}while(0<Es[Es.length-1].length);return 0<Es.length&&0==Es[Es.length-1].length&&Es.pop(),Es}adjacentFaceTree(){var bs=this.adjacentFaceArray();bs[0][0].tree=new Je(bs[0][0].face);for(var vs=1;vs<bs.length;vs++)for(var Cs,Es=0;Es<bs[vs].length;Es++)Cs=new Je(bs[vs][Es].face),Cs.parent=bs[vs][Es].parent.tree,Cs.parent.children.push(Cs),bs[vs][Es].tree=Cs;return bs[0][0].tree}}class bn extends ln{constructor(bs,vs){super(bs.commonNodeWithEdge(vs),void 0);void 0===this.origin||bs===vs||(this.edges=[bs,vs],this.endPoints=[bs.nodes[0]===this.origin?bs.nodes[1]:bs.nodes[0],vs.nodes[0]===this.origin?vs.nodes[1]:vs.nodes[0]])}equivalent(bs){return bs.edges[0].isSimilarToEdge(this.edges[0])&&bs.edges[1].isSimilarToEdge(this.edges[1])||bs.edges[0].isSimilarToEdge(this.edges[1])&&bs.edges[1].isSimilarToEdge(this.edges[0])}}class vn{constructor(bs){(this.origin=bs,this.sectors=[],this.edges=[],void 0!==bs)&&(this.edges=this.origin.adjacentEdges(),1>=this.edges.length||(this.sectors=this.edges.map(function(vs,Es){return new this.origin.graph.sectorType(vs,this.edges[(Es+1)%this.edges.length])},this)))}nodes(){return this.edges.map(function(bs){return bs.otherNode(this.origin)},this)}faces(){return this.origin.graph.unclean&&this.origin.graph.clean(),this.origin.graph.faces.filter(function(bs){return 0<bs.nodes.filter(function(vs){return vs===this.origin},this).length},this)}edgeAngles(){return this.nodes().map(function(bs){return new $e(bs.x,bs.y).subtract(this.origin)}).map(function(bs){return Math.atan2(bs.y,bs.x)},this)}edgeVectors(){return this.edges.map(function(bs){return bs.vector(this.origin)},this)}edgeVectorsNormalized(){return this.edges.map(function(bs){return bs.vector(this.origin).normalize()},this)}sectorWithEdges(bs,vs){var Es;return this.sectors.forEach(function(Cs){if(Cs.edges[0].equivalent(bs)&&Cs.edges[1].equivalent(vs)||Cs.edges[1].equivalent(bs)&&Cs.edges[0].equivalent(vs))return Es=Cs,Es},this),Es}interiorAngles(){return this.sectors.map(function(bs){return bs.angle()},this)}clockwiseNode(bs){for(var vs=0;vs<this.edges.length;vs++)if(this.edges[vs].otherNode(this.origin)===bs)return this.edges[(vs+this.edges.length-1)%this.edges.length].otherNode(this.origin)}counterClockwiseNode(bs){for(var vs=0;vs<this.edges.length;vs++)if(this.edges[vs].otherNode(this.origin)===bs)return this.edges[(vs+1)%this.edges.length].otherNode(this.origin)}clockwiseEdge(bs){var vs=this.edges.indexOf(bs);return-1===vs?void 0:this.edges[(vs+this.edges.length-1)%this.edges.length]}counterClockwiseEdge(bs){var vs=this.edges.indexOf(bs);return-1===vs?void 0:this.edges[(vs+1)%this.edges.length]}}class En extends un{constructor(){super(),this.faces=[],this.sectors=[],this.junctions=[],this.nodeType=xn,this.edgeType=mn,this.faceType=fn,this.sectorType=bn,this.junctionType=vn}clean(bs){this.unclean=!1;var vs=new yn;return vs.join(this.cleanDuplicateNodes(bs)),this.fragmentCollinearNodes(bs),vs.join(this.cleanDuplicateNodes(bs)),vs.join(this.fragment(bs)),vs.join(this.cleanDuplicateNodes(bs)),vs.join(this.cleanGraph()),vs.join(this.cleanAllNodes()),this.nodeArrayDidChange(),this.edgeArrayDidChange(),this.generateJunctionsAndSectors(),this.generateFaces(),vs}cleanEdges(bs,vs){this.unclean=!1;var Es=new yn;return Es.join(this.cleanDuplicateNodes(vs)),bs.map(function(Cs){return this.fragmentOneEdge(Cs,vs)},this).forEach(function(Cs){Es.join(Cs)},this),Es.join(this.cleanDuplicateNodes(vs)),Es.join(this.cleanGraph()),Es.join(this.cleanAllNodes()),this.nodeArrayDidChange(),this.edgeArrayDidChange(),this.generateJunctionsAndSectors(),this.generateFaces(),Es}generateJunctionsAndSectors(){this.junctions=this.nodes.map(function(bs){return new this.junctionType(bs)},this).filter(function(bs){return bs!==void 0&&1<bs.edges.length},this),this.sectors=this.junctions.map(function(bs){return bs.sectors},this).reduce(function(bs,vs){return bs.concat(vs)},[]).filter(function(bs){return bs!==void 0},this),this.junctionArrayDidChange(),this.sectorArrayDidChange()}generateFaces(){for(var Cs,bs=this.edges.map(function(Ps){return[this.counterClockwiseCircuit(Ps.nodes[0],Ps.nodes[1]),this.counterClockwiseCircuit(Ps.nodes[1],Ps.nodes[0])]},this).reduce(function(Ps,Ls){return Ps.concat(Ls)},[]).filter(function(Ps){return Ps!=void 0},this).map(function(Ps){return this.faceFromCircuit(Ps)},this).filter(function(Ps){return Ps!=void 0},this),vs=[],Es=0;Es<bs.length;Es++){Cs=!1;for(var Ns=0;Ns<vs.length;Ns++)if(bs[Es].equivalent(vs[Ns])){Cs=!0;break}Cs||vs.push(bs[Es])}this.faces=vs,this.faceArrayDidChange()}newPlanarNode(bs,vs){return this.unclean=!0,this.newNode().setPosition(bs,vs)}newPlanarEdge(bs,vs,Es,Cs){this.unclean=!0;var Ns=this.newNode().setPosition(bs,vs),Ps=this.newNode().setPosition(Es,Cs);return this.newEdge(Ns,Ps)}newPlanarEdgeFromNode(bs,vs,Es){this.unclean=!0;var Cs=this.newNode().setPosition(vs,Es);return this.newEdge(bs,Cs)}newPlanarEdgeBetweenNodes(bs,vs){return this.unclean=!0,this.newEdge(bs,vs)}clear(){return this.nodes=[],this.edges=[],this.faces=[],this.sectors=[],this.junctions=[],this}removeEdge(bs){var vs=this.edges.length,Es=[bs.nodes[0],bs.nodes[1]];return this.edges=this.edges.filter(function(Cs){return Cs!==bs}),new yn(0,vs-this.edges.length).join(this.cleanNode(Es[0])).join(this.cleanNode(Es[1]))}removeEdgeBetween(bs,vs){var Es=this.edges.length;return this.edges=this.edges.filter(function(Cs){return(Cs.nodes[0]!==bs||Cs.nodes[1]!==vs)&&(Cs.nodes[0]!==vs||Cs.nodes[1]!==bs)}),this.edgeArrayDidChange(),new yn(0,Es-this.edges.length).join(this.cleanNode(bs)).join(this.cleanNode(vs))}cleanNode(bs){var vs=this.edges.filter(function(Ns){return Ns.nodes[0]===bs||Ns.nodes[1]===bs},this);switch(vs.length){case 0:return this.nodes=this.nodes.filter(function(Ns){return Ns!==bs}),this.nodeArrayDidChange(),new yn(1,0);case 2:var Es=[vs[0].uncommonNodeWithEdge(vs[1]),vs[1].uncommonNodeWithEdge(vs[0])];if(void 0===Es[0]||void 0===Es[1])return new yn;var Cs=new nn(Es[0].x,Es[0].y,Es[1].x,Es[1].y);if(Cs.collinear(bs))return vs[0].nodes=[Es[0],Es[1]],this.edges=this.edges.filter(function(Ns){return Ns!==vs[1]}),this.nodes=this.nodes.filter(function(Ns){return Ns!==bs}),this.nodeArrayDidChange(),this.edgeArrayDidChange(),new yn(1,1);default:return new yn;}}cleanAllNodes(){this.nodes.forEach(function(Ps){Ps.cache.adjE=[]}),this.edges.forEach(function(Ps){Ps.nodes[0].cache.adjE.push(Ps),Ps.nodes[1].cache.adjE.push(Ps)});var bs=new yn().join(this.removeIsolatedNodes());this.nodeArrayDidChange(),this.edgeArrayDidChange();for(var Es,vs=this.nodes.length-1;0<=vs;vs--)switch(Es=this.nodes[vs].cache.adjE,Es.length){case 0:bs.join(this.removeNode(this.nodes[vs]));break;case 2:var Cs=[Es[0].uncommonNodeWithEdge(Es[1]),Es[1].uncommonNodeWithEdge(Es[0])],Ns=new nn(Cs[0].x,Cs[0].y,Cs[1].x,Cs[1].y);Ns.collinear(this.nodes[vs])&&(Es[0].nodes=[Cs[0],Cs[1]],this.edges.splice(Es[1].index,1),this.edgeArrayDidChange(),this.nodes.splice(this.nodes[vs].index,1),this.nodeArrayDidChange(),bs.join(new yn(1,1)));}return this.nodes.forEach(function(Ps){Ps.cache.adjE=void 0}),bs}cleanDuplicateNodes(bs){void 0==bs&&(bs=1e-8);var Es=new rbush;Es.load(this.nodes.map(function(Ls){return{minX:Ls.x-bs,minY:Ls.y-bs,maxX:Ls.x+bs,maxY:Ls.y+bs,node:Ls}}));var Cs=[],Ns=[],Ps=[];return this.nodes.forEach(function(Ls){Es.search({minX:Ls.x-bs,minY:Ls.y-bs,maxX:Ls.x+bs,maxY:Ls.y+bs}).filter(function(js){return Ls!==js.node},this).filter(function(js){return-1==Cs.indexOf(js.node)},this).filter(function(){return-1==Ns.indexOf(Ls)},this).forEach(function(js){Cs.push(Ls),Ns.push(js.node),Ps.push({remain:Ls,remove:js.node})},this)},this),Ps.map(function(Ls){return new yn(-1).join(this.mergeNodes(Ls.remain,Ls.remove)).duplicateNodes([new $e(Ls.remove.x,Ls.remove.y)])},this).reduce(function(Ls,js){return Ls.join(js)},new yn)}nearest(bs,vs){var Es=H(bs,vs),Cs=this.faceContainingPoint(Es),Ns=this.edges.map(function(qs){return{edge:qs,distance:qs.nearestPoint(Es).distanceTo(Es)}},this).sort(function(qs,Ms){return qs.distance-Ms.distance})[0],Ps=Ns==void 0?void 0:Ns.edge,Ls=Ps===void 0?void 0:Ps.nodes.slice().sort(function(qs,Ms){return qs.distanceTo(Es)-Ms.distanceTo(Es)}).shift();if(Ls==void 0){var js=this.nodes.map(function(qs){return{node:qs,distance:Es.distanceTo(qs)}},this).sort(function(qs,Ms){return qs.distance-Ms.distance}).shift();Ls=js==void 0?void 0:js.node}var ws=Ls==void 0?void 0:Ls.junction();if(ws===void 0){var As=this.junctions.map(function(qs){return{junction:qs,distance:Es.distanceTo(qs.origin)}},this).sort(function(qs,Ms){return qs.distance-Ms.distance}).shift();ws=As===void 0?void 0:As.junction}var Bs=ws===void 0?void 0:ws.sectors.filter(function(qs){return qs.contains(Es)},this).shift();return{node:Ls,edge:Ps,face:Cs,junction:ws,sector:Bs}}faceContainingPoint(bs){for(var vs=0;vs<this.faces.length;vs++)if(this.faces[vs].contains(bs))return this.faces[vs]}nearestNodes(bs,vs,Es){var Cs=H(vs,Es),Ns=this.nodes.map(function(Ps){return{node:Ps,distance:Cs.distanceTo(Ps)}},this).sort(function(Ps,Ls){return Ps.distance-Ls.distance}).map(function(Ps){return Ps.node},this);return bs>Ns.length?Ns:Ns.slice(0,bs)}nearestEdge(bs,vs,Es){var Cs=H(vs,Es);bs.map(function(Ns){return{edge:Ns,distance:Ns.nearestPoint(Cs).distanceTo(Cs)}},this).sort(function(Ns,Ps){return Ns.distance-Ps.distance}).slice(0)}nearestEdges(bs,vs,Es){var Cs=H(vs,Es),Ns=this.edges.map(function(Ps){return{edge:Ps,distance:Ps.nearestPoint(Cs).distanceTo(Cs)}},this).sort(function(Ps,Ls){return Ps.distance-Ls.distance});return bs>Ns.length?Ns:Ns.slice(0,bs)}nearestEdgeWithPoints(bs,vs,Es,Cs){var Ns=Z(bs,vs,Es,Cs);if(void 0!==Ns){var Ps=Ns.map(function(Bs){return this.nodes.map(function(qs){return{n:qs,d:Bs.distanceTo(qs)}},this).sort(function(qs,Ms){return qs.d-Ms.d}).map(function(){return bs.n},this)},this);if(0!=Ps[0].length&&0!=Ps[1].length){var Ls=this.getEdgeConnectingNodes(Ps[0][0],Ps[1][0]);if(void 0!==Ls)return Ls;for(var js=3;20>js;js+=3)for(var ws=0;ws<Ps[0].length;ws++)for(var As=0;As<Ps[1].length;As++)if(ws!==As){var Ls=this.getEdgeConnectingNodes(Ps[0][ws],Ps[1][As]);if(void 0!==Ls)return Ls}}}}bounds(){if(void 0!==this.nodes&&0!==this.nodes.length){var bs=Infinity,vs=Infinity,Es=-Infinity,Cs=-Infinity;return this.nodes.forEach(function(Ns){Ns.x>Es&&(Es=Ns.x),Ns.x<bs&&(bs=Ns.x),Ns.y>Cs&&(Cs=Ns.y),Ns.y<vs&&(vs=Ns.y)}),new on(bs,vs,Es-bs,Cs-vs)}}getEdgeIntersections(bs){for(var vs=[],Es=0;Es<this.edges.length-1;Es++)for(var Ns,Cs=Es+1;Cs<this.edges.length;Cs++)if(Ns=this.edges[Es].intersection(this.edges[Cs],bs),void 0!=Ns){for(var Ps=!1,Ls=0;Ls<vs.length;Ls++)if(Ns.equivalent(vs[Ls],bs)){Ps=!0;break}Ps||vs.push(Ns)}return vs}scaleToUnitHeight(){var bs=this.bounds(),vs=1/(bs.size.height-bs.origin.y);this.nodes.forEach(function(Es){Es.x=(Es.x-bs.origin.x)*vs,Es.y=(Es.y-bs.origin.y)*vs},this)}scaleToUnitWidth(){var bs=this.bounds(),vs=1/(bs.size.width-bs.origin.x);this.nodes.forEach(function(Es){Es.x=(Es.x-bs.origin.x)*vs,Es.y=(Es.y-bs.origin.y)*vs},this)}fragment(bs){var vs=function(As,Bs){return As.commonX(Bs,bs)?As.y-Bs.y:As.x-Bs.x};void 0==bs&&(bs=1e-9),this.edgeArrayDidChange();for(var Cs=[],Ns=0;Ns<this.edges.length-1;Ns++)for(var Ls,Ps=Ns+1;Ps<this.edges.length;Ps++)Ls=this.edges[Ns].intersection(this.edges[Ps],bs),void 0!=Ls&&Cs.push({point:Ls,edges:[this.edges[Ns],this.edges[Ps]]});for(var Ns=0;Ns<Cs.length-1;Ns++)for(var Ps=Cs.length-1;Ps>Ns;Ps--)Cs[Ns].point.equivalent(Cs[Ps].point,bs)&&(Cs[Ns].point=Cs[Ns].point.lerp(Cs[Ps].point,0.5),Cs[Ns].edges=Cs[Ns].edges.concat(Cs[Ps].edges),Cs.splice(Ps,1));var js=Array.apply(null,Array(this.edges.length)).map(function(){return[]});Cs.map(function(As){return{node:this.newNode().setPosition(As.point.x,As.point.y),edges:As.edges}},this).forEach(function(As){As.edges.forEach(function(Bs){js[Bs.index].push(As.node)},this)},this);js.map(function(As,Bs){As.sort(vs);var qs=this.edges[Bs].nodes.slice().sort(vs);return{edge:this.edges[Bs],endpoints:qs,innerPoints:As}},this).filter(function(As){return 0!=As.innerPoints.length},this).map(function(As){return this.rebuildEdge(As.edge,As.endpoints,As.innerPoints,bs)},this);return this.removeIsolatedNodes(),this.cleanDuplicateNodes(),new yn}fragmentOneEdge(bs,vs){var Es=function(As,Bs){return As.commonX(Bs,vs)?As.y-Bs.y:As.x-Bs.x};void 0==vs&&(vs=1e-9),this.edgeArrayDidChange();for(var Ns=this.edges.filter(function(As){return As!==bs},this).map(function(As){return{point:bs.intersection(As,vs),edges:[bs,As]}},this),Ps=0;Ps<Ns.length-1;Ps++)for(var Ls=Ns.length-1;Ls>Ps;Ls--)Ns[Ps].point.equivalent(Ns[Ls].point,vs)&&(Ns[Ps].point=Ns[Ps].point.lerp(Ns[Ls].point,0.5),Ns[Ps].edges=Ns[Ps].edges.concat(Ns[Ls].edges),Ns.splice(Ls,1));var js=Array.apply(null,Array(this.edges.length)).map(function(){return[]});Ns.map(function(As){return{node:this.newNode().setPosition(As.point.x,As.point.y),edges:As.edges}},this).forEach(function(As){As.edges.forEach(function(Bs){js[Bs.index].push(As.node)},this)},this);js.map(function(As,Bs){As.sort(Es);var qs=this.edges[Bs].nodes.slice().sort(Es);return{edge:this.edges[Bs],endpoints:qs,innerPoints:As}},this).filter(function(As){return 0!=As.innerPoints.length},this).map(function(As){return this.rebuildEdge(As.edge,As.endpoints,As.innerPoints,vs)},this);return this.removeIsolatedNodes(),this.cleanDuplicateNodes(),new yn}fragmentCrossingEdges(bs,vs){var Es=new yn,Cs=this.edgeCrossingEdges(bs,vs);if(0==Cs.length)return Es;var Ns=this.edges.length;Es.nodes.fragment=Cs.map(function(ws){return new $e(ws.point.x,ws.point.y)});var Ps=Cs.map(function(ws){return this.newNode().setPosition(ws.point.x,ws.point.y)},this),Ls=Cs.map(function(ws,As){return this.rebuildEdge(ws.edge,ws.edge.nodes,[Ps[As]],vs)},this).map(function(ws){return ws.nodes}).reduce(function(ws,As){return ws.concat(As)},[]),js=bs.nodes.slice().sort(function(ws,As){return ws.commonX(As,vs)?ws.y-As.y:ws.x-As.x});return Ls=Ls.concat(this.rebuildEdge(bs,js,Ps,vs).nodes),Es.edges.total+=Ns-this.edges.length,Es}edgeCrossingEdges(bs,vs){void 0==vs&&(vs=1e-9);var Cs=bs.nodes.map(function(Ps){return Ps.x}).sort(function(Ps,Ls){return Ps-Ls}),Ns=bs.nodes.map(function(Ps){return Ps.y}).sort(function(Ps,Ls){return Ps-Ls});return Cs[0]-=vs,Cs[1]+=vs,Ns[0]-=vs,Ns[1]+=vs,this.edges.filter(function(Ps){return!(Ps.nodes[0].x<Cs[0]&&Ps.nodes[1].x<Cs[0]||Ps.nodes[0].x>Cs[1]&&Ps.nodes[1].x>Cs[1]||Ps.nodes[0].y<Ns[0]&&Ps.nodes[1].y<Ns[0]||Ps.nodes[0].y>Ns[1]&&Ps.nodes[1].y>Ns[1])},this).filter(function(Ps){return bs!==Ps},this).map(function(Ps){return{edge:Ps,point:bs.intersection(Ps,vs)}},this).filter(function(Ps){return void 0!=Ps.point}).sort(function(Ps,Ls){return Ps.point.commonX(Ls.point,vs)?Ps.point.y-Ls.point.y:Ps.point.x-Ls.point.x})}rebuildEdge(bs,vs,Es,Cs){var Ns=[],Ps=[Es[0],Es[Es.length-1]],Ls=vs.map(function(Bs,qs){return Bs.equivalent(Ps[qs],Cs)},this);Ls[0]?Ns.push(vs[0]):Es.unshift(vs[0]),Ls[1]?Ns.push(vs[1]):Es.push(vs[1]);var js=[];if(1<Es.length)for(var As,ws=0;ws<Es.length-1;ws++)As=this.copyEdge(bs),As.nodes=[Es[ws],Es[ws+1]],js.push(As);return this.edges=this.edges.filter(function(Bs){return Bs!==bs},this),{edges:js,nodes:Ns}}fragmentCollinearNodes(bs){bs==void 0&&(bs=1e-9);var Es=new rbush,Cs=this.nodes.map(function(Ns){return{minX:Ns.x-bs,minY:Ns.y-bs,maxX:Ns.x+bs,maxY:Ns.y+bs,node:Ns}},this);Es.load(Cs),this.edges.forEach(function(Ns){Ns.cache.box=Ns.boundingBox(bs)},this),this.edges.slice().forEach(function(Ns){var Ps=Ns.cache.box;Ps==void 0&&(Ps=Ns.boundingBox(bs));var Ls=Es.search({minX:Ps.origin.x,minY:Ps.origin.y,maxX:Ps.origin.x+Ps.size.width,maxY:Ps.origin.y+Ps.size.height}).filter(function(As){return!Ns.nodes[0].equivalent(As.node,bs)&&!Ns.nodes[1].equivalent(As.node,bs)}).filter(function(As){return Ns.collinear(As.node,bs)});if(Ls.length){var js=Ns.nodes.slice().sort(function(As,Bs){return As.commonX(Bs,bs)?As.y-Bs.y:As.x-Bs.x}),ws=Ls.map(function(As){return As.node},this).sort(function(As,Bs){return As.commonX(Bs,bs)?As.y-Bs.y:As.x-Bs.x});this.rebuildEdge(Ns,js,ws,bs).edges.forEach(function(As){As.cache.box=As.boundingBox(bs)})}},this)}counterClockwiseCircuit(bs,vs){if(void 0!==bs&&void 0!==vs){var Es=bs.graph.getEdgeConnectingNodes(bs,vs);if(void 0!=Es){var Cs=[],Ns=bs,Ps=vs,Ls=[Ns],js=Es;Cs.push(js);do{Ls.push(Ps);var ws=Ps.junction();if(void 0!==ws&&(js=ws.clockwiseEdge(js)),Cs.push(js),Ns=Ps,Ps=js.otherNode(Ns),Ps===bs)return Cs}while(!(0<Ls.filter(function(As){return As===Ps}).length))}}}faceFromCircuit(bs){if(!(void 0==bs||3>bs.length)){var Es=new this.faceType(this);Es.edges=bs,Es.nodes=bs.map(function(Ns,Ps){var Ls=bs[(Ps+1)%bs.length];return Ns.uncommonNodeWithEdge(Ls)});var Cs=Es.nodes.map(function(Ns,Ps){var Ls=Es.nodes[(Ps+1)%Es.nodes.length],js=Es.nodes[(Ps+2)%Es.nodes.length];return A(new $e(Ns.x-Ls.x,Ns.y-Ls.y),new $e(js.x-Ls.x,js.y-Ls.y))},this).reduce(function(Ns,Ps){return Ns+Ps},0);if(2<Es.nodes.length&&Math.abs(Cs/(Es.nodes.length-2)-Math.PI)<1e-12)return Es}}copy(){this.nodeArrayDidChange(),this.edgeArrayDidChange(),this.faceArrayDidChange(),this.sectorArrayDidChange(),this.junctionArrayDidChange();for(var Es,bs=new En,vs=0;vs<this.nodes.length;vs++)Es=bs.addNode(new xn(bs)),Object.assign(Es,this.nodes[vs]),Es.graph=bs,Es.index=vs;for(var vs=0;vs<this.edges.length;vs++){var Cs=[this.edges[vs].nodes[0].index,this.edges[vs].nodes[1].index],Ns=bs.addEdge(new mn(bs,bs.nodes[Cs[0]],bs.nodes[Cs[1]]));Object.assign(Ns,this.edges[vs]),Ns.graph=bs,Ns.index=vs,Ns.nodes=[bs.nodes[Cs[0]],bs.nodes[Cs[1]]]}for(var Ps,vs=0;vs<this.faces.length;vs++){Ps=new fn(bs),Object.assign(Ps,this.faces[vs]);for(var Ls=0;Ls<this.faces[vs].nodes.length;Ls++)Ps.nodes.push(Ps.nodes[this.faces[vs].nodes[Ls].index]);for(var Ls=0;Ls<this.faces[vs].edges.length;Ls++)Ps.edges.push(Ps.edges[this.faces[vs].edges[Ls].index]);Ps.graph=bs,Ps.index=vs,bs.faces.push(Ps)}return bs.sectors=this.sectors.map(function(js,ws){var As=js.edges.map(function(qs){return bs.edges[qs.index]},this),Bs=new bn(As[0],As[1]);return Bs.index=ws,Bs},this),bs.junctions=this.junctions.map(function(js,ws){var As=new vn(void 0);return As.origin=bs.nodes[js.origin.index],As.sectors=js.sectors.map(function(Bs){return bs.sectors[Bs.index]},this),As.edges=js.edges.map(function(Bs){return bs.edges[Bs.index]},this),As.index=ws,As},this),bs}polylines(){return this.connectedGraphs().map(function(bs){if(0!=bs.edges.length){if(1==bs.edges.length)return bs.edges[0].nodes.map(function(Ps){return Ps.copy()},this);for(var vs=[bs.edges[0].uncommonNodeWithEdge(bs.edges[1])],Es=0;Es<bs.edges.length-1;Es++){var Cs=bs.edges[Es],Ns=bs.edges[Es+1];vs.push(Cs.commonNodeWithEdge(Ns))}return vs.push(bs.edges[bs.edges.length-1].uncommonNodeWithEdge(bs.edges[bs.edges.length-2])),vs.map(function(Ps){return Ps.copy()},this)}},this).filter(function(bs){return bs!=void 0},this).map(function(bs){var vs=new sn;return vs.nodes=bs,vs},this)}faceArrayDidChange(){for(var bs=0;bs<this.faces.length;bs++)this.faces[bs].index=bs}sectorArrayDidChange(){for(var bs=0;bs<this.sectors.length;bs++)this.sectors[bs].index=bs}junctionArrayDidChange(){for(var bs=0;bs<this.junctions.length;bs++)this.junctions[bs].index=bs}}class Cn{constructor(bs,vs){this.TOLERANCE=1e-10,bs instanceof Cn?(this.x=bs.x,this.y=bs.y,this.r=bs.r,this.phi=bs.phi):(this.x=J(bs)&&Math.abs(bs)>this.TOLERANCE?bs:0,this.y=J(vs)&&Math.abs(vs)>this.TOLERANCE?vs:0,this.r=Math.sqrt(this.x*this.x+this.y*this.y),0==this.r?this.phi=0:0<=this.y?this.phi=Math.acos(this.x/this.r):0>this.y&&(this.phi=Math.acos(-1*this.x/this.r)+Math.PI))}fromRandPhi(bs,vs){var Es=new Cn;return Es.r=bs,Es.phi=vs,Es.x=bs*Math.cos(vs),Es.y=bs*Math.sin(vs),Math.abs(Es.x)<this.TOLERANCE&&(Es.x=0),Math.abs(Es.y)<this.TOLERANCE&&(Es.y=0),Es}add(bs,vs){var Es=new Cn(bs,vs);return new Cn(this.x+Es.x,this.y+Es.y)}subtract(bs,vs){var Es=new Cn(bs,vs);return new Cn(this.x-Es.x,this.y-Es.y)}multiply(bs,vs){var Es=new Cn(bs,vs);return new Cn(this.x*Es.x-this.y*Es.y,this.y*Es.x+this.x*Es.y)}divide(bs,vs){var Es=new Cn(bs,vs),Cs=Es.x*Es.x+Es.y*Es.y;return new Cn((this.x*Es.x+this.y*Es.y)/Cs,(this.y*Es.x-this.x*Es.y)/Cs)}sqrt(bs){return J(bs)||(bs=0),0==this.r?new Cn:new Cn().fromRandPhi(Math.sqrt(this.r),(this.phi+2*Math.PI*bs)/2)}cubrt(bs){return J(bs)||(bs=0),0==this.r?new Cn:new Cn().fromRandPhi(Math.pow(this.r,1/3),(this.phi+2*Math.PI*bs)/3)}square(){return this.multiply(this)}cube(){return this.square().multiply(this)}equals(bs,vs){var Es=new Cn(bs,vs);return this.x==Es.x&&this.y==Es.y}isZero(){return 0==this.x&&0==this.y}isReal(){return 0==this.y}isImaginary(){return 0==this.x&&0!=this.y}}class Nn{order(){}parameters(){}roots(){}realRoots(){return this.roots().filter(function(bs){return 0==bs.y}).map(function(bs){return bs.x})}}class Pn extends Nn{constructor(bs,vs){super(),this.a=bs instanceof Cn?bs:new Cn(bs),this.b=vs instanceof Cn?vs:new Cn(vs)}order(){return 1}parameters(){return[this.a,this.b]}roots(){return this.a.isZero()?[]:[this.b.multiply(-1).divide(this.a)]}}class Ln extends Nn{constructor(bs,vs,Es){super(),this.a=bs instanceof Cn?bs:new Cn(bs),this.b=vs instanceof Cn?vs:new Cn(vs),this.c=Es instanceof Cn?Es:new Cn(Es)}order(){return 2}parameters(){return[this.a,this.b,this.c]}roots(){if(!this.a.isZero()){var bs=this.b.divide(this.a.multiply(2)),vs=this.c.divide(this.a),Es=bs.square().subtract(vs),Cs=Es.sqrt().subtract(bs),Ns=Es.sqrt(1).subtract(bs),Ps=[Cs];return Cs.equals(Ns)||Ps.push(Ns),Ps}return new Pn(this.b,this.c).roots()}}class jn extends Nn{constructor(bs,vs){super(),this.m=bs instanceof Cn?bs:new Cn(bs),this.n=vs instanceof Cn?vs:new Cn(vs)}order(){return 3}parameters(){return[new Cn(1),new Cn,this.m,this.n]}roots(){var bs=this.m.divide(3).cube(),vs=this.n.divide(2).square().add(bs),Es=vs.sqrt().subtract(this.n.divide(2));Es.isZero()&&(Es=vs.sqrt(1).subtract(this.n.divide(2)));var Cs=Es.cubrt(),Ns=Cs.subtract(this.m.divide(Cs.multiply(3))),Ps=Es.cubrt(1),Ls=Ps.subtract(this.m.divide(Ps.multiply(3))),js=Es.cubrt(2),ws=js.subtract(this.m.divide(js.multiply(3))),As=[Ns];return Ns.equals(Ls)||As.push(Ls),Ns.equals(ws)||Ls.equals(ws)||As.push(ws),As}}class wn extends Nn{constructor(bs,vs,Es,Cs){super(),this.a=bs instanceof Cn?bs:new Cn(bs),this.b=vs instanceof Cn?vs:new Cn(vs),this.c=Es instanceof Cn?Es:new Cn(Es),this.d=Cs instanceof Cn?Cs:new Cn(Cs)}order(){return 3}parameters(){return[this.a,this.b,this.c,this.d]}roots(){if(!this.a.isZero()){var bs=this.b.divide(this.a),vs=this.c.divide(this.a),Es=this.d.divide(this.a),Cs=vs.subtract(bs.square().divide(3)),Ns=Es.subtract(bs.multiply(vs).divide(3)).add(bs.cube().multiply(2/27));return new jn(Cs,Ns).roots().map(function(Ps){return Ps.subtract(bs.divide(3))})}return new Ln(this.b,this.c,this.d).roots()}}class An extends $e{constructor(bs,vs){super(vs.x,vs.y),this.cp=bs}nearest(){return this.cp.nearest(this)}}class Bn extends Qe{constructor(bs,vs){super(vs.point,vs.direction),this.cp=bs}crease(){return this.cp.crease(this)}}class qn extends en{constructor(bs,vs){super(vs.origin,vs.direction),this.cp=bs}crease(){return this.cp.crease(this)}creaseAndRepeat(){return this.cp.creaseRayRepeat(this)}creaseAndStop(){return this.cp.creaseAndStop(this)}}class Mn extends nn{constructor(bs,vs){super(vs.nodes[0],vs.nodes[1]),this.cp=bs}crease(){return this.cp.crease(this)}}const _n=Object.freeze({mark:0,boundary:1,mountain:2,valley:3});class Sn{constructor(bs,vs){this.func=bs,this.args=vs}}class Tn{constructor(){this.endPoints=[],this.intersections=[]}}class Dn extends bn{bisect(){for(var bs=this.vectors(),vs=bs.map(function(Ps){return Math.atan2(Ps.y,Ps.x)});0>vs[0];)vs[0]+=2*Math.PI;for(;0>vs[1];)vs[1]+=2*Math.PI;var Es=w(vs[0],vs[1]),Cs=vs[0]+0.5*Es,Ns=new en(new $e(this.origin.x,this.origin.y),new $e(Math.cos(Cs),Math.sin(Cs)));return new qn(this.origin.graph,Ns)}kawasakiCollapse(){var bs=this.origin.junction();if(0!=bs.edges.length%2){for(var vs=void 0,Es=0;Es<bs.sectors.length;Es++)this.equivalent(bs.sectors[Es])&&(vs=Es);if(void 0!=vs){for(var Ps,Cs=0,Ns=0,Es=0;Es<bs.sectors.length-1;Es++)Ps=(Es+vs+1)%bs.sectors.length,0==Es%2?Cs+=bs.sectors[Ps].angle():Ns+=bs.sectors[Ps].angle();var Ls=Math.PI-Cs,js=this.edges[0].vector(this.origin),ws=Math.atan2(js.y,js.x),As=ws+Ls,Bs=new en(new $e(this.origin.x,this.origin.y),new $e(Math.cos(As),Math.sin(As)));if(this.contains(Bs.origin.add(Bs.direction)))return new qn(this.origin.graph,Bs)}}}}class Rn extends vn{flatFoldable(bs){return this.kawasaki(bs)&&this.maekawa()}alternateAngleSum(){if(0==this.sectors.length%2){var bs=[0,0];return this.sectors.forEach(function(vs,Es){bs[Es%2]+=vs.angle()}),bs}}maekawa(){if(this.origin.isBoundary())return!0;var bs=this.edges.filter(function(Es){return Es.orientation===_n.mountain},this).length,vs=this.edges.filter(function(Es){return Es.orientation===_n.valley},this).length;return 2==Math.abs(bs-vs)}kawasaki(bs){if(void 0===bs&&(bs=1e-4),this.origin.isBoundary())return!0;var vs=this.alternateAngleSum();return void 0!=vs&&Math.abs(vs[0]-vs[1])<bs}kawasakiRating(){var bs=this.alternateAngleSum();return Math.abs(bs[0]-bs[1])}kawasakiSolution(){var bs=this.alternateAngleSum().map(function(vs){return{difference:Math.PI-vs,sectors:[]}});return this.sectors.forEach(function(vs,Es){bs[Es%2].sectors.push(vs)}),bs}kawasakiCollapse(bs){if(0!=this.edges.length%2){var vs;if(void 0!=bs)for(var Es=0;Es<this.sectors.length;Es++)bs.equivalent(this.sectors[Es])&&(vs=Es);if(void 0==vs){for(var Cs,Es=0;Es<this.sectors.length;Es++)if(Cs=this.sectors[Es].kawasakiCollapse(),void 0!=Cs)return Cs;return}for(var Ls,Ns=0,Ps=0,Es=0;Es<this.sectors.length-1;Es++)Ls=(Es+vs+1)%this.sectors.length,0==Es%2?Ns+=this.sectors[Ls].angle():Ps+=this.sectors[Ls].angle();var js=Math.PI-Ns,ws=bs.edges[0].vector(bs.origin),As=Math.atan2(ws.y,ws.x),Bs=As-js,qs=new en(new $e(this.origin.x,this.origin.y),new $e(Math.cos(Bs),Math.sin(Bs)));if(bs.contains(qs.origin.add(qs.direction)))return new qn(this.origin.graph,qs)}}}class Fn extends xn{isBoundary(){return this.graph.boundary.liesOnEdge(this)}alternateAngleSum(){return this.junction().alternateAngleSum()}kawasakiRating(){return this.junction().kawasakiRating()}flatFoldable(bs){return!!this.isBoundary()||this.junction().flatFoldable(bs)}kawasakiCollapse(bs,vs){var Es=this.junction(),Cs=Es.sectorWithEdges(bs,vs);if(Cs!==void 0)return Es.kawasakiCollapse(Cs)}}class zn extends mn{constructor(bs,vs,Es){super(bs,vs,Es),this.orientation=_n.mark,this.newMadeBy=new Tn,this.newMadeBy.endPoints=[vs,Es]}mark(){return this.orientation=_n.mark,this}mountain(){return this.orientation=_n.mountain,this}valley(){return this.orientation=_n.valley,this}boundary(){return this.orientation=_n.boundary,this}creaseToEdge(bs){return this.graph.creaseEdgeToEdge(this,bs)}}class Vn extends zn{constructor(){super(void 0,void 0,void 0),this.orientation=_n.mark,this.newMadeBy=new Tn}mark(){return this}mountain(){return this}valley(){return this}boundary(){return this}}class kn extends fn{rabbitEar(){var bs=this.sectors();if(3!==bs.length)return[];var vs=bs.map(function(Ns){return Ns.bisect()}),Es=vs.map(function(Ns,Ps){var Ls=vs[(Ps+1)%vs.length];return Ns.intersection(Ls)}).reduce(function(Ns,Ps){return Ns.add(Ps)}).scale(1/vs.length),Cs=this.graph.newPlanarNode(Es.x,Es.y);return this.nodes.map(function(Ns){return this.graph.newCreaseBetweenNodes(Ns,Cs)},this)}}class Xn extends En{constructor(){super(),this.nodeType=Fn,this.edgeType=zn,this.faceType=kn,this.sectorType=Dn,this.junctionType=Rn,this.boundary=new rn,this.symmetryLine=void 0,this.square()}clear(){return this.nodes=[],this.edges=[],this.faces=[],this.sectors=[],this.junctions=[],this.symmetryLine=void 0,this.cleanBoundary(),this.clean(),this}cleanBoundary(){this.edges=this.edges.filter(function(vs){return vs.orientation!==_n.boundary}),this.cleanAllNodes();var bs=this.boundary.nodes().map(function(vs){return this.newPlanarNode(vs.x,vs.y)},this);bs.forEach(function(vs,Es){var Cs=bs[(Es+1)%bs.length];this.newPlanarEdgeBetweenNodes(vs,Cs).boundary()},this),this.cleanDuplicateNodes()}contains(bs,vs){var Es=te(bs,vs);return void 0!=Es&&this.boundary.contains(Es)}square(bs){return void 0==bs?bs=1:0>bs&&(bs=Math.abs(bs)),this.setBoundary([[0,0],[bs,0],[bs,bs],[0,bs]],!0)}rectangle(bs,vs){return void 0==bs||void 0==vs?this:(bs=Math.abs(bs),vs=Math.abs(vs),this.setBoundary([[0,0],[bs,0],[bs,vs],[0,vs]],!0))}polygon(bs){return 3>bs?this:this.setBoundary(new rn().regularPolygon(bs).nodes())}noBoundary(){return this.boundary.edges=[],this.cleanBoundary(),this.clean(),this}setBoundary(bs,vs){var Es=bs.map(function(Cs){return te(Cs)},this);return Es[0].equivalent(Es[Es.length-1])&&Es.pop(),!0===vs?this.boundary.setEdgesFromPoints(Es):this.boundary.convexHull(Es),this.cleanBoundary(),this.clean(),this}setMinimumRectBoundary(){var bs=this.bounds();return this.setBoundary([[bs.origin.x,bs.origin.y],[bs.origin.x+bs.size.width,bs.origin.y],[bs.origin.x+bs.size.width,bs.origin.y+bs.size.height],[bs.origin.x,bs.origin.y+bs.size.height]])}noSymmetry(){return this.symmetryLine=void 0,this}bookSymmetry(){var bs=this.boundary.center();return this.symmetryLine=new Qe(bs,new $e(0,1)),this}diagonalSymmetry(){var bs=this.boundary.center();return this.symmetryLine=new Qe(bs,new $e(0.7071,0.7071)),this}setSymmetryLine(bs,vs,Es,Cs){var Ns=ae(bs,vs,Es,Cs);return this.symmetryLine=new Qe(Ns.nodes[0],Ns.nodes[1].subtract(Ns.nodes[1])),this}kawasakiCollapse(bs,vs){if(se(bs)){var Ns=this.nearest(bs,vs).junction;if(j==void 0)return new Vn;var Ps=j.kawasakiCollapse();return Ps==void 0?new Vn:Ps.crease()}if(oe(bs)&&oe(vs)){var Ns=this.nearest(bs,vs).junction;if(void 0==j)return new Vn;var Ps=j.kawasakiCollapse();return void 0==Ps?new Vn:Ps.crease()}}point(bs,vs){return new An(this,te(bs,vs))}line(bs,vs,Es,Cs){return new Bn(this,le(bs,vs,Es,Cs))}ray(bs,vs,Es,Cs){return new qn(this,re(bs,vs,Es,Cs))}edge(bs,vs,Es,Cs){return new Mn(this,ae(bs,vs,Es,Cs))}axiom1(bs,vs,Es,Cs){var Ns=de(bs,vs,Es,Cs);return void 0===Ns?void 0:new Bn(this,new Qe(Ns[0],Ns[1].subtract(Ns[0])))}axiom2(bs,vs,Es,Cs){var Ns=de(bs,vs,Es,Cs);return new Bn(this,new Qe(Ns[1].midpoint(Ns[0]),Ns[1].subtract(Ns[0]).rotate90()))}axiom3(bs,vs){return new nn(bs).infiniteLine().bisect(new nn(vs).infiniteLine()).map(function(Es){return new Bn(this,Es)},this)}axiom4(bs,vs){return new Bn(this,new Qe(vs,new nn(bs).vector().rotate90()))}axiom5(bs,vs,Es){for(var Cs=Math.sqrt(Math.pow(bs.x-vs.x,2)+Math.pow(bs.y-vs.y,2)),Ns=new dn(bs,Cs).intersection(new nn(Es).infiniteLine()),Ps=[],Ls=0;Ls<Ns.length;Ls++)Ps.push(this.axiom2(vs,Ns[Ls]));return Ps}axiom6(bs,vs,Es,Cs){var Ns=bs.x,Ps=bs.y;if(0!=Es.nodes[1].x-Es.nodes[0].x)var Ls=(Es.nodes[1].y-Es.nodes[0].y)/(Es.nodes[1].x-Es.nodes[0].x),js=Es.nodes[0].y-Ls*Es.nodes[0].x;else var ws=Es.nodes[0].x;var As=vs.x,Bs=vs.y;if(0!=Cs.nodes[1].x-Cs.nodes[0].x)var qs=(Cs.nodes[1].y-Cs.nodes[0].y)/(Cs.nodes[1].x-Cs.nodes[0].x),Ms=Cs.nodes[0].y-qs*Cs.nodes[0].x;else var _s=Cs.nodes[0].x;if(void 0!==Ls&&void 0!==qs)var Ss=Ls*Ls+1,Ts=2*Ls*js,Ds=js*js-Ns*Ns-Ps*Ps,Rs=qs*qs+1,Fs=2*qs*Ms,zs=Ms*Ms-As*As-Bs*Bs,Vs=qs*Ns+(js-Ps),ks=Ns*(Ms-Bs)-As*(js-Ps),Xs=qs-Ls,Is=Ls*As+(Ms-Bs),Ys=Ls*Ns+(js-Ps);else if(void 0===Ls&&void 0===qs)Ss=1,Ts=0,Ds=ws*ws-Ns*Ns-Ps*Ps,Rs=1,Fs=0,zs=_s*_s-As*As-Bs*Bs,Vs=ws-Ns,ks=Ps*(_s-As)-Bs*(ws-Ns),Xs=0,Is=_s-As,Ys=Vs;else{if(void 0===Ls){var Os=Ns;Ns=As,As=Os;var Us=Ps;Ps=Bs,Bs=Us,Ls=qs,qs=void 0,js=Ms,Ms=void 0,_s=ws,ws=void 0}Ss=Ls*Ls+1,Ts=2*Ls*js,Ds=js*js-Ns*Ns-Ps*Ps,Rs=1,Fs=0,zs=_s*_s-As*As-Bs*Bs,Vs=Ns,ks=(js-Ps)*(_s-As)-Ns*Bs,Xs=1,Is=-Ls*(_s-As)-Bs,Ys=Ls*Ns+(js-Ps)}var Ws=Ss*Vs*Vs+Ts*Vs*Xs+Ds*Xs*Xs,Gs=2*Ss*Vs*ks+Ts*(Vs*Is+ks*Xs)+2*Ds*Xs*Is,Hs=Ss*ks*ks+Ts*ks*Is+Ds*Is*Is,Zs=Rs*Xs*Ys,Js=(Rs*Is+Fs*Xs)*Ys-Ws,Ks=(Fs*Is+zs*Xs)*Ys-Gs,$s=zs*Is*Ys-Hs,Qs=new wn(Zs,Js,Ks,$s).realRoots(),eo=[];if(Qs!=void 0&&0<Qs.length)for(var no=0;no<Qs.length;++no){if(void 0!==Ls&&void 0!==qs)var so=Qs[no],oo=qs*so+Ms;else void 0===Ls&&void 0===qs?(oo=Qs[no],so=_s):(oo=Qs[no],so=_s);if(oo!=Bs){var io=-1*(so-As)/(oo-Bs),to=(oo*oo-Bs*Bs+so*so-As*As)/(2*(oo-Bs));eo.push(this.axiom1(new $e(0,to),new $e(1,io+to)))}else{var ao=(so+As)/2;eo.push(this.axiom1(new $e(ao,0),new $e(ao,1)))}}return eo}axiom7(bs,vs,Es){var Cs=new Qe(bs,new nn(Es).vector()),Ns=Cs.intersection(new nn(vs).infiniteLine());return void 0===Ns?void 0:this.axiom2(bs,Ns)}newCreaseBetweenNodes(){return this.unclean=!0,this.newEdge(a,b)}newCrease(bs,vs,Es,Cs){this.creaseSymmetry(bs,vs,Es,Cs);var Ns=this.newPlanarEdge(bs,vs,Es,Cs);return void 0!==this.didChange&&this.didChange(void 0),Ns}creaseSymmetry(bs,vs,Es,Cs){if(void 0!==this.symmetryLine){var Ns=new $e(bs,vs).reflect(this.symmetryLine),Ps=new $e(Es,Cs).reflect(this.symmetryLine);return this.newPlanarEdge(Ns.x,Ns.y,Ps.x,Ps.y)}}crease(bs,vs,Es,Cs){if(bs instanceof Qe)return this.creaseLine(bs);if(bs instanceof nn)return this.creaseEdge(bs);if(bs instanceof en)return this.creaseRay(bs);var Ns=ae(bs,vs,Es,Cs);if(void 0!==Ns){var Ps=this.boundary.clipEdge(Ns);return void 0===Ps?void 0:this.newCrease(Ps.nodes[0].x,Ps.nodes[0].y,Ps.nodes[1].x,Ps.nodes[1].y)}}creaseAndStop(bs,vs,Es,Cs){if(bs instanceof Qe){var Ns=bs.rays().map(function(Bs){return Bs.intersectionsWithEdges(this.edges).shift()},this).filter(function(Bs){return Bs!=void 0},this);return 2>Ns.length?this.creaseLine(bs):this.creaseEdge(Ns[0],Ns[1])}if(bs instanceof en){var Ps=bs.intersectionsWithEdges(this.edges).filter(function(Bs){return!Bs.equivalent(bs.origin)}),Ls=Ps.shift();return void 0==Ls?this.creaseRay(bs):this.creaseEdge(bs.origin,Ls)}var js=ae(bs,vs,Es,Cs),ws=new en(js.nodes[0],new $e(js.nodes[1].x-js.nodes[0].x,js.nodes[1].y-js.nodes[0].y)),As=ws.clipWithEdgesDetails(this.edges).shift();return void 0==As?void 0:As.edge.length()<js.length()?this.creaseEdge(As.edge):this.creaseEdge(js)}creaseAndReflect(bs,vs){return bs instanceof Qe?bs.rays().map(function(Ns){return this.creaseRayRepeat(Ns)},this).reduce(function(Ns,Ps){return Ns.concat(Ps)},[]):bs instanceof en?this.creaseRayRepeat(bs):se(bs)&&se(vs)?this.creaseRayRepeat(new en(bs,vs)):void 0}creaseLine(bs,vs,Es,Cs){var Ns=le(bs,vs,Es,Cs);if(void 0!==Ns){var Ps=this.boundary.clipLine(Ns);return void 0===Ps?void 0:this.newCrease(Ps.nodes[0].x,Ps.nodes[0].y,Ps.nodes[1].x,Ps.nodes[1].y)}}creaseRay(bs,vs,Es,Cs){var Ns=re(bs,vs,Es,Cs);if(void 0!==Ns){var Ps=this.boundary.clipRay(Ns);if(void 0!==Ps){var Ls=this.newCrease(Ps.nodes[0].x,Ps.nodes[0].y,Ps.nodes[1].x,Ps.nodes[1].y);return Ls}}}creaseEdge(bs,vs,Es,Cs){var Ns=ae(bs,vs,Es,Cs);if(void 0!==Ns){var Ps=this.boundary.clipEdge(Ns);return void 0===Ps?void 0:this.newCrease(Ps.nodes[0].x,Ps.nodes[0].y,Ps.nodes[1].x,Ps.nodes[1].y)}}creaseRayUntilIntersection(bs,vs){var Es=bs.clipWithEdgesDetails(this.edges);if(0<Es.length){if(vs!==void 0){var Cs=new nn(bs.origin.x,bs.origin.y,vs.x,vs.y);if(Es[0].edge.length()>Cs.length())return this.crease(Cs)}return this.crease(Es[0].edge)}}creaseLineRepeat(bs,vs,Es,Cs){var Ns=re(bs,vs,Es,Cs);return this.creaseRayRepeat(Ns).concat(this.creaseRayRepeat(Ns.flip()))}creaseRayRepeat(bs,vs){return new sn().rayReflectRepeat(bs,this.edges,vs).edges().map(function(Es){return this.crease(Es)},this).filter(function(Es){return Es!=void 0})}creasePolyline(bs){return bs.edges().map(function(vs){return this.crease(vs)},this).filter(function(vs){return vs!=void 0})}creaseThroughPoints(bs,vs,Es,Cs){var Ns=this.axiom1(bs,vs,Es,Cs);if(void 0!==Ns){var Ps=Ns.crease();return Ps}}creasePointToPoint(bs,vs,Es,Cs){var Ns=this.axiom2(bs,vs,Es,Cs);if(void 0!==Ns){var Ps=Ns.crease();return Ps}}creaseEdgeToEdge(bs,vs){return this.axiom3(bs,vs).map(function(Es){return Es.crease()},this).filter(function(Es){return Es!==void 0},this)}creasePerpendicularThroughPoint(bs,vs){var Es=this.axiom4(bs,vs);if(void 0!==Es){var Cs=Es.crease();return Cs}}creasePointToLine(bs,vs,Es){return this.axiom5(bs,vs,Es).map(function(Cs){return Cs.crease()},this).filter(function(Cs){return Cs!==void 0},this)}creasePointsToLines(bs,vs,Es,Cs){return this.axiom6(bs,vs,Es,Cs).map(function(Ns){return Ns.crease()},this).filter(function(Ns){return Ns!==void 0},this)}creasePerpendicularPointOntoLine(bs,vs,Es){var Cs=this.axiom7(bs,vs,Es);if(void 0!==Cs){var Ns=Cs.crease();return Ns}}pleat(bs,vs,Es){var Cs=new nn(vs.nodes[0].x,vs.nodes[0].y,vs.nodes[1].x,vs.nodes[1].y),Ns=new nn(Es.nodes[0].x,Es.nodes[0].y,Es.nodes[1].x,Es.nodes[1].y);return Cs.infiniteLine().subsect(Ns.infiniteLine(),bs).map(function(Ps){return this.boundary.clipLine(Ps)},this).filter(function(Ps){return Ps!=void 0},this).map(function(Ps){return this.newCrease(Ps.nodes[0].x,Ps.nodes[0].y,Ps.nodes[1].x,Ps.nodes[1].y)},this)}glitchPleat(bs,vs,Es){var Cs=new nn(bs.nodes[0].x,bs.nodes[0].y,bs.nodes[1].x,bs.nodes[1].y),Ns=new nn(vs.nodes[0].x,vs.nodes[0].y,vs.nodes[1].x,vs.nodes[1].y),Ps=Cs.nodes[0].subtract(Cs.nodes[1]),Ls=Ns.nodes[0].subtract(Ns.nodes[1]);return Array.apply(null,Array(Es-1)).map(function(js,ws){return(ws+1)/Es},this).map(function(js){var ws=Cs.nodes[0].lerp(Ns.nodes[0],js),As=Ps.lerp(Ls,js);return this.boundary.clipLine(new Qe(ws,As))},this).filter(function(js){return js!==void 0},this).map(function(js){return this.newCrease(js.nodes[0].x,js.nodes[0].y,js.nodes[1].x,js.nodes[1].y)},this)}availableAxiomFolds(){var bs=[];return bs=bs.concat(this.availableAxiom1Folds()),bs=bs.concat(this.availableAxiom2Folds()),bs=bs.concat(this.availableAxiom3Folds()),bs}availableAxiom1Folds(){for(var bs=[],vs=0;vs<this.nodes.length-1;vs++)for(var Es=vs+1;Es<this.nodes.length;Es++){var Cs=new nn(this.nodes[vs],this.nodes[Es]),Ns=this.boundary.clipLine(Cs.infiniteLine());if(Ns!==void 0){var Ps=new Mn(this,Ns);Ps.madeBy=new Sn(this.creaseThroughPoints,[new $e(this.nodes[vs].x,this.nodes[vs].y),new $e(this.nodes[Es].x,this.nodes[Es].y)]),bs.push(Ps)}}return bs}availableAxiom2Folds(){for(var bs=[],vs=0;vs<this.nodes.length-1;vs++)for(var Es=vs+1;Es<this.nodes.length;Es++){var Cs=new nn(this.nodes[vs],this.nodes[Es]),Ns=this.boundary.clipLine(Cs.perpendicularBisector());if(Ns!==void 0){var Ps=new Mn(this,Ns);Ps.madeBy=new Sn(this.creasePointToPoint,[new $e(this.nodes[vs].x,this.nodes[vs].y),new $e(this.nodes[Es].x,this.nodes[Es].y)]),bs.push(Ps)}}return bs}availableAxiom3Folds(){for(var bs=[],vs=0;vs<this.edges.length-1;vs++)for(var Es=vs+1;Es<this.edges.length;Es++){var Cs=this.edges[vs].infiniteLine(),Ns=this.edges[Es].infiniteLine(),Ps=Cs.bisect(Ns).map(function(js){return this.boundary.clipLine(js)},this).filter(function(js){return js!==void 0},this),Ls=Ps.map(function(js){var ws=new Mn(this,js);return ws.madeBy=new Sn(this.creaseEdgeToEdge,[this.edges[vs].copy(),this.edges[Es].copy()]),ws},this);bs=bs.concat(Ls)}return bs}availableAxiom4Folds(){for(var bs=[],vs=0;vs<this.edges.length;vs++)for(var Es=0;Es<this.nodes.length;Es++){var Cs=new $e(this.nodes[Es].x,this.nodes[Es].y),Ns=this.boundary.clipLine(new Qe(Cs,this.edges[vs].vector().rotate90()));if(Ns!=void 0){var Ps=new Mn(this,Ns);Ps.madeBy=new Sn(this.creasePerpendicularThroughPoint,[Cs,new nn(this.edges[vs].nodes[0].copy(),this.edges[vs].nodes[1].copy())]),bs.push(Ps)}}return bs}wiggle(bs){bs===void 0&&(bs=1e-5);for(var Ns,vs=this.edges.forEach(function(Ts){return Ts.length()}),Es=0,Cs=0;Cs<this.nodes.length;Cs++)if(Ns=this.nodes[Cs].kawasakiRating(),Ns>bs){Es++;for(var Ps=[],Ls=0;12>Ls;Ls++){var js=20*(Math.random()*Math.PI),ws=Math.random()*Ns,As=new $e(0.05*ws*Math.cos(js),0.05*ws*Math.sin(js));this.nodes[Cs].x+=As.x,this.nodes[Cs].y+=As.y;for(var Bs=this.nodes[Cs].kawasakiRating(),qs=this.nodes[Cs].adjacentNodes(),Ms=0,_s=0;_s<qs.length;_s++)Ms+=this.nodes[Cs].kawasakiRating();Ps.push({xy:As,rating:Bs+Ms}),this.nodes[Cs].x-=As.x,this.nodes[Cs].y-=As.y}var Ss=Ps.sort(function(Ts,Ds){return Ts.rating-Ds.rating});this.nodes[Cs].x+=Ss[0].xy.x,this.nodes[Cs].y+=Ss[0].xy.y}return Es}flatFoldable(){return this.nodes.map(function(bs){return bs.flatFoldable()}).reduce(function(bs,vs){return bs&&vs})}boundaryBounds(){return this.boundary.minimumRect()}bottomEdge(){return this.edges.filter(function(bs){return bs.orientation===_n.boundary}).sort(function(bs,vs){return vs.nodes[0].y+vs.nodes[1].y-(bs.nodes[0].y+bs.nodes[1].y)}).shift()}topEdge(){return this.edges.filter(function(bs){return bs.orientation===_n.boundary}).sort(function(bs,vs){return bs.nodes[0].y+bs.nodes[1].y-(vs.nodes[0].y+vs.nodes[1].y)}).shift()}rightEdge(){return this.edges.filter(function(bs){return bs.orientation===_n.boundary}).sort(function(bs,vs){return vs.nodes[0].x+vs.nodes[1].x-(bs.nodes[0].x+bs.nodes[1].x)}).shift()}leftEdge(){return this.edges.filter(function(bs){return bs.orientation===_n.boundary}).sort(function(bs,vs){return bs.nodes[0].x+bs.nodes[1].x-(vs.nodes[0].x+vs.nodes[1].x)}).shift()}overlapRelationMatrix(){this.clean();var bs=Array.apply(null,Array(this.faces.length)).map(function(){return Array.apply(null,Array(this.faces.length))},this),vs=this.faces.map(function(Es){return Es.edgeAdjacentFaces()},this);return vs.forEach(function(Es,Cs){var Ns=this.faces[Cs];Es.filter(function(Ps){return void 0==bs[Ns.index][Ps.index]},this).forEach(function(Ps){var Ls=Ns.commonEdges(Ps).shift();switch(Ls.orientation){case _n.mountain:bs[Ns.index][Ps.index]=!0;break;case _n.valley:bs[Ns.index][Ps.index]=!1;}},this)},this),console.log(bs),void 0}removeAllMarks(){for(var bs=this.edges.length-1;0<=bs;bs--)this.edges[bs].orientation===_n.mark&&(bs-=this.removeEdge(this.edges[bs]).edges.total-1);return this.clean(),this}fold(bs){function vs(ws){ws.children.forEach(function(As){var Bs=As.obj.commonEdges(As.parent.obj).shift().reflectionMatrix();As.matrix=As.parent.matrix.mult(Bs),Ls.push({face:As.obj,matrix:As.matrix}),vs(As)},this)}this.clean();var Es=this.copy().removeAllMarks();if(void 0==bs){var Cs=Es.boundaryBounds();bs=Es.nearest(Cs.origin.x+0.5*Cs.size.width,Cs.origin.y+0.5*Cs.size.height).face}else{var Ns=bs.centroid();bs=Es.nearest(Ns.x,Ns.y).face}if(void 0!==bs){var Ps=bs.adjacentFaceTree(),Ls=[];Ps.matrix=new Ke,Ls.push({face:Ps.obj,matrix:Ps.matrix}),vs(Ps);var js=Array.apply(!1,Array(Es.nodes.length));return Ls.forEach(function(ws){ws.face.nodes.filter(function(As){return!js[As.index]},this).forEach(function(As){As.transform(ws.matrix),js[As.index]=!0},this)},this),Es.exportFoldFile()}}foldSVG(bs){function vs(js){js.children.forEach(function(ws){var As=ws.obj.commonEdges(ws.parent.obj).shift().reflectionMatrix();ws.matrix=ws.parent.matrix.mult(As),Ps.push({face:ws.obj,matrix:ws.matrix}),vs(ws)},this)}this.clean();var Es=this.copy().removeAllMarks();if(void 0==bs){var Cs=Es.boundaryBounds();bs=Es.nearest(Cs.origin.x+0.5*Cs.size.width,Cs.origin.y+0.5*Cs.size.height).face}if(void 0!==bs){var Ns=bs.adjacentFaceTree(),Ps=[];Ns.matrix=new Ke,Ps.push({face:Ns.obj,matrix:Ns.matrix}),vs(Ns);var Ls=Array.apply(!1,Array(Es.nodes.length));return Ps.forEach(function(js){js.face.nodes.filter(function(ws){return!Ls[ws.index]},this).forEach(function(ws){ws.transform(js.matrix),Ls[ws.index]=!0},this)},this),Es.exportSVG()}}importCreasePattern(bs){this.nodes=bs.nodes,this.edges=bs.edges,this.faces=bs.faces,this.junctions=bs.junctions,this.sectors=bs.sectors,this.boundary=bs.boundary,this.symmetryLine=bs.symmetryLine,this.foldSequence=bs.foldSequence}export(bs){switch(bs.toLowerCase()){case'fold':return this.exportFoldFile();case'svg':return this.exportSVG();}}exportFoldFile(){this.nodeArrayDidChange(),this.edgeArrayDidChange();var bs={file_spec:1,file_creator:'Rabbit Ear',file_author:'',file_classes:['singleModel'],vertices_coords:this.nodes.map(function(vs){return[ie(vs.x,12),ie(vs.y,12)]},this),faces_vertices:this.faces.map(function(vs){return vs.nodes.map(function(Es){return Es.index},this)},this),edges_vertices:this.edges.map(function(vs){return vs.nodes.map(function(Es){return Es.index},this)},this),edges_assignment:this.edges.map(function(vs){switch(vs.orientation){case _n.boundary:return'B';case _n.mountain:return'M';case _n.valley:return'V';case _n.mark:return'F';default:return'U';}},this)};return bs}importFoldFile(bs,vs){if(void 0!==bs&&void 0!==bs.vertices_coords&&void 0!==bs.edges_vertices){void 0!==bs.frame_attributes&&bs.frame_attributes.contains('3D')&&console.log('importFoldFile(): FOLD file marked as \'3D\', this library only supports 2D. attempting import anyway, expect a possible distortion due to orthogonal projection.'),this.noBoundary(),this.clear(),bs.vertices_coords.forEach(function(Ns){this.newPlanarNode(Ns[0]||0,Ns[1]||0)},this),this.nodeArrayDidChange(),bs.edges_vertices.map(function(Ns){return Ns.map(function(Ps){return this.nodes[Ps]},this)},this).filter(function(Ns){return void 0!==Ns[0]&&void 0!==Ns[1]},this).forEach(function(Ns){this.newPlanarEdgeBetweenNodes(Ns[0],Ns[1])},this),this.edgeArrayDidChange();var Es={B:_n.boundary,M:_n.mountain,V:_n.valley,F:_n.mark,U:_n.mark};bs.edges_assignment.map(function(Ns){return Es[Ns]}).forEach(function(Ns,Ps){this.edges[Ps].orientation=Ns},this),this.faces=bs.faces_vertices.map(function(Ns){var Ls=new kn(this);return Ls.nodes=Ns.map(function(js){return this.nodes[js]},this),Ls.edges=Ls.nodes.map(function(js,ws){var As=Ls.nodes[(ws+1)%Ls.nodes.length];return this.getEdgeConnectingNodes(js,As)},this),Ls},this),this.faceArrayDidChange();var Cs=this.edges.filter(function(Ns){return Ns.orientation===_n.boundary},this).map(function(Ns){return[new $e(Ns.nodes[0].x,Ns.nodes[0].y),new $e(Ns.nodes[1].x,Ns.nodes[1].y)]},this);return this.setBoundary([].concat.apply([],Cs)),this.clean(vs),this}}importSVG(bs){var vs=K(bs);return this.importCreasePattern(vs),this}exportSVG(bs){(void 0===bs||0>=bs)&&(bs=600);var vs=this.boundaryBounds(),Es=vs.size.width,Cs=vs.size.height,Ns=bs/Es,Ps=[vs.origin.x,vs.origin.y],Ls=ie(Es*Ns).toString(),js=ie(Cs*Ns).toString(),ws=ie(4*(0.0025*(Es*Ns))).toString(),Bs=2*(0.0025*(Es*Ns)),qs=0.5>Bs?0.5:ie(Bs).toString();0==qs&&(qs=0.5);var Ss='stroke="#000000" ',Ts='<?xml version="1.0" encoding="utf-8"?>\n<!-- generated by Rabbit Ear https://rabbitear.org -->\n<svg version="1.1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="'+Ls+'px" height="'+js+'px" viewBox="0 0 '+Ls+' '+js+'">\n',Ds=[_n.mark,_n.valley,_n.mountain,_n.boundary],Rs=[Ss,'stroke="#4379FF" stroke-linecap="round" stroke-dasharray="'+ws+','+ws+'" ','stroke="#EE1032" ',Ss],Fs=['marks','valley','mountain','boundary'],zs=Ds.map(function(Vs){return this.edges.filter(function(ks){return ks.orientation==Vs},this)},this);return zs.unshift(this.edges.filter(function(Vs){return 0==Ds.filter(function(ks){return ks==Vs.orientation},this).length},this)),Fs.unshift('other'),Rs.unshift(Ss),zs.forEach(function(Vs,ks){if(0!=Vs.length){Ts+='<g id="'+Fs[ks]+'">\n';var Xs=Rs[ks];Vs.forEach(function(Is){var Ys=Is.nodes.map(function(Os){return[Os.x,Os.y]},this).reduce(function(Os,Us){return Os.concat(Us)},[]).map(function(Os,Us){return(Os-Ps[Us%2])*Ns},this).map(function(Os){return ie(Os,12).toString()},this);Ts+='\t<line '+Xs+'stroke-width="'+qs+'" x1="'+Ys[0]+'" y1="'+Ys[1]+'" x2="'+Ys[2]+'" y2="'+Ys[3]+'"/>\n'},this),Ts+='</g>\n'}},this),Ts+='</svg>\n',Ts}exportSVGMin(bs){(void 0===bs||0>=bs)&&(bs=600);var vs=this.boundaryBounds(),Es=vs.size.width,Cs=vs.size.height,Ns=vs.origin.x,Ps=vs.origin.y,Ls=bs/(Es+2*Ns),js=(0.0025*(Es*Ls)).toFixed(1);('0'===js||'0.0'===js)&&(js='0.5');for(var ws=this.polylines(),As='<?xml version="1.0" encoding="utf-8"?>\n<!-- generated by Rabbit Ear https://rabbitear.org -->\n<svg version="1.1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="'+(Es+2*Ns)*Ls+'px" height="'+(Cs+2*Ps)*Ls+'px" viewBox="0 0 '+(Es+2*Ns)*Ls+' '+(Cs+2*Ps)*Ls+'">\n<g>\n',Bs=0;Bs<ws.length;Bs++)if(0<=ws[Bs].nodes.length){As+='<polyline fill="none" stroke-width="'+js+'" stroke="#000000" points="';for(var Ms,qs=0;qs<ws[Bs].nodes.length;qs++)Ms=ws[Bs].nodes[qs],As+=ie(Ls*Ms.x,12).toString()+','+ie(Ls*Ms.y,12).toString()+' ';As+='"/>\n'}return As+='</g>\n</svg>\n',As}kiteBase(){return this.importFoldFile({vertices_coords:[[0,0],[1,0],[1,1],[0,1],[0.4142135623730955,0],[1,0.5857864376269045]],faces_vertices:[[2,3,5],[3,0,4],[3,1,5],[1,3,4]],edges_vertices:[[2,3],[3,0],[3,1],[3,4],[0,4],[4,1],[3,5],[1,5],[5,2]],edges_assignment:['B','B','V','M','B','B','M','B','B']})}fishBase(){return this.importFoldFile({vertices_coords:[[0,0],[1,0],[1,1],[0,1],[0.292893218813,0.292893218813],[0.707106781187,0.707106781187],[0.292893218813,0],[1,0.707106781187]],faces_vertices:[[2,3,5],[3,0,4],[3,1,5],[1,3,4],[4,0,6],[1,4,6],[5,1,7],[2,5,7]],edges_vertices:[[2,3],[3,0],[3,1],[0,4],[1,4],[3,4],[1,5],[2,5],[3,5],[4,6],[0,6],[6,1],[5,7],[1,7],[7,2]],edges_assignment:['B','B','V','M','M','M','M','M','M','V','B','B','V','B','B']})}birdBase(){return this.importFoldFile({vertices_coords:[[0,0],[1,0],[1,1],[0,1],[0.5,0.5],[0.207106781187,0.5],[0.5,0.207106781187],[0.792893218813,0.5],[0.5,0.792893218813],[0.353553390593,0.646446609407],[0.646446609407,0.646446609407],[0.646446609407,0.353553390593],[0.353553390593,0.353553390593],[0,0.5],[0.5,0],[1,0.5],[0.5,1]],faces_vertices:[[3,5,9],[5,3,13],[0,5,13],[5,0,12],[4,5,12],[5,4,9],[0,6,12],[6,0,14],[1,6,14],[6,1,11],[4,6,11],[6,4,12],[1,7,11],[7,1,15],[2,7,15],[7,2,10],[4,7,10],[7,4,11],[2,8,10],[8,2,16],[3,8,16],[8,3,9],[4,8,9],[8,4,10]],edges_vertices:[[3,5],[0,5],[4,5],[0,6],[1,6],[4,6],[1,7],[2,7],[4,7],[2,8],[3,8],[4,8],[5,9],[9,8],[9,4],[3,9],[8,10],[10,7],[4,10],[10,2],[7,11],[11,6],[4,11],[11,1],[6,12],[12,5],[0,12],[12,4],[5,13],[0,13],[13,3],[6,14],[0,14],[14,1],[7,15],[1,15],[15,2],[8,16],[3,16],[16,2]],edges_assignment:['M','M','M','M','M','M','M','M','M','M','M','M','F','F','F','F','F','F','V','V','F','F','F','F','F','F','V','V','V','B','B','V','B','B','V','B','B','V','B','B']})}frogBase(){return this.importFoldFile({vertices_coords:[[0,0],[1,0],[1,1],[0,1],[0.5,0.5],[0,0.5],[0.5,0],[1,0.5],[0.5,1],[0.146446609407,0.353553390593],[0.353553390593,0.146446609407],[0.646446609407,0.146446609407],[0.853553390593,0.353553390593],[0.853553390593,0.646446609407],[0.646446609407,0.853553390593],[0.353553390593,0.853553390593],[0.146446609407,0.646446609407],[0,0.353553390593],[0,0.646446609407],[0.353553390593,0],[0.646446609407,0],[1,0.353553390593],[1,0.646446609407],[0.646446609407,1],[0.353553390593,1]],faces_vertices:[[0,4,9],[4,0,10],[4,2,14],[2,4,13],[3,4,15],[4,3,16],[4,1,12],[1,4,11],[4,5,9],[5,4,16],[4,6,11],[6,4,10],[4,7,13],[7,4,12],[4,8,15],[8,4,14],[0,9,17],[9,5,17],[10,0,19],[6,10,19],[1,11,20],[11,6,20],[12,1,21],[7,12,21],[2,13,22],[13,7,22],[14,2,23],[8,14,23],[3,15,24],[15,8,24],[16,3,18],[5,16,18]],edges_vertices:[[0,4],[4,2],[3,4],[4,1],[4,5],[4,6],[4,7],[4,8],[0,9],[4,9],[5,9],[4,10],[0,10],[6,10],[1,11],[4,11],[6,11],[4,12],[1,12],[7,12],[2,13],[4,13],[7,13],[4,14],[2,14],[8,14],[3,15],[4,15],[8,15],[4,16],[3,16],[5,16],[9,17],[0,17],[17,5],[16,18],[5,18],[18,3],[10,19],[0,19],[19,6],[11,20],[6,20],[20,1],[12,21],[1,21],[21,7],[13,22],[7,22],[22,2],[14,23],[8,23],[23,2],[15,24],[3,24],[24,8]],edges_assignment:['V','V','V','M','V','V','V','V','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','V','B','B','V','B','B','V','B','B','V','B','B','V','B','B','V','B','B','V','B','B','V','B','B']})}copy(){this.nodeArrayDidChange(),this.edgeArrayDidChange(),this.faceArrayDidChange();var bs=new Xn;bs.nodes=[],bs.edges=[],bs.faces=[],bs.boundary=void 0;for(var Es,vs=0;vs<this.nodes.length;vs++)Es=bs.addNode(new Fn(bs)),Object.assign(Es,this.nodes[vs]),Es.graph=bs,Es.index=vs;for(var vs=0;vs<this.edges.length;vs++){var Cs=[this.edges[vs].nodes[0].index,this.edges[vs].nodes[1].index],Ns=bs.addEdge(new zn(bs,bs.nodes[Cs[0]],bs.nodes[Cs[1]]));Object.assign(Ns,this.edges[vs]),Ns.graph=bs,Ns.index=vs,Ns.nodes=[bs.nodes[Cs[0]],bs.nodes[Cs[1]]]}for(var Ps,vs=0;vs<this.faces.length;vs++)if(Ps=new fn(bs),bs.faces.push(Ps),Ps.graph=bs,Ps.index=vs,void 0!==this.faces[vs]){if(void 0!==this.faces[vs].nodes)for(var js,Ls=0;Ls<this.faces[vs].nodes.length;Ls++)js=this.faces[vs].nodes[Ls].index,Ps.nodes.push(bs.nodes[js]);if(void 0!==this.faces[vs].edges)for(var ws,Ls=0;Ls<this.faces[vs].edges.length;Ls++)ws=this.faces[vs].edges[Ls].index,Ps.edges.push(bs.edges[ws])}return bs.sectors=this.sectors.map(function(As,Bs){var qs=As.edges.map(function(_s){return bs.edges[_s.index]},this),Ms=new Dn(qs[0],qs[1]);return Ms.index=Bs,Ms},this),bs.junctions=this.junctions.map(function(As,Bs){var qs=new Rn(void 0);return qs.origin=bs.nodes[As.origin.index],qs.sectors=As.sectors.map(function(Ms){return bs.sectors[Ms.index]},this),qs.edges=As.edges.map(function(Ms){return bs.edges[Ms.index]},this),qs.index=Bs,qs},this),bs.boundary=this.boundary.copy(),bs}}pe.prototype={constructor:pe,insert:function(bs,vs){var Es,Cs,Ns;if(bs){if(vs.P=bs,vs.N=bs.N,bs.N&&(bs.N.P=vs),bs.N=vs,bs.R){for(bs=bs.R;bs.L;)bs=bs.L;bs.L=vs}else bs.R=vs;Es=bs}else this._?(bs=me(this._),vs.P=null,vs.N=bs,bs.P=bs.L=vs,Es=bs):(vs.P=vs.N=null,this._=vs,Es=null);for(vs.L=vs.R=null,vs.U=Es,vs.C=!0,bs=vs;Es&&Es.C;)Cs=Es.U,Es===Cs.L?(Ns=Cs.R,Ns&&Ns.C?(Es.C=Ns.C=!1,Cs.C=!0,bs=Cs):(bs===Es.R&&(ye(this,Es),bs=Es,Es=bs.U),Es.C=!1,Cs.C=!0,xe(this,Cs))):(Ns=Cs.L,Ns&&Ns.C?(Es.C=Ns.C=!1,Cs.C=!0,bs=Cs):(bs===Es.L&&(xe(this,Es),bs=Es,Es=bs.U),Es.C=!1,Cs.C=!0,ye(this,Cs))),Es=bs.U;this._.C=!1},remove:function(bs){bs.N&&(bs.N.P=bs.P),bs.P&&(bs.P.N=bs.N),bs.N=bs.P=null;var Es,Ps,Ls,vs=bs.U,Cs=bs.L,Ns=bs.R;if(Ps=Cs?Ns?me(Ns):Cs:Ns,vs?vs.L===bs?vs.L=Ps:vs.R=Ps:this._=Ps,Cs&&Ns?(Ls=Ps.C,Ps.C=bs.C,Ps.L=Cs,Cs.U=Ps,Ps===Ns?(Ps.U=vs,vs=Ps,bs=Ps.R):(vs=Ps.U,Ps.U=bs.U,bs=Ps.R,vs.L=bs,Ps.R=Ns,Ns.U=Ps)):(Ls=bs.C,bs=Ps),bs&&(bs.U=vs),!Ls){if(bs&&bs.C)return void(bs.C=!1);do{if(bs===this._)break;if(bs===vs.L){if(Es=vs.R,Es.C&&(Es.C=!1,vs.C=!0,ye(this,vs),Es=vs.R),Es.L&&Es.L.C||Es.R&&Es.R.C){Es.R&&Es.R.C||(Es.L.C=!1,Es.C=!0,xe(this,Es),Es=vs.R),Es.C=vs.C,vs.C=Es.R.C=!1,ye(this,vs),bs=this._;break}}else if(Es=vs.L,Es.C&&(Es.C=!1,vs.C=!0,xe(this,vs),Es=vs.L),Es.L&&Es.L.C||Es.R&&Es.R.C){Es.L&&Es.L.C||(Es.R.C=!1,Es.C=!0,ye(this,Es),Es=vs.L),Es.C=vs.C,vs.C=Es.L.C=!1,xe(this,vs),bs=this._;break}Es.C=!0,bs=vs,vs=vs.U}while(!bs.C);bs&&(bs.C=!1)}}};var In=[],Yn,On=[],Un=1e-6,Gn,Hn,Zn,Jn;Ye.prototype={constructor:Ye,polygons:function(){var bs=this.edges;return this.cells.map(function(vs){var Es=vs.halfedges.map(function(Cs){return we(vs,bs[Cs])});return Es.data=vs.site.data,Es})},triangles:function(){var bs=[],vs=this.edges;return this.cells.forEach(function(Es,Cs){if(js=(Ps=Es.halfedges).length)for(var Ps,js,ws,Ns=Es.site,Ls=-1,As=vs[Ps[js-1]],Bs=As.left===Ns?As.right:As.left;++Ls<js;)ws=Bs,As=vs[Ps[Ls]],Bs=As.left===Ns?As.right:As.left,ws&&Bs&&Cs<ws.index&&Cs<Bs.index&&0>Xe(Ns,ws,Bs)&&bs.push([Ns.data,ws.data,Bs.data])}),bs},links:function(){return this.edges.filter(function(bs){return bs.right}).map(function(bs){return{source:bs.left.data,target:bs.right.data}})},find:function(bs,vs,Es){for(var Ns,js,Cs=this,Ps=Cs._found||0,Ls=Cs.cells.length;!(js=Cs.cells[Ps]);)if(++Ps>=Ls)return null;var ws=bs-js.site[0],As=vs-js.site[1],Bs=ws*ws+As*As;do js=Cs.cells[Ns=Ps],Ps=null,js.halfedges.forEach(function(qs){var Ms=Cs.edges[qs],_s=Ms.left;if(_s!==js.site&&_s||(_s=Ms.right)){var Ss=bs-_s[0],Ts=vs-_s[1],Ds=Ss*Ss+Ts*Ts;Ds<Bs&&(Bs=Ds,Ps=_s.index)}});while(null!==Ps);return Cs._found=Ns,null==Es||Bs<=Es*Es?js.site:null}};class Kn extends tn{constructor(bs,vs,Es){super(bs,vs),this.isEdge=!1,this.isCorner=!1,this.overlaped=[],this.hull=new rn().convexHull([bs[0],bs[1],bs[2],vs].filter(function(Ls){return void 0!==Ls})),this.units=this.points.map(function(Ls,js){var ws=this.points[(js+1)%this.points.length];return new $n(vs,[Ls,ws])},this);var Cs=this.points.length;1===Cs?(this.isCorner=!0,this.addCornerMolecules()):2===Cs?(this.isEdge=!0,this.units=this.units.filter(function(Ls){var js=(Ls.vertex.y-Ls.base[0].y)*(Ls.base[1].x-Ls.base[0].x)-(Ls.vertex.x-Ls.base[0].x)*(Ls.base[1].y-Ls.base[0].y);return!(0>js)},this),this.addEdgeMolecules(Es)):void 0;var Ns;if(this.units=this.units.filter(function(Ls){var js=(Ls.vertex.y-Ls.base[0].y)*(Ls.base[1].x-Ls.base[0].x)-(Ls.vertex.x-Ls.base[0].x)*(Ls.base[1].y-Ls.base[0].y);return!(0>js)||(Ns=Ls,!1)},this),void 0!==Ns){var Ps=A(Ns.vertex.subtract(Ns.base[1]),Ns.base[0].subtract(Ns.base[1]));this.units.forEach(function(Ls){Ls.crimpAngle-=Ps})}}addEdgeMolecules(bs){if(this.edgeNormal=bs.normalize().abs(),!(1>this.units.length)){var vs=this.units[0].base,Es=vs.map(function(Cs){var Ns=this.circumcenter.subtract(Cs),Ps=Ns.multiply(this.edgeNormal).scale(2);return Cs.add(Ps)},this);this.units=this.units.concat([new $n(this.circumcenter,[vs[1],Es[1]]),new $n(this.circumcenter,[Es[0],vs[0]])])}}addCornerMolecules(){}generateCreases(){var bs=[],vs=this.units.map(function(Cs,Ns){var Ps=this.units[(Ns+1)%this.units.length];Cs.base[1].equivalent(Ps.base[0])&&bs.push(new nn(Cs.base[1],Cs.vertex))},this),Es=this.units.map(function(Cs){return Cs.generateCrimpCreaseLines()});return Es.forEach(function(Cs){bs=bs.concat(Cs)},this),this.isObtuse()&&this.units.forEach(function(Cs,Ns){this.units[(Ns+1)%this.units.length];Cs.base[0].equivalent(Cs.base[1])&&bs.push(new nn(Cs.base[0],Cs.vertex))},this),bs}}class $n{constructor(bs,vs,Es){if(this.vertex=bs,this.base=vs,this.crimpAngle=Es,this.overlapped=[],void 0===this.crimpAngle){var Cs=vs[1].subtract(vs[0]),Ns=bs.subtract(vs[0]),Ps=A(Cs,Ns),Ls=A(Ns,Cs);this.crimpAngle=Ps<Ls?Ps:Ls}}crimpLocations(){var bs=Math.atan2(this.base[1].y-this.base[0].y,this.base[1].x-this.base[0].x),vs=new $e(Math.cos(bs+this.crimpAngle),Math.sin(bs+this.crimpAngle)),Es=new $e(Math.cos(bs+0.5*this.crimpAngle),Math.sin(bs+0.5*this.crimpAngle)),Cs=new nn(this.vertex,this.base[0].midpoint(this.base[1])),Ns=I(new en(this.base[0],vs),Cs),Ps=I(new en(this.base[0],Es),Cs);return[Ns,Ps]}generateCrimpCreaseLines(){var bs=this.crimpLocations(),vs=new nn(this.vertex,this.base[0].midpoint(this.base[1]));0<this.overlapped.length&&(vs.nodes[1]=this.overlapped[0].circumcenter);var Es=[vs].concat(this.overlapped.map(function(Ns){return Ns.generateCreases()}).reduce(function(Ns,Ps){return Ns.concat(Ps)},[])),Cs=[vs].concat(new sn().rayReflectRepeat(new en(this.base[0],this.base[1].subtract(this.base[0])),Es,this.base[1]).edges());return bs.filter(function(Ns){return void 0!==Ns&&!Ns.equivalent(this.vertex)},this).forEach(function(Ns){Cs=Cs.concat(new sn().rayReflectRepeat(new en(this.base[0],Ns.subtract(this.base[0])),Es,this.base[1]).edges())},this),Cs}pointInside(bs){for(var vs=[this.vertex,this.base[0],this.base[1]],Es=0;Es<vs.length;Es++){var Cs=vs[Es],Ns=vs[(Es+1)%vs.length],Ps=(bs.y-Cs.y)*(Ns.x-Cs.x)-(bs.x-Cs.x)*(Ns.y-Cs.y);if(0>Ps)return!1}return!0}}class Qn{}class es{constructor(){this.points=[],this.edges=[]}}class ns{constructor(){this.edges=[],this.cells=[],this.isEdge=!1,this.isCorner=!1}}var os='http://www.w3.org/2000/svg',is=function(bs,vs,Es,Cs,Ns,Ps){var Ls=document.createElementNS(os,'line');return Ls.setAttributeNS(null,'x1',bs),Ls.setAttributeNS(null,'y1',vs),Ls.setAttributeNS(null,'x2',Es),Ls.setAttributeNS(null,'y2',Cs),void 0!=Ns&&Ls.setAttributeNS(null,'class',Ns),void 0!=Ps&&Ls.setAttributeNS(null,'id',Ps),Ls},ts=function(bs,vs,Es,Cs,Ns){var Ps=document.createElementNS(os,'circle');return Ps.setAttributeNS(null,'cx',bs),Ps.setAttributeNS(null,'cy',vs),Ps.setAttributeNS(null,'r',Es),void 0!=Cs&&Ps.setAttributeNS(null,'class',Cs),void 0!=Ns&&Ps.setAttributeNS(null,'id',Ns),Ps},ds=function(bs,vs,Es){var Cs=bs.map(function(Ps){return Ps.constructor===Array?Ps:[Ps.x,Ps.y]}).reduce(function(Ps,Ls){return Ps+Ls[0]+','+Ls[1]+' '},''),Ns=document.createElementNS(os,'polygon');return Ns.setAttributeNS(null,'points',Cs),void 0!=vs&&Ns.setAttributeNS(null,'class',vs),void 0!=Es&&Ns.setAttributeNS(null,'id',Es),Ns},as=function(bs,vs,Es,Cs,Ns,Ps,Ls,js,ws,As){var qs=document.createElementNS(os,'path');return qs.setAttributeNS(null,'d','M '+bs+','+vs+' C '+Es+','+Cs+' '+Ns+','+Ps+' '+Ls+','+js),void 0!=ws&&qs.setAttributeNS(null,'class',ws),void 0!=As&&qs.setAttributeNS(null,'id',As),qs},rs=function(bs,vs){var Es=document.createElementNS(os,'g');return void 0!=bs&&Es.setAttributeNS(null,'class',bs),void 0!=vs&&Es.setAttributeNS(null,'id',vs),Es},ls=function(bs,vs){var Es=document.createElementNS(os,'svg');return Es.setAttributeNS(null,'viewBox','0 0 1 1'),void 0!=bs&&Es.setAttributeNS(null,'class',bs),void 0!=vs&&Es.setAttributeNS(null,'id',vs),Es},gs=function(bs,vs){if(void 0!=bs){var Es=bs.getAttribute('class');void 0==Es&&(Es='');var Cs=Es.split(' ').filter(function(Ns){return Ns!=vs},this);Cs.push(vs),bs.setAttributeNS(null,'class',Cs.join(' '))}},cs=function(bs,vs){if(void 0!=bs){var Es=bs.getAttribute('class');void 0==Es&&(Es='');var Cs=Es.split(' ').filter(function(Ns){return Ns!=vs},this);bs.setAttributeNS(null,'class',Cs.join(' '))}},hs=function(bs,vs,Es){var Cs=bs.createSVGPoint();Cs.x=vs,Cs.y=Es;var Ns=Cs.matrixTransform(bs.getScreenCTM().inverse());return{x:Ns.x,y:Ns.y}},ps='http://www.w3.org/2000/svg',us={0:'mark',1:'boundary',2:'mountain',3:'valley'};class ms{onResize(){}animate(){}onMouseDown(){}onMouseUp(){}onMouseMove(){}onMouseDidBeginDrag(){}constructor(){for(var bs=[],vs=0;vs<arguments.length;vs++)bs.push(arguments[vs]);this.cp=bs.filter(function(Ns){return Ns instanceof En},this).shift(),this.cp==void 0&&(this.cp=new Xn),this.svg=ls();var Es=this;document.addEventListener('DOMContentLoaded',function(){var Ns=bs.filter(function(Ls){return Ls instanceof HTMLElement},this).shift();if(Ns==void 0){var Ps=bs.filter(function(Ls){return'string'==typeof Ls||Ls instanceof String},Es).shift();Ps!=void 0&&(Ns=document.getElementById(Ps))}Ns==void 0&&(Ns=document.body),Ns.appendChild(Es.svg)}),this.line=is,this.circle=ts,this.polygon=ds,this.bezier=as,this.group=rs,this.SVG=ls,this.addClass=gs,this.removeClass=cs,this.convertToViewbox=hs,this.facesLayer=this.group(null,'faces'),this.junctionsLayer=this.group(null,'junctions'),this.sectorsLayer=this.group(null,'sectors'),this.edgesLayer=this.group(null,'creases'),this.boundaryLayer=this.group(null,'boundary'),this.nodesLayer=this.group(null,'nodes'),this.svg.appendChild(this.boundaryLayer),this.svg.appendChild(this.facesLayer),this.svg.appendChild(this.junctionsLayer),this.svg.appendChild(this.sectorsLayer),this.svg.appendChild(this.edgesLayer),this.svg.appendChild(this.nodesLayer),this.padding=0.01,this.mouse={position:{x:0,y:0},pressed:{x:0,y:0},isPressed:!1,isDragging:!1},this.style={node:{radius:0.01},sector:{scale:0.5},face:{scale:1},selected:{node:{radius:0.02},edge:{strokeColor:{hue:0,saturation:0.8,brightness:1}},face:{fillColor:{hue:0,saturation:0.8,brightness:1}}}},this.draw(),this.svg.onmousedown=function(Ns){Es.mouse.isPressed=!0,Es.mouse.isDragging=!1,Es.mouse.pressed=Es.convertToViewbox(Es.svg,Ns.clientX,Ns.clientY),Es.onMouseDown({point:Object.assign({},Es.mouse.pressed)})},this.svg.onmouseup=function(Ns){Es.mouse.isPressed=!1,Es.mouse.isDragging=!1,Es.selectedTouchPoint=void 0,Es.onMouseUp({point:Es.convertToViewbox(Es.svg,Ns.clientX,Ns.clientY)})},this.svg.onmousemove=function(Ns){Es.mouse.position=Es.convertToViewbox(Es.svg,Ns.clientX,Ns.clientY),Es.mouse.isPressed&&!1===Es.mouse.isDragging&&(Es.mouse.isDragging=!0,Es.onMouseDidBeginDrag({point:Object.assign({},Es.mouse.position)})),Es.onMouseMove({point:Object.assign({},Es.mouse.position)})},this.svg.onResize=function(Ns){Es.onResize(Ns)};var Cs=0;this.animateTimer=setInterval(function(){Es.animate({time:Es.svg.getCurrentTime(),frame:Cs}),Cs+=1},1e3/60)}setPadding(bs){return void 0!=bs&&(this.padding=bs,this.setViewBox()),this}setViewBox(){var bs=this.cp.boundaryBounds();this.svg.setAttribute('viewBox',-this.padding+bs.origin.x+' '+(-this.padding+bs.origin.y)+' '+(bs.size.width+2*this.padding)+' '+(bs.size.height+2*this.padding))}get(bs){return bs instanceof hn?this.nodesLayer.childNodes[bs.index]:bs instanceof pn?this.edgesLayer.childNodes[bs.index]:bs instanceof fn?this.facesLayer.childNodes[bs.index]:bs instanceof bn?this.sectorsLayer.childNodes[bs.index]:document.createElement('void')}showNodes(){origami.nodesLayer.setAttribute('display','')}showEdges(){origami.edgesLayer.setAttribute('display','')}showFaces(){origami.facesLayer.setAttribute('display','')}showSectors(){origami.sectorsLayer.setAttribute('display','')}hideNodes(){origami.nodesLayer.setAttribute('display','none')}hideEdges(){origami.nodesLayer.setAttribute('display','none')}hideFaces(){origami.nodesLayer.setAttribute('display','none')}hideSectors(){origami.nodesLayer.setAttribute('display','none')}update(){this.edgesLayer.childNodes.forEach(function(bs,vs){this.cp.edges[vs]!=void 0&&bs.setAttributeNS(null,'class',us[this.cp.edges[vs].orientation])},this),this.facesLayer.childNodes.forEach(function(bs){bs.setAttributeNS(null,'class','face')},this),this.nodesLayer.childNodes.forEach(function(bs){bs.setAttributeNS(null,'class','node')},this),this.sectorsLayer.childNodes.forEach(function(bs){bs.setAttributeNS(null,'class','sector')},this),this.junctionsLayer.childNodes.forEach(function(bs){bs.setAttributeNS(null,'class','junction')},this)}draw(){this.setViewBox(),[this.boundaryLayer,this.facesLayer,this.junctionsLayer,this.sectorsLayer,this.edgesLayer,this.nodesLayer].forEach(function(Es){for(;Es.lastChild;)Es.removeChild(Es.lastChild)},this);var bs=this.cp.boundary.nodes().reduce(function(Es,Cs){return Es+Cs.x+','+Cs.y+' '},''),vs=document.createElementNS(ps,'polygon');vs.setAttributeNS(null,'class','boundary'),vs.setAttributeNS(null,'points',bs),this.boundaryLayer.appendChild(vs),this.cp.nodes.forEach(function(Es){this.addNode(Es)},this),this.cp.edges.forEach(function(Es){this.addEdge(Es)},this),this.cp.faces.forEach(function(Es){this.addFace(Es)},this),this.cp.junctions.forEach(function(Es){this.addJunction(Es);var Cs=this.style.sector.scale*Es.sectors.map(function(Ns){return Ns.edges[0].length()},this).sort(function(Ns,Ps){return Ns-Ps}).shift();Es.sectors.forEach(function(Ns){this.addSector(Ns,Cs)},this)},this)}addNode(bs){var vs=this.circle(bs.x,bs.y,this.style.node.radius,'node','node-'+bs.index);this.nodesLayer.appendChild(vs)}addEdge(bs){var vs=this.line(bs.nodes[0].x,bs.nodes[0].y,bs.nodes[1].x,bs.nodes[1].y,us[bs.orientation],'edge-'+bs.index);this.edgesLayer.appendChild(vs)}addFace(bs){function vs(Ps,Ls,js){return Ps+(Ls-Ps)*(1-js)}var Es=bs.centroid(),Cs=bs.nodes.map(function(Ps){return[vs(Ps.x,Es.x,this.style.face.scale),vs(Ps.y,Es.y,this.style.face.scale)]},this),Ns=this.polygon(Cs,'face','face-'+bs.index);this.facesLayer.appendChild(Ns)}addSector(bs,vs){var Es=bs.origin,Cs=bs.endPoints.map(function(ws){return ws.subtract(Es).normalize().scale(vs)},this),Ns=Cs[1].subtract(Cs[0]),Ps=0<Math.atan2(Cs[0].x*Cs[1].y-Cs[0].y*Cs[1].x,Cs[0].x*Cs[1].x+Cs[0].y*Cs[1].y)?0:1,Ls='M '+Es.x+','+Es.y+' l '+Cs[0].x+','+Cs[0].y+' ';Ls+=['a ',vs,vs,0,Ps,1,Ns.x,Ns.y].join(' '),Ls+=' Z';var js=document.createElementNS(ps,'path');js.setAttributeNS(null,'d',Ls),js.setAttributeNS(null,'class','sector'),js.setAttributeNS(null,'id','sector-'+bs.index),this.sectorsLayer.appendChild(js)}addJunction(){}load(bs,vs){var Es=this;if('string'==typeof bs||bs instanceof String){var Cs=bs.substr(bs.lastIndexOf('.')+1);switch(Cs){case'fold':return fetch(bs).then(function(Ps){return Ps.json()}).then(function(Ps){Es.cp.importFoldFile(Ps),Es.draw(),void 0!=vs&&vs(Es.cp)}),Es;case'svg':return fetch(bs).then(Ps=>Ps.text()).then(function(Ps){Es.cp=new K(Ps),Es.draw(),void 0!=vs&&vs(Es.cp)}),Es;case'opx':return fetch(bs).then(Ps=>Ps.text()).then(function(Ps){var Ls=FOLD.convert.convertFromTo(Ps,'opx','fold');Es.cp.importFoldFile(Ls),Es.draw(),void 0!=vs&&vs(Es.cp)}),Es;}}try{var Ns=JSON.parse(bs);return this.cp.importFoldFile(Ns),this}catch(Ps){try{return this.cp=new K(bs),this.draw(),this}catch(Ls){console.log('can\'t recognize file')}}return this}}class fs{onResize(){}animate(){}onMouseDown(){}onMouseUp(){}onMouseMove(){}onMouseDidBeginDrag(){}constructor(){for(var bs=[],vs=0;vs<arguments.length;vs++)bs.push(arguments[vs]);this.cp=bs.filter(function(Cs){return Cs instanceof En},this).shift(),this.cp==void 0&&(this.cp=new Xn),this.svg=ls();var Es=this;document.addEventListener('DOMContentLoaded',function(){var Cs=bs.filter(function(Ps){return Ps instanceof HTMLElement},this).shift();if(Cs==void 0){var Ns=bs.filter(function(Ps){return'string'==typeof Ps||Ps instanceof String},Es).shift();Ns!=void 0&&(Cs=document.getElementById(Ns))}Cs==void 0&&(Cs=document.body),Cs.appendChild(Es.svg)}),this.line=is,this.circle=ts,this.polygon=ds,this.group=rs,this.SVG=ls,this.addClass=gs,this.removeClass=cs,this.convertToViewbox=hs,this.facesLayer=rs(null,'faces'),this.junctionsLayer=rs(null,'junctions'),this.sectorsLayer=rs(null,'sectors'),this.edgesLayer=rs(null,'creases'),this.boundaryLayer=rs(null,'boundary'),this.nodesLayer=rs(null,'nodes'),this.svg.appendChild(this.boundaryLayer),this.svg.appendChild(this.facesLayer),this.svg.appendChild(this.junctionsLayer),this.svg.appendChild(this.sectorsLayer),this.svg.appendChild(this.edgesLayer),this.svg.appendChild(this.nodesLayer),this.holdPoint=void 0,this.padding=0,this.mouseZoom=!0,this.zoom=1,this.rotation=0,this.bounds={origin:{x:0,y:0},size:{width:1,height:1}},this.mouse={position:{x:0,y:0},pressed:{x:0,y:0},isPressed:!1,isDragging:!1},this.style={},this.draw();var Es=this;this.svg.onmousedown=function(Cs){Es.mouse.isPressed=!0,Es.mouse.isDragging=!1,Es.mouse.pressed=hs(Es.svg,Cs.clientX,Cs.clientY),Es.zoomOnMousePress=Es.zoom,Es.rotationOnMousePress=Es.rotation,Es.onMouseDown({point:Object.assign({},Es.mouse.pressed)})},this.svg.onmouseup=function(Cs){Es.mouse.isPressed=!1,Es.mouse.isDragging=!1,Es.selectedTouchPoint=void 0,Es.onMouseUp({point:hs(Es.svg,Cs.clientX,Cs.clientY)})},this.svg.onmousemove=function(Cs){Es.mouse.position=hs(Es.svg,Cs.clientX,Cs.clientY),Es.mouse.isPressed&&(!1==Es.mouse.isDragging&&(Es.mouse.isDragging=!0,Es.onMouseDidBeginDrag({point:Object.assign({},Es.mouse.position)})),Es.mouseZoom&&(Es.zoom=Es.zoomOnMousePress+0.01*(Es.mouse.pressed.y-Es.mouse.position.y),Es.rotation=Es.rotationOnMousePress+(Es.mouse.pressed.x-Es.mouse.position.x),0.02>Es.zoom&&(Es.zoom=0.02),100<Es.zoom&&(Es.zoom=100),Es.setViewBox())),Es.onMouseMove({point:Object.assign({},Es.mouse.position)})},this.svg.onResize=function(Cs){Es.onResize(Cs)}}reset(){this.zoom=1,this.rotation=0,this.setViewBox()}getBounds(){if(void 0===this.foldedCP)return void(this.bounds={origin:{x:0,y:0},size:{width:1,height:1}});var bs=Infinity,vs=Infinity,Es=-Infinity,Cs=-Infinity;this.foldedCP.vertices_coords.forEach(function(Ns){Ns[0]>Es&&(Es=Ns[0]),Ns[0]<bs&&(bs=Ns[0]),Ns[1]>Cs&&(Cs=Ns[1]),Ns[1]<vs&&(vs=Ns[1])},this),this.bounds={origin:{x:bs,y:vs},size:{width:Es-bs,height:Cs-vs}}}setPadding(bs){return void 0!=bs&&(this.padding=bs,this.setViewBox()),this}setViewBox(){this.getBounds(),this.svg.setAttribute('viewBox',-this.padding+this.bounds.origin.x+' '+(-this.padding+this.bounds.origin.y)+' '+(this.bounds.size.width+2*this.padding)+' '+(this.bounds.size.height+2*this.padding))}update(){this.facesLayer.childNodes.forEach(function(bs){bs.setAttributeNS(null,'class','folded-face')},this)}draw(bs){this.setViewBox(),this.holdPoint!=void 0&&(bs=this.cp.nearest(this.holdPoint).face),this.foldedCP=this.cp.fold(bs),this.getBounds(),this.faces=[],[this.boundaryLayer,this.facesLayer,this.junctionsLayer,this.sectorsLayer,this.edgesLayer,this.nodesLayer].forEach(function(vs){for(;vs.lastChild;)vs.removeChild(vs.lastChild)},this),this.foldedCP!=void 0&&this.foldedCP.faces_vertices.map(function(vs){return vs.map(function(Es){return this.foldedCP.vertices_coords[Es]},this)},this).forEach(function(vs){this.addFace(vs)},this),this.setViewBox()}addFace(bs,vs){var Es=ds(bs,'folded-face','face-'+vs);this.facesLayer.appendChild(Es)}load(bs,vs){var Es=this;if('string'==typeof bs||bs instanceof String){var Cs=bs.substr(bs.lastIndexOf('.')+1);switch(Cs){case'fold':return fetch(bs).then(function(Ps){return Ps.json()}).then(function(Ps){Es.cp.importFoldFile(Ps),Es.draw(),void 0!=vs&&vs(Es.cp)}),Es;case'svg':return fetch(bs).then(Ps=>Ps.text()).then(function(Ps){Es.cp=new K(Ps),Es.draw(),void 0!=vs&&vs(Es.cp)}),Es;case'opx':return fetch(bs).then(Ps=>Ps.text()).then(function(Ps){var Ls=FOLD.convert.convertFromTo(Ps,'opx','fold');Es.cp.importFoldFile(Ls),Es.draw(),void 0!=vs&&vs(Es.cp)}),Es;}}try{var Ns=JSON.parse(bs);return this.cp.importFoldFile(Ns),this}catch(Ps){try{return this.cp=new K(bs),this.draw(),this}catch(Ls){console.log('can\'t recognize file')}}return this}}window.CreasePattern=Xn,window.OrigamiPaper=ms,window.OrigamiFold=fs,E.CreasePattern=Xn,E.OrigamiPaper=ms,E.OrigamiFold=fs,E.VoronoiGraph=class{edgeExists(bs,vs){return void 0===vs&&(vs=He),this.edges.forEach(function(Es){return Es.endPoints[0].equivalent(bs[0],vs)&&Es.endPoints[1].equivalent(bs[1],vs)?Es:Es.endPoints[1].equivalent(bs[0],vs)&&Es.endPoints[0].equivalent(bs[1],vs)?Es:void 0}),void 0}constructor(bs,vs,Es){var Cs=[[vs.origin.x,vs.origin.y],[vs.size.width,vs.size.height]],Ns=Oe().extent(Cs),Ps=Ns(bs),Ls=function(Bs,qs){return 0<Bs.filter(function(Ms){return Ms.equivalent(qs,Es)}).length};void 0===Es&&(Es=He);var js=Ps.edges.map(function(Bs){return[new $e(Bs[0][0],Bs[0][1]),new $e(Bs[1][0],Bs[1][1])]}).reduce(function(Bs,qs){return Bs.concat(qs)},[]),ws=new rn().convexHull(js);this.edges=[],this.junctions=[],this.cells=[],this.edges=Ps.edges.map(function(Bs){var qs=new Qn;return qs.endPoints=[new $e(Bs[0][0],Bs[0][1]),new $e(Bs[1][0],Bs[1][1])],qs.cache={left:Bs.left,right:Bs.right},qs}),this.cells=Ps.cells.map(function(Bs){var qs=new es;return qs.site=new $e(Bs.site[0],Bs.site[1]),qs.edges=Bs.halfedges.map(function(Ms){return this.edges[Ms]},this),qs.points=qs.edges.map(function(Ms,_s){var Ss=Ms.endPoints[0],Ts=Ms.endPoints[1],Ds=qs.edges[(_s+1)%qs.edges.length].endPoints[0],Rs=qs.edges[(_s+1)%qs.edges.length].endPoints[1];return Ss.equivalent(Ds,Es)||Ss.equivalent(Rs,Es)?Ts:Ss},this),qs},this),this.edges.forEach(function(Bs){var qs=[void 0,void 0];if(void 0!==Bs.cache.left)for(var Ms=new $e(Bs.cache.left[0],Bs.cache.left[1]),_s=0;_s<this.cells.length;_s++)if(Ms.equivalent(this.cells[_s].site,Es)){qs[0]=this.cells[_s];break}if(void 0!==Bs.cache.right)for(var Ss=new $e(Bs.cache.right[0],Bs.cache.right[1]),_s=0;_s<this.cells.length;_s++)if(Ss.equivalent(this.cells[_s].site,Es)){qs[1]=this.cells[_s];break}Bs.cells=qs,Bs.isBoundary=!1,(void 0===Bs.cells[0]||void 0===Bs.cells[1])&&(Bs.isBoundary=!0),Bs.cache={}},this);var As=[];return this.edges.forEach(function(Bs){Ls(As,Bs.endPoints[0])||As.push(Bs.endPoints[0]),Ls(As,Bs.endPoints[1])||As.push(Bs.endPoints[1])},this),this.junctions=As.map(function(Bs){var qs=new ns;switch(qs.position=Bs,qs.cells=this.cells.filter(function(Ms){return Ls(Ms.points,Bs)},this).sort(function(Ms,_s){var Ss=Ms.site.subtract(Bs),Ts=_s.site.subtract(Bs);return Math.atan2(Ss.y,Ss.x)-Math.atan2(Ts.y,Ts.x)}),qs.cells.length){case 1:qs.isCorner=!0;break;case 2:qs.isEdge=!0,ws.edges.forEach(function(Ms){Ms.collinear(qs.position)&&(qs.edgeNormal=Ms.nodes[1].subtract(Ms.nodes[0]).rotate90())});}return qs.edges=this.edges.filter(function(Ms){return Ls(Ms.endPoints,Bs)},this).sort(function(Ms,_s){var Ss=Ms.endPoints[0];Ss.equivalent(Bs)&&(Ss=Ms.endPoints[1]);var Ts=_s.endPoints[0];Ts.equivalent(Bs)&&(Ts=_s.endPoints[1]);var Ds=Ss.subtract(Bs),Rs=Ts.subtract(Bs);return Math.atan2(Ds.y,Ds.x)-Math.atan2(Rs.y,Rs.x)}),qs},this),this}generateMolecules(bs){return this.junctions.map(function(vs){var Es=vs.cells.map(function(Ns){return Ns.site.lerp(vs.position,bs)},this),Cs=new Kn(Es,vs.position,vs.isEdge?vs.edgeNormal:void 0);return Cs},this)}generateSortedMolecules(bs){for(var vs=this.generateMolecules(bs),Es=0;Es<vs.length;Es++)for(var Cs=0;Cs<vs.length;Cs++)Es!==Cs&&vs[Cs].units.forEach(function(js){js.pointInside(vs[Es].circumcenter)&&(js.overlapped.push(vs[Es]),vs[Cs].overlaped.push(vs[Es]))});for(var Es=0;Es<vs.length;Es++)vs[Es].units.forEach(function(js){js.overlapped.sort(function(ws,As){return ws.circumcenter.distanceTo(js.vertex)-As.circumcenter.distanceTo(js.vertex)})}),vs[Es].overlaped.sort(function(js,ws){return js.circumcenter.distanceTo(vs[Es].circumcenter)-ws.circumcenter.distanceTo(vs[Es].circumcenter)});for(var Ns=[],Ps=vs.slice(),Ls=0;0<Ps.length;){Ns.push([]);for(var Es=Ps.length-1;0<=Es;Es--)Ps[Es].overlaped.length<=Ls&&(Ns[Ls].push(Ps[Es]),Ps.splice(Es,1));Ls++}return Ns}},E.creaseVoronoi=function(bs,vs,Es){void 0===Es&&(Es=0.5);var Cs=vs.edges.filter(function(Ls){return!Ls.isBoundary}),Ns=vs.cells.map(function(Ls){return Ls.edges.map(function(js){return js.endPoints.map(function(ws){return Ls.site.lerp(ws,Es)})},this)},this),Ps=vs.generateSortedMolecules(Es);return Ps.forEach(function(Ls){Ls.forEach(function(js){var ws=js.generateCreases();ws.forEach(function(As){bs.crease(As.nodes[0],As.nodes[1])},this)},this)},this),Cs.forEach(function(Ls){var js=bs.crease(Ls.endPoints[0],Ls.endPoints[1]);void 0!==js&&js.valley()},this),Ns.forEach(function(Ls){Ls.forEach(function(js){var ws=bs.crease(js[0],js[1]);void 0!=ws&&ws.mountain()},this)},this),0==Ps.length?[]:Ps.reduce(function(Ls,js){return Ls.concat(js)})},E.line=is,E.circle=ts,E.polygon=ds,E.group=rs,E.addClass=gs,E.removeClass=cs,E.geometry=gn,Object.defineProperty(E,'__esModule',{value:!0})});