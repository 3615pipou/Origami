<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../lib/bootstrap/css/bootstrap.min.css" rel="stylesheet">
<style>
html, body {
	height:100%;
	width:100%;
	background-color: #EEE;
	margin:0px;
}
canvas[resize]{
	width:100%;
	height:98%;
}
</style>
</head>
<body>
	<canvas id="canvas" resize></canvas>
</body>

<script src="../tools/drag-and-drop.js"></script>
<script language="javascript" type="text/javascript" src="../src/3rdparty.js"></script>
<script language="javascript" type="text/javascript" src="../src/graph.js"></script>
<script language="javascript" type="text/javascript" src="../src/planarGraph.js"></script>
<script language="javascript" type="text/javascript" src="../src/creasePattern.js"></script>
<script language="javascript" type="text/javascript" src="../lib/paper-full.min.js"></script>
<script language="javascript" type="text/javascript" src="../src/cp.paperjs.js"></script>

<script>
var project = new OrigamiPaper("canvas");
project.updateWeights(0.002, 0.001);
project.cp.rectangle(1,0.5);


var mouseVector = new XY(1.0, 0.0);

var lastMousePosition = undefined;

var count = 150;
for(var i = 0; i < count; i++){
	var angle = Math.PI*i/count;
	var topCenter = new XY(0.5, 0.0);
	var v = new XY(topCenter.x + Math.cos(angle), topCenter.y + Math.sin(angle));
	project.cp.creaseThroughPoints(topCenter, v);
}

resetCP = project.cp.duplicate();

project.draw();

project.onFrame = function(event){
	mouseVector = new XY(Math.cos(event.time), Math.sin(event.time));
	if(lastMousePosition !== undefined && resetCP !== undefined && this.cp.contains(lastMousePosition)){
		this.cp = resetCP.duplicate();
		var creases = this.cp.creaseRayRepeat(new XY(lastMousePosition.x, lastMousePosition.y), mouseVector);
		creases.forEach(function(el){ if(el !== undefined) el.valley(); })
		// this.cp.clean();
		this.draw();
	} else{
		// this.draw();
	}
}

project.onMouseMove = function(event){
	lastMousePosition = event.point;
	// console.log(event.point);
	// if(resetCP !== undefined && this.cp.contains(event.point)){
	// 	this.cp = resetCP.duplicate();
	// 	var creases = this.cp.creaseRayRepeat(new XY(event.point.x, event.point.y), mouseVector);
	// 	creases.forEach(function(el){ if(el !== undefined) el.valley(); })
	// 	// this.cp.clean();
	// 	this.draw();
	// } else{
	// 	this.cp = refCP
	// 	this.draw();
	// }
}




// incoming file from drag-to-upload
function filDidLoad(svg){
	project.load(svg, function(){ });
}
</script>

<!-- download svg blob -->
<script>
function download(text, filename){
	var blob = new Blob([text], {type: "image/svg+xml"});
	var url = window.URL.createObjectURL(blob);
	var a = document.createElement("a");
	a.href = url;
	a.download = filename;
	a.click();
}
</script>

</html>
