<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<style>
html, body {
	margin: 0;
	overflow: hidden;
	height: 100%;
	text-align:center;
}
canvas[resize] {
	width: 100vmin;
	height: 100vmin;
}
</style>
<script type="text/javascript" src="../../src/graph.js"></script>
<script type="text/javascript" src="../../src/planarGraph.js"></script>
<script type="text/javascript" src="../../src/creasePattern.js"></script>
<script type="text/javascript" src="../../lib/paper-full.min.js"></script>
<script type="text/javascript" src="paperjscp.js"></script>
<script type="text/javascript" src="../../lib/d3.min.js"></script>
<script type="text/javascript">

var cp = new CreasePattern();
cp.birdBase();
console.log(cp);

window.onload = function() {
	var canvas = document.getElementById('canvas');
	paper.setup(canvas);
	zoomView(paper);
	var paperCP = new PaperCreasePattern(paper, cp);
	var nearestEdge = undefined;
	var nearestNode = undefined;

	var faceLayer = new paper.Layer();
	var mouseNodeLayer = new paper.Layer();
	mouseNodeLayer.activate();
	mouseNodeLayer.removeChildren();

	var nodeCircle = new paper.Shape.Circle({
		center: [0, 0],
		radius: 0.03,
		fillColor: { hue:220, saturation:0.8, brightness:1.0 }//{ hue:130, saturation:0.8, brightness:0.7 }
	});

	paper.view.onFrame = function(event) { }
	paper.view.onResize = function(event) {
		zoomView(paper);
	}
	paper.view.onMouseMove = function(event) {
		mousePos = event.point;
		var nNode = cp.getNearestNode( mousePos.x, mousePos.y );
		var nEdge = cp.getNearestEdge( mousePos.x, mousePos.y ).edge;
		if(nearestNode != nNode){
			nearestNode = nNode;
			nodeCircle.position.x = cp.nodes[nearestNode].x;
			nodeCircle.position.y = cp.nodes[nearestNode].y;
			faceLayer.activate();
			faceLayer.removeChildren();
			var faces = cp.nodes[nearestNode].adjacentFaces();
			for(var i = 0; i < faces.length; i++){
				var segmentArray = faces[i].nodes;
				new paper.Path({
						fillColor: { hue:120, saturation:1.0, brightness:1.0, alpha:0.2 },
						segments: segmentArray,
						closed: true
				});
			}
			console.log("Node: " + nearestNode);
		}
	}
	paper.view.onMouseDown = function(event){

	}
}

</script>
</head>
<body>
	<canvas id="canvas" resize></canvas>
</body>
</html>