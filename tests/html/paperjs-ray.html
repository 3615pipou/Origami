<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<style>
html,
body {
	margin: 0;
	overflow: hidden;
	height: 100%;
}
/* Scale canvas with resize attribute to full size */
canvas[resize] {
	width: 100%;
	height: 100%;
}
</style>
<script type="text/javascript" src="../../lib/paper-full.min.js"></script>
<script type="text/javascript" src="../../src/graph.js"></script>
<script type="text/javascript" src="../../src/planarGraph.js"></script>
<script type="text/javascript" src="../../src/creasePattern.js"></script>
<script type="text/javascript" src="../../src/cp.paperjs.js"></script>
<script type="text/javascript" src="../../lib/perlin.js"></script>
<script type="text/javascript">

var cp = new CreasePattern();
// cp.generateFaces();
for(var i = 0; i < 10; i++){
	cp.newPlanarEdge(Math.random(), Math.random(), Math.random(), Math.random());
}
// cp.fragment();
console.log(cp);

window.onload = function() {

	var canvas = document.getElementById('canvas');
	// Create an empty project and a view for the canvas:
	paper.setup(canvas);
	zoomView(paper);
	
	var paperCP = new OrigamiPaper(paper, cp);
	console.log(paperCP);

	var rayCenter = new XY(0.5, 0.5);
	var rayDirection = new XY(1.0, 0.0);
	var intersectionLayer = new paper.Layer();
	var intersections = [];

	paper.view.onFrame = function(event) {
		intersectionLayer.activate();
		intersectionLayer.removeChildren();
		intersections = [];
		rayDirection = new XY(Math.cos(event.time), Math.sin(event.time));
		for(var i = 0; i < cp.edges.length; i++){
			var endPoints = cp.edges[i].endPoints();
			var intersection = rayLineSegmentIntersection(rayCenter, rayDirection, endPoints[0], endPoints[1]);
			if(intersection != undefined){
				intersections.push(intersection);
				var shape = new paper.Shape.Circle(new paper.Point(intersection.x, intersection.y), .01);
				//shape.strokeColor = 'black';
				shape.fillColor = 'red';
				paperCP.edges[i].strokeColor = 'red';
			} else{
				paperCP.edges[i].strokeColor = 'black';		
			}
		}
	}

	paper.view.onResize = function(event) {
		zoomView(paper);
	}

	paper.view.onMouseMove = function(event) {
		mousePos = event.point;
	}

//	paper.view.draw();
}

</script>
</head>
<body>
	<canvas id="canvas" resize></canvas>
</body>
</html>