<html>
<head>
	<meta charset="UTF-8">
	<script language="javascript" type="text/javascript" src="../lib/p5.min.js"></script>
	<script language="javascript" type="text/javascript" src="../graph.js"></script>
	<script language="javascript" type="text/javascript" src="../planarGraph.js"></script>
	<script language="javascript" type="text/javascript" src="../renderNS.js"></script>
	<style> body {padding: 0; margin: 0;} </style>
</head>
<body>
	<script>

var s = function( p ) {

	var g = new PlanarGraph();
	var paperSize = 250;

	var mouse = {x:undefined, y:undefined};

	function startBase(graph){
		graph.clear();
		graph.nodes.push( {x:0.0, y:0.0, z:0.0} );
		graph.nodes.push( {x:1.0, y:1.0, z:0.0} );
		graph.addEdgeFromExistingVertices(0, 1);
	}

	function reset(){
		startBase(g);
	}

	p.setup = function(){
		canvas = p.createCanvas(window.innerWidth, window.innerHeight);
		p.strokeWeight(.01);
		reset();
		// p.loop();
		// p.frameRate(60);
	}

	function mouseOver(x, y){
	}

	function findIntersections(){

		var intersections = g.getAllEdgeIntersectionsDetailed();
		for(var i = 0; i < intersections.length; i++){
			var edge1 = intersections[i].a;
			var edge2 = intersections[i].b;
			var intersection = intersections[i].location;

			var node1a = g.edges[ edge1 ].a;
			var node1b = g.edges[ edge1 ].b;
			var node2a = g.edges[ edge2 ].a;
			var node2b = g.edges[ edge2 ].b;

			g.removeEdgeBetween(node1a, node1b);
			g.removeEdgeBetween(node2a, node2b);
			var newIntersectionVertexIndex = g.nodes.length;
			g.addEdgeFromVertex(node1a, intersection.x, intersection.y);
			g.addEdgeFromExistingVertices(node1b, newIntersectionVertexIndex);
			g.addEdgeFromExistingVertices(node2a, newIntersectionVertexIndex);
			g.addEdgeFromExistingVertices(node2b, newIntersectionVertexIndex);
		}
	}

	p.draw = function() {
		
		// draw
		p.clear();
		p.applyMatrix(paperSize, 0, 0, paperSize, window.innerWidth*0.5-paperSize*0.5, window.innerHeight*0.5-paperSize*0.5);

		if(mouse.x != undefined && mouse.y != undefined){
			p.stroke(192, 192, 192);
			p.line(0, 0, mouse.x, mouse.y);
			// p.fill(255, 0, 0);
			// p.stroke(255, 0, 0);
			// p.ellipse(mouse.x, mouse.y, .03, .03);
		}
		
		p.fill(0, 0, 0);
		p.stroke(0, 0, 0);
		drawCoordinateFrame(p);
		drawGraphPoints(p, g);
		drawGraphLines(p, g);
		// for(var i = 0; i < intersections.length; i++){
		// 	p.fill(255, 0, 0);
		// 	p.noStroke();
		// 	p.ellipse(intersections[i].x, intersections[i].y, .03, .03);
		// }
	}

	p.mouseMoved = function(event){
		// var mouseX = event.screenX;
		var mouseX = (event.clientX - window.innerWidth*0.5 + paperSize*0.5) / paperSize;
		var mouseY = (event.clientY - window.innerHeight*0.5 + paperSize*0.5) / paperSize;
		if(mouseX >= 0.0 && mouseX <= 1.0 && mouseY >= 0.0 && mouseY <= 1.0){
			mouse = {x:mouseX, y:mouseY};
			mouseOver(mouseX, mouseY);
		} else{
			mouse = {x:undefined, y:undefined};
			mouseOver(undefined, undefined);
		}
	}

	p.mouseReleased = function(){
		// reset();
		findIntersections();
	}

	p.mousePressed = function(){
		// addLines();
	}

};

var myp5 = new p5(s, 'containerIntro');

</script>
</body>
</html>