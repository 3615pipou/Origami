<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<style>
html, body {
	width:100%;
	height:100%;
	margin:0px;
	font-family: sans-serif;
	cursor:default;
}
div{
	width:100%;
	height:100%;
}
.left{
	float:left;
	width:20%;
	background-color: #EEE;
}
.right{
	float:right;
	width:20%;
	background-color: #EEE;
}
.center{
	width:50%;
	height:90%;
	text-align: center;
	float:left;
}
.p5sketch{
	margin:2%;
}
.cpanel{
	padding-left:1%;
	padding-right:1%;
}
input{
	width:86px;
	font-size: 14px;
}
input.thin{
	width:27px;
}
</style>
</head>
<body>
	<div class="container">
		<div class="left cpanel">
			<h3>File:</h3>
			<button onclick="clearCP()">New</button>
			<button onclick="download()">Export SVG</button>
			<h3>Load Base:</h3>
			<button onclick="loadBase('kite')">Kite</button>
			<button onclick="loadBase('fish')">Fish</button>
			<button onclick="loadBase('bird')">Bird</button>
			<button onclick="loadBase('frog')">Frog</button>
			<h3>Draw Line:</h3>
			<input type="text" id="div-draw-line-start">→<input type="text" id="div-draw-line-end">
			<h3>Add Line:</h3>
			<input type="text" id="div-add-line-start">→<input type="text" id="div-add-line-end">
			<h3>Clean, Intersections:</h3>
			<button onclick="cleanIntersections()">Clean</button>
			Intersections: <input type="text" class="thin" id="div-intersections">
			<h3>Snap Radius:</h3>
			<input type="range" id="div-snap-range"></input><input type="text" id="div-snap-range-value">
			<h3>Debug:</h3>
			<button onclick="logPlanarGraph()">Log Data</button>
		</div>
		<div id="div-editor" class="center p5sketch"></div>
		<div class="right cpanel">
			<h3>last event:</h3>
			<p id="div-last-event"></p>
		</div>
	</div>

<script language="javascript" type="text/javascript" src="../lib/jquery-3.1.1.min.js"></script>
<script language="javascript" type="text/javascript" src="../lib/jquery-ui.min.js"></script>
<script language="javascript" type="text/javascript" src="../lib/p5.min.js"></script>
<script language="javascript" type="text/javascript" src="../src/graph.js"></script>
<script language="javascript" type="text/javascript" src="../src/planarGraph.js"></script>
<script language="javascript" type="text/javascript" src="../src/creasePattern.js"></script>
<script language="javascript" type="text/javascript" src="../render.js"></script>
<script language="javascript" type="text/javascript" src="editor.js"></script>
<script>
var p5window = new p5(editor, 'div-editor');

$(document).on('input', '#div-snap-range', function() {
	var value = $('#div-snap-range').val() / 100.0;
	value *= 0.2;
    $('#div-snap-range-value').val(value.toFixed(3));
	p5window.snapRadius = value;
});
// $('#div-snap-range').change( function(e) {
// });
p5window.callback = function(e){
	if(e == undefined){
		$('#div-last-event').val('');
		$('#div-draw-line').val('');
	} else{
		$('#div-last-event').val(e.description);
		switch (e.description){
			case "draw-line":
				if(e.data != undefined && e.data.start != undefined && e.data.start.x != undefined && e.data.start.y != undefined && e.data.end != undefined && e.data.end.x != undefined && e.data.end.y != undefined){
					$('#div-draw-line-start').val(e.data.start.x.toFixed(2) + ', ' + e.data.start.y.toFixed(2) );
					$('#div-draw-line-end').val(e.data.end.x.toFixed(2) + ', ' + e.data.end.y.toFixed(2) );
				}
			break;
			case "add-line":
				if(e.data != undefined && e.data.start != undefined && e.data.end != undefined){
					$('#div-add-line-start').val(e.data.start.x.toFixed(2) + ', ' + e.data.start.y.toFixed(2));
					$('#div-add-line-end').val(e.data.end.x.toFixed(2) + ', ' + e.data.end.y.toFixed(2));
				}
			break;
			case "draw-line3":
			break;
			case "clean":
				if(e.data != undefined){
					var intersections = e.data['intersections'];
					if(intersections.length >= 0){
						$('#div-intersections').val(intersections.length);
					}
				}
			break;
		}
	}
};

function clearCP(){
	p5window.clearCP();
}

function loadBase(base){
	p5window.loadBase(base);
}

function cleanIntersections(){
	var intersections = p5window.cleanIntersections();
}

function logPlanarGraph(){
	console.log(p5window.getPlanarGraphObject());
}

function download() {
	var svgData = p5window.makeSVGBlob();
	var fileName = "crease-pattern.svg";
	saveData(svgData, fileName);
}

var saveData = (function () {
	var a = document.createElement("a");
	document.body.appendChild(a);
	a.style = "display: none";
	return function (data, fileName) {
		var blob = new Blob([data], {type: "image/svg+xml;charset=utf-8"});
		var url = window.URL.createObjectURL(blob);
		a.href = url;
		a.download = fileName;
		a.click();
		window.URL.revokeObjectURL(url);
	};
}());

function KeyPress(e) {
	var evtobj = window.event? event : e
	// if (evtobj.keyCode == 90 && evtobj.ctrlKey) {
	if (evtobj.keyCode == 90){//evtobj.cmdKey) {
		p5window.undo();
	}
	if(evtobj.shiftKey){
		//shift pressed
	}

}

document.onkeydown = KeyPress;

</script>

</body>
</html>
