<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="../dist/bootstrap/css/bootstrap.min.css">
<!-- Optional theme -->
<link rel="stylesheet" href="../dist/bootstrap/css/bootstrap-theme.min.css">
<style>
html, body {
	width:100%;
	height:100%;
	margin:0px;
	font-family: sans-serif;
	cursor:default;
}
#div-editor{
	width:100%;
	height:100%;
}
.center{
	text-align: center;
}
.p5sketch{
	margin:2% 0;
}
.cpanel{
	padding-left:1%;
	padding-right:1%;
}
input.input-med{
	width:40%;
	font-size: 14px;
}
input.input-sm{
	width:27px;
}
.modal-header{
	background-color: #337ab7;
	color:#FFF;
    overflow: hidden;
    border-radius: 5px 5px 0px 0px;
}
.modal-content{
    margin-right: 0;
    margin-left: 0;
}
.modal-body{
	padding:0px 15px 15px 15px;
}
.control-panel{
	position: fixed;
	z-index: 10;
	display: block;
	-webkit-overflow-scrolling: touch;
	outline: 0;
	width: 250px;
}
#modal-tools{
	top: 10px;
	right: 10px;
}
#modal-file{
	top: 10px;
	left: 10px;
}
h3.tools-title{
	margin:2%;
	padding:15px 0px 0px 0px;
	font-size: 16px;
	width:96%;
	border-color: #DDD;
	border-width: 1px;
	border-top: 0;
	border-bottom: 1;
	border-right: 0;
	border-left: 0;
	border-style: solid;
}

</style>
</head>
<body>

	<div id="modal-file" class="control-panel">
		<div class="modal-content">
			<div class="modal-header">
				 <h4 class="modal-title">File / View</h4>
			</div>
			<div class="modal-body">
				<h3 class="tools-title">File</h3>
				<button class="btn btn-sm btn-primary" onclick="clearCP()">New</button>
				<button class="btn btn-sm btn-default" onclick="download()">Export SVG</button>
				<h3 class="tools-title">Load Base</h3>
				<button class="btn btn-sm btn-default" onclick="loadBase('kite')">Kite</button>
				<button class="btn btn-sm btn-default" onclick="loadBase('fish')">Fish</button>
				<button class="btn btn-sm btn-default" onclick="loadBase('bird')">Bird</button>
				<button class="btn btn-sm btn-default" onclick="loadBase('frog')">Frog</button>
				<h3 class="tools-title">Show</h3>
				<div class="btn-group">
					<button type="button" class="btn btn-sm btn-default active" id="show-snap-radius-button" data-toggle="button" aria-pressed="true" autocomplete="off">Snap Radius</button>
					<button type="button" class="btn btn-sm btn-default active" id="show-nodes-button" data-toggle="button" aria-pressed="true" autocomplete="off">Nodes</button>
					<button type="button" class="btn btn-sm btn-default" id="show-faces-button" data-toggle="button" aria-pressed="false" autocomplete="off">Faces</button>
					<button type="button" class="btn btn-sm btn-default" id="show-clockwise-button" data-toggle="button" aria-pressed="false" autocomplete="off">Clockwise</button>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-sm btn-default disabled" data-dismiss="modal">Load</button>
				<button type="button" class="btn btn-sm btn-primary disabled">Save</button>
			</div>
		</div>
	</div>

	<div id="modal-tools" class="control-panel">
		<div class="modal-content">
			<div class="modal-header">
				 <h4 class="modal-title">Tools</h4>
			</div>
			<div class="modal-body">
				<h3 class="tools-title">Mode</h3>
				<div class="btn-group" id="mouse-mode-button" data-toggle="buttons">
					<label class="btn btn-default active">
					<input type="radio" name="options" id="mouse-mode-button-1" autocomplete="off" value="draw" checked> Draw
					</label>
					<label class="btn btn-default">
					<input type="radio" name="options" id="mouse-mode-button-2" autocomplete="off" value="select"> Select
					</label>
				</div>
				<h3 class="tools-title">Draw Line</h3>
				<div class="center">
					<input type="text" class="input-med" readonly id="div-draw-line-start">â†’<input type="text" class="input-med" readonly id="div-draw-line-end">
				</div>
				<h3 class="tools-title" id="div-snap-range-value">Snap Radius: </h3>
				<input type="range" id="div-snap-range"></input>
				<h3 class="tools-title">Clean, Intersections</h3>
				<button class="btn btn-sm btn-default" onclick="cleanIntersections()">Clean</button>
				Intersections: <input type="text" class="input-sm" readonly id="div-intersections">
				<h3 class="tools-title">Faces</h3>
				<button class="btn btn-sm btn-default" id="find-faces-button">Find Faces</button>
				<button class="btn btn-sm btn-default" id="refresh-adjacency-button">Refresh Adjacency</button>
			</div>
		</div>
	</div>	

	<div class="container">
		<div id="div-editor" class="center p5sketch"></div>
	</div>

<script language="javascript" type="text/javascript" src="../lib/jquery-3.1.1.min.js"></script>
<script language="javascript" type="text/javascript" src="../lib/jquery-ui.min.js"></script>
<script language="javascript" type="text/javascript" src="../lib/p5.min.js"></script>
<script language="javascript" type="text/javascript" src="../src/graph.js"></script>
<script language="javascript" type="text/javascript" src="../src/planarGraph.js"></script>
<script language="javascript" type="text/javascript" src="../src/creasePattern.js"></script>
<script language="javascript" type="text/javascript" src="../render.js"></script>
<script language="javascript" type="text/javascript" src="editor.js"></script>
<!-- Latest compiled and minified JavaScript -->
<script type="text/javascript" src="../dist/bootstrap/js/bootstrap.min.js"></script>

<script>
$('.modal').modal('show');

var p5window = new p5(editor, 'div-editor');

var slider_scale = 0.0025;
var slider_start = 0.05;

$(document).on('change', 'input:radio[id^="mouse-mode-button"]', function (event) {
	var mode_result = $('#mouse-mode-button input:radio:checked').val();
	p5window.mouseMode = mode_result;
});

$('#div-snap-range').val(slider_start/slider_scale);
	$('#div-snap-range-value').html("Snap Radius: " + (slider_start*100).toFixed(1) + "%");

$(document).on('input', '#div-snap-range', function() {
	var value = $('#div-snap-range').val() * slider_scale;
	$('#div-snap-range-value').html("Snap Radius: " + (value*100).toFixed(1) + "%");
	p5window.snapRadius = value;
});

p5window.callback = function(e){
	if(e == undefined){
		$('#div-last-event').val('');
		$('#div-draw-line').val('');
	} else{
		$('#div-last-event').val(e.description);
		switch (e.description){
			case "draw-line":
				if(e.data != undefined && e.data.start != undefined && e.data.start.x != undefined && e.data.start.y != undefined && e.data.end != undefined && e.data.end.x != undefined && e.data.end.y != undefined){
					$('#div-draw-line-start').val(e.data.start.x.toFixed(2) + ', ' + e.data.start.y.toFixed(2) );
					$('#div-draw-line-end').val(e.data.end.x.toFixed(2) + ', ' + e.data.end.y.toFixed(2) );
				}
			break;
			case "add-line":
				if(e.data != undefined && e.data.start != undefined && e.data.end != undefined){
					$('#div-draw-line-start').val(e.data.start.x.toFixed(2) + ', ' + e.data.start.y.toFixed(2));
					$('#div-draw-line-end').val(e.data.end.x.toFixed(2) + ', ' + e.data.end.y.toFixed(2));
				}
			break;
			case "draw-line3":
			break;
			case "clean":
				if(e.data != undefined){
					var intersections = e.data['intersections'];
					if(intersections.length >= 0){
						$('#div-intersections').val(intersections.length);
					}
				}
			break;
		}
	}
};

function clearCP(){
	p5window.clearCP();
}

function loadBase(base){
	p5window.loadBase(base);
}

function cleanIntersections(){
	var intersections = p5window.cleanIntersections();
}

function logPlanarGraph(){
	console.log(p5window.getPlanarGraphObject());
}

function download() {
	var svgData = p5window.makeSVGBlob();
	var fileName = "crease-pattern.svg";
	saveData(svgData, fileName);
}

var saveData = (function () {
	var a = document.createElement("a");
	document.body.appendChild(a);
	a.style = "display: none";
	return function (data, fileName) {
		var blob = new Blob([data], {type: "image/svg+xml;charset=utf-8"});
		var url = window.URL.createObjectURL(blob);
		a.href = url;
		a.download = fileName;
		a.click();
		window.URL.revokeObjectURL(url);
	};
}());

function KeyPress(e) {
	var evtobj = window.event? event : e
	// if (evtobj.keyCode == 90 && evtobj.ctrlKey) {
	// if(shift and z) redo the undo
	if (evtobj.keyCode == 90){//evtobj.cmdKey) {
		p5window.undo();
	}
	if(evtobj.shiftKey){
		//shift pressed
	}
}

document.onkeydown = KeyPress;

// $('#modal-tools').modal({
// 	backdrop: 'static',
// 	keyboard: false
// }); 

$("#modal-tools").draggable({
	handle: ".modal-header"
});

$("#modal-file").draggable({
	handle: ".modal-header"
});

$("#show-snap-radius-button").click(function() {
	p5window.showSnapRadius = !(p5window.showSnapRadius);
});

$("#show-nodes-button").click(function() {
	p5window.showNodes = !(p5window.showNodes);
});

$("#find-faces-button").click(function(){
	p5window.findFaces();
});

$("#show-faces-button").click(function(){
	p5window.showFaces = !(p5window.showFaces);
});

$("#show-clockwise-button").click(function(){
	console.log(p5window.g.clockwiseNodeEdges);
	p5window.showClockwise = !(p5window.showClockwise);
});

$("#refresh-adjacency-button").click(function(){
	p5window.refreshAdjacency();
	console.log(p5window.g.nodes);
});
       
        // BootstrapDialog.show({
        //     title: 'More dialog sizes',
        //     message: 'Hi Apple!',
        //     buttons: [{
        //         label: 'Normal',
        //         action: function(dialog){
        //             dialog.setTitle('Normal');
        //             dialog.setSize(BootstrapDialog.SIZE_NORMAL);
        //         }
        //     }, {
        //         label: 'Small',
        //         action: function(dialog){
        //             dialog.setTitle('Small');
        //             dialog.setSize(BootstrapDialog.SIZE_SMALL);
        //         }
        //     }, {
        //         label: 'Wide',
        //         action: function(dialog){
        //             dialog.setTitle('Wide');
        //             dialog.setSize(BootstrapDialog.SIZE_WIDE);
        //         }
        //     }, {
        //         label: 'Large',
        //         action: function(dialog){
        //             dialog.setTitle('Large');
        //             dialog.setSize(BootstrapDialog.SIZE_LARGE);
        //         }
        //     }]
        // });
        
    
</script>

</body>
</html>
