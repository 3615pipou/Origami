<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../lib/bootstrap/css/bootstrap.min.css" rel="stylesheet">
<style>
html, body {
	height:100%;
	width:100%;
	background-color: #EEE;
	margin:0px;
}
canvas[resize]{
	width:100%;
	height:86%;
}
#download-svg, #download-fold, #load-file{ padding:0.5em; }
.toolbar{ text-align: center; }
</style>
</head>
<body>
	<canvas id="canvas" resize></canvas>
	<div class="toolbar">
		<a href="#" class="btn btn-lg btn-secondary" id="load-file">Open File</a>
		<a href="#" class="btn btn-lg btn-secondary" id="download-svg">Export .svg</a>
		<a href="#" class="btn btn-lg btn-secondary" id="download-fold">Export .fold</a>
	</div>
</body>

<script src="../../tools/drag-and-drop.js"></script>
<script src="../../tools/file-upload-button.js"></script>
<script language="javascript" type="text/javascript" src="../../lib/paper-full.min.js"></script>
<script language="javascript" type="text/javascript" src="../../creasepattern.js"></script>
<script language="javascript" type="text/javascript" src="../../src/cp.paperjs.js"></script>

<script src="../../lib/bootstrap/js/tether.min.js"></script>
<script src="../../lib/jquery-3.2.1.slim.min.js"></script>
<script src="../../lib/bootstrap/js/popper.min.js"></script>
<script src="../../lib/bootstrap/js/bootstrap.min.js"></script>
<script src="../../lib/bootstrap/js/ie10-viewport-bug-workaround.js"></script>


<script src="editor.js"></script>

<script>
// incoming file from upload-button or drag-to-upload
function fileDidLoad(file, mimeType){
	try{
		// try .fold file format first
		var foldFile = JSON.parse(file);
		project.cp.importFoldFile(foldFile);
		project.draw();
	} catch(err){
		// try .svg file format
		project.load(file, function(){ });
	}
	// switch(mimeType){
	// 	case "image/svg+xml": project.load(file, function(){ }); break;
	// 	default: break;
	// }
}
</script>

<!-- download svg blob -->
<script>
function download(text, filename, mimeType){
	var blob = new Blob([text], {type: mimeType});
	var url = window.URL.createObjectURL(blob);
	var a = document.createElement("a");
	a.href = url;
	a.download = filename;
	a.click();
}
</script>

<!-- button to download -->
<script>
document.getElementById("download-svg").addEventListener("click", function(e){
	e.preventDefault();
	var scale = 600 / project.cpMin;
	var svgBlob = project.cp.exportSVG(scale);
	download(svgBlob, "creasepattern.svg", "image/svg+xml");
});
document.getElementById("download-fold").addEventListener("click", function(e){
	e.preventDefault();
	var foldObject = project.cp.exportFoldFile();
	var foldFileBlob = JSON.stringify(foldObject);
	download(foldFileBlob, "creasepattern.fold", "application/json");
});
</script>

</html>
